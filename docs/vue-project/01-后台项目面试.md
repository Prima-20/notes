# ğŸŒ±ğŸª´ğŸŒ³ğŸŒ´ğŸŒµğŸŒ¾ğŸŒ¿ğŸ€ğŸğŸ‚ğŸƒğŸ„

# ä¸€ã€é¡¹ç›®ç®€ä»‹

## 1ã€åå°ç®¡ç†ç³»ç»Ÿçš„åŠŸèƒ½åˆ’åˆ†

ç”µå•†åå°ç®¡ç†ç³»ç»Ÿç”¨äºç®¡ç†ç”¨æˆ·è´¦å·ã€å•†å“åˆ†ç±»ã€å•†å“ä¿¡æ¯ã€è®¢å•ã€æ•°æ®ç»Ÿè®¡ç­‰ä¸šåŠ¡åŠŸèƒ½ã€‚

![](images/é¡¹ç›®ç³»ç»ŸåŠŸèƒ½.png)

## 2ã€åå°ç®¡ç†ç³»ç»Ÿçš„å¼€å‘æ¨¡å¼ï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰

![](images/å¼€å‘æ¨¡å¼.png)

å‰åç«¯åˆ†ç¦»ä¹‹åï¼Œå¼€å‘æµç¨‹å°†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](images/æµç¨‹.jpg)

åœ¨å¼€å‘æœŸé—´å‰åç«¯å…±åŒå•†å®šå¥½æ•°æ®æ¥å£çš„äº¤äº’å½¢å¼å’Œæ•°æ®æ ¼å¼ã€‚ç„¶åå®ç°å‰åç«¯çš„å¹¶è¡Œå¼€å‘ï¼Œå…¶ä¸­å‰ç«¯å·¥ç¨‹å¸ˆå†å¼€å‘å®Œæˆä¹‹åå¯ä»¥ç‹¬è‡ªè¿›è¡Œ mock æµ‹è¯•ï¼Œè€Œåç«¯ä¹Ÿå¯ä»¥ä½¿ç”¨æ¥å£æµ‹è¯•å¹³å°è¿›è¡Œæ¥å£è‡ªæµ‹ï¼Œç„¶åå‰åç«¯ä¸€èµ·è¿›è¡ŒåŠŸèƒ½è”è°ƒå¹¶æ ¡éªŒæ ¼å¼ï¼Œæœ€ç»ˆè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

![](images/æµç¨‹2.jpg)

## 3ã€ç”µå•†åå°ç®¡ç†ç³»ç»Ÿçš„æŠ€æœ¯é€‰å‹

- å‰ç«¯é¡¹ç›®æŠ€æœ¯æ ˆ

  ` Vue`

  ` Vue-router`

  `Element-UI `

  ` Axios`

  `Echarts`

- åç«¯é¡¹ç›®æŠ€æœ¯æ ˆ

  `Node.js`

  ` Express`

  `Jwt `

  `Mysql`

  `Sequelize`

# äºŒã€ç™»å½•/é€€å‡ºåŠŸèƒ½

## 1ã€ç™»å½•ä¸šåŠ¡æµç¨‹

â‘  åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

â‘¡ è°ƒç”¨åå°æ¥å£è¿›è¡ŒéªŒè¯

â‘¢ é€šè¿‡éªŒè¯ä¹‹åï¼Œæ ¹æ®åå°çš„å“åº”çŠ¶æ€è·³è½¬åˆ°é¡¹ç›®ä¸»é¡µ

## 2ã€ç™»å½•ä¸šåŠ¡çš„ç›¸å…³æŠ€æœ¯ç‚¹

`http` æ˜¯æ— çŠ¶æ€çš„,æ€æ ·è®°å½•ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Ÿ

é€šè¿‡ `cookie `åœ¨å®¢æˆ·ç«¯è®°å½•çŠ¶æ€

é€šè¿‡ `session` åœ¨æœåŠ¡å™¨ç«¯è®°å½•çŠ¶æ€

é€šè¿‡`token`æ–¹å¼ç»´æŒçŠ¶æ€

åœ¨è·¨åŸŸçš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨`token`æ–¹å¼ã€‚

## 3ã€token åŸç†åˆ†æ

ç°åœ¨æˆ‘ä»¬é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œåªè¦ä»»ä½•ä¸€ä¸ªç”¨æˆ·çŸ¥é“äº†æœåŠ¡ç«¯æ¥å£çš„åœ°å€ï¼Œéƒ½å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œè€Œæˆ‘ä»¬æœ‰æ—¶å€™å¸Œæœ›çš„æ˜¯ç™»å½•çš„ç”¨æˆ·æ‰èƒ½å¤Ÿè®¿é—®æœåŠ¡ç«¯çš„æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åŠ ä¸Šç›¸åº”çš„è®¤è¯æœºåˆ¶ã€‚å…³äºè®¤è¯æœºåˆ¶ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨`JWT`.

` JSON Web Tokenï¼ˆJWTï¼‰`æ˜¯ä¸€ä¸ªå¼€æ”¾çš„æ ‡å‡†ï¼ˆ`RFC 7519`ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä½œä¸º`JSON`å¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚ç”±äºæ­¤ä¿¡æ¯æ˜¯ç»è¿‡æ•°å­—ç­¾åçš„ï¼Œå› æ­¤å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ã€‚

**ä¼ ç»Ÿè®¤è¯æµç¨‹**

```
1ã€ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚

2ã€æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œåœ¨å½“å‰å¯¹è¯ï¼ˆsessionï¼‰é‡Œé¢ä¿å­˜ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€ç™»å½•æ—¶é—´ç­‰ç­‰ã€‚

3ã€æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª session_idï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚

4ã€ç”¨æˆ·éšåçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ Cookieï¼Œå°† session_id ä¼ å›æœåŠ¡å™¨ã€‚

5ã€æœåŠ¡å™¨æ”¶åˆ° session_idï¼Œæ‰¾åˆ°å‰æœŸä¿å­˜çš„æ•°æ®ï¼Œç”±æ­¤å¾—çŸ¥ç”¨æˆ·çš„èº«ä»½ã€‚
```

è¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºï¼Œæ‰©å±•æ€§ï¼ˆscalingï¼‰ä¸å¥½ã€‚å•æœºå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼Œæˆ–è€…æ˜¯è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚æ‰€ä»¥è¯´ï¼Œåœ¨é›†ç¾¤æˆ–è€…æ˜¯è·¨åŸŸçš„åº”ç”¨ç¯å¢ƒä¸‹ï¼Œæ¨èä½¿ç”¨`tokençš„æ¨¡å¼`æ ¡éªŒã€‚

ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å’Œ B ç½‘ç«™æ˜¯åŒä¸€å®¶å…¬å¸çš„å…³è”æœåŠ¡ã€‚ç°åœ¨è¦æ±‚ï¼Œç”¨æˆ·åªè¦åœ¨å…¶ä¸­ä¸€ä¸ªç½‘ç«™ç™»å½•ï¼Œå†è®¿é—®å¦ä¸€ä¸ªç½‘ç«™å°±ä¼šè‡ªåŠ¨ç™»å½•ï¼Œè¯·é—®æ€ä¹ˆå®ç°ï¼Ÿ

ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ session æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥æ•°æ®åº“æˆ–åˆ«çš„æŒä¹…å±‚ã€‚å„ç§æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å‘æŒä¹…å±‚è¯·æ±‚æ•°æ®ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¶æ„æ¸…æ™°ï¼Œç¼ºç‚¹æ˜¯å·¥ç¨‹é‡æ¯”è¾ƒå¤§ã€‚å¦å¤–ï¼ŒæŒä¹…å±‚ä¸‡ä¸€æŒ‚äº†ï¼Œå°±ä¼šå•ç‚¹å¤±è´¥ã€‚

å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æœåŠ¡å™¨ç´¢æ€§ä¸ä¿å­˜ session æ•°æ®äº†ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›æœåŠ¡å™¨ã€‚`JWT` å°±æ˜¯è¿™ç§æ–¹æ¡ˆçš„ä¸€ä¸ªä»£è¡¨ã€‚

**`JWT`è®¤è¯æµç¨‹**

![](images/tokenåŸç†åˆ†æ.png)

## 4ã€è·¯ç”±åˆ›å»º

åœ¨`src`ç›®å½•ä¸‹é¢ï¼Œåˆ›å»º`router.js`æ–‡ä»¶,æ–‡ä»¶å®šä¹‰è·¯ç”±è§„åˆ™

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
Vue.use(Router);
export default new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
  ],
});
```

è¾“å…¥â€œ/â€çš„æ—¶å€™ï¼Œä¼šé‡å®šå‘åˆ°ç™»å½•ç»„ä»¶ã€‚

ä¸‹é¢éœ€è¦åœ¨`App.vue`ç»„ä»¶ä¸­ï¼Œå®šä¹‰è·¯ç”±å ä½ç¬¦ã€‚

```vue
<template>
  <div id="app">
    <!--è·¯ç”±å ä½ç¬¦-->
    <router-view></router-view>
  </div>
</template>

<script>
export default {
  name: "App",
};
</script>

<style></style>
```

æœ€åï¼Œéœ€è¦åœ¨`main.js`æ–‡ä»¶ä¸­å¯¼å…¥è·¯ç”±ï¼Œå¹¶ä¸”åœ¨åˆ›å»º`vue`å®ä¾‹çš„æ—¶å€™ï¼Œå®Œæˆè·¯ç”±çš„æ³¨å†Œã€‚

```js
import router from "./router";

new Vue({
  router,
  render: (h) => h(App),
}).$mount("#app");
```

## 5ã€ç™»å½•é¡µé¢æ„å»º

**`Element UI`æŒ‰éœ€åŠ è½½**

ç¬¬ä¸€ã€å®‰è£…`babel-plugin-componentæ’ä»¶`

ç¬¬äºŒï¼šåœ¨`src`ç›®å½•ä¸‹é¢åˆ›å»º`plugins`ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹é¢åˆ›å»º`element.js`æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å¯¼å…¥æ‰€éœ€è¦çš„ç»„ä»¶ã€‚

```js
import Vue from "vue";
import { Button, Form, FormItem, Input } from "element-ui";

Vue.use(Button);
Vue.use(Form);
Vue.use(FormItem);
Vue.use(Input);
```

ç¬¬ä¸‰ï¼šåœ¨`main.js`æ–‡ä»¶ä¸­å¯¼å…¥`element.js`æ–‡ä»¶ã€‚

```js
import "./plugins/element.js";
```

ç¬¬å››ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`babel.config.js`æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹`plugins`çš„é…ç½®ä¿¡æ¯ã€‚

```
module.exports = {
  presets: ["@vue/cli-plugin-babel/preset"],
  plugins: [
    [
      "component",
      {
        libraryName: "element-ui",
        styleLibraryName: "theme-chalk",
      },
    ],
  ],
};

```

åœ¨æ•´ä¸ªç™»å½•è¡¨å•æ„å»ºè¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

**ç¬¬ä¸€ï¼šæ•°æ®ç»‘å®š**

é¦–å…ˆç»™`el-form`æ·»åŠ `model`å±æ€§ï¼ŒåŠ¨æ€ç»‘å®šè¡¨å•å…ƒç´ æ‰€éœ€è¦çš„æ•°æ®ã€‚

```js
 :model="loginForm"
```

`loginForm`æ•°æ®å®šä¹‰å¦‚ä¸‹ï¼š

```js
data() {
    return {
      // è¿™æ˜¯ç™»å½•è¡¨å•çš„æ•°æ®ç»‘å®šå¯¹è±¡
      loginForm: {
        username: "admin",
        password: "123456",
      },
    }
```

é€šè¿‡ç»™æ–‡æœ¬æ¡†ç­‰è¡¨å•å…ƒç´ æ·»åŠ `v-model`æ¥ç»‘å®šå…·ä½“çš„æ•°æ®ã€‚

```html
<el-input
  prefix-icon="iconfont icon-user"
  v-model="loginForm.username"
></el-input>

<el-input
  prefix-icon="iconfont icon-3702mima"
  v-model="loginForm.password"
  type="password"
></el-input>
```

**ç¬¬äºŒ: è¡¨å•æ ¡éªŒ**

é¦–å…ˆç»™`<el-form>`æ·»åŠ `rules`å±æ€§ï¼Œè¯¥å±æ€§åŠ¨æ€ç»‘å®šçš„æ˜¯è¡¨å•æ ¡éªŒçš„è§„åˆ™å¯¹è±¡ã€‚

```js
 :rules="loginFormRules"
```

ä¸‹é¢å®šä¹‰æ ¡éªŒè§„åˆ™å¯¹è±¡ã€‚

```js
  // è¿™æ˜¯è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      loginFormRules: {
        // éªŒè¯ç”¨æˆ·åæ˜¯å¦åˆæ³•
        username: [
          { required: true, message: "è¯·è¾“å…¥ç™»å½•åç§°", trigger: "blur" },
          {
            min: 3,
            max: 10,
            message: "é•¿åº¦åœ¨ 3 åˆ° 10 ä¸ªå­—ç¬¦",
            trigger: "blur",
          },
        ],
        // éªŒè¯å¯†ç æ˜¯å¦åˆæ³•
        password: [
          { required: true, message: "è¯·è¾“å…¥ç™»å½•å¯†ç ", trigger: "blur" },
          {
            min: 6,
            max: 15,
            message: "é•¿åº¦åœ¨ 6 åˆ° 15 ä¸ªå­—ç¬¦",
            trigger: "blur",
          },
        ],
      },
```

ç»™`el-form-item` æ·»åŠ `prop`å±æ€§ï¼Œè¯¥å±æ€§çš„å€¼ä¸ºå¯¹åº”çš„æ ¡éªŒè§„åˆ™å±æ€§ã€‚

```vue
<el-form-item prop="username">
          <el-input
            prefix-icon="iconfont icon-user"
            v-model="loginForm.username"
          ></el-input>
        </el-form-item>
<!-- å¯†ç  -->
<el-form-item prop="password">
          <el-input
            prefix-icon="iconfont icon-3702mima"
            v-model="loginForm.password"
            type="password"
          ></el-input>
 </el-form-item>
```

**ç¬¬ä¸‰ï¼šè¡¨å•é‡ç½®**

é¦–å…ˆç»™â€œé‡ç½®â€æŒ‰é’®ç»‘å®šå•å‡»äº‹ä»¶ï¼Œåœ¨å…¶æ‰€å¯¹åº”çš„å›è°ƒå¤„ç†å‡½æ•°ä¸­ï¼Œé€šè¿‡`resetFields( )`æ–¹æ³•å®Œæˆè¡¨å•å†…å®¹çš„é‡ç½®ã€‚

```html
<el-button type="info" @click="resetLoginForm">é‡ç½®</el-button>
```

é‚£ä¹ˆæ€æ ·è°ƒç”¨`resetFields( )`æ–¹æ³•å‘¢ï¼Ÿ

éœ€è¦è·å–`el-form`è¿™ä¸ªè¡¨å•çš„å®ä¾‹ã€‚

æ‰€ä»¥ï¼Œç»™`el-form`è¡¨å•æ·»åŠ `ref`å±æ€§ã€‚

```js
ref = "loginFormRef";
```

åœ¨`resetLoginForm`è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å½“å‰ç»„ä»¶çš„å®ä¾‹ï¼Œè·å–`$refs`å±æ€§ï¼Œç„¶åé€šè¿‡è¯¥å±æ€§è·å–è¡¨å•çš„å®ä¾‹ï¼Œä»è€Œå®Œæˆå¯¹`resetFields`æ–¹æ³•çš„è°ƒç”¨ã€‚

```js
  methods: {
    // ç‚¹å‡»é‡ç½®æŒ‰é’®ï¼Œé‡ç½®ç™»å½•è¡¨å•
    resetLoginForm() {
      // console.log(this);
      this.$refs.loginFormRef.resetFields();
    },
  },
```

å®Œæ•´ç™»å½•ç»„ä»¶çš„æ•´ä½“å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<template>
  <div class="login_container">
    <div class="login_box">
      <!-- å¤´åƒåŒºåŸŸ -->
      <div class="avatar_box">
        <img src="../assets/logo.png" alt />
      </div>
      <!-- ç™»å½•è¡¨å•åŒºåŸŸ -->
      <el-form
        label-width="0px"
        class="login_form"
        :model="loginForm"
        :rules="loginFormRules"
        ref="loginFormRef"
      >
        <!-- ç”¨æˆ·å -->
        <el-form-item prop="username">
          <el-input
            prefix-icon="iconfont icon-user"
            v-model="loginForm.username"
          ></el-input>
        </el-form-item>
        <!-- å¯†ç  -->
        <el-form-item prop="password">
          <el-input
            prefix-icon="iconfont icon-3702mima"
            v-model="loginForm.password"
            type="password"
          ></el-input>
        </el-form-item>
        <!-- æŒ‰é’®åŒºåŸŸ -->
        <el-form-item class="btns">
          <el-button type="primary">ç™»å½•</el-button>
          <el-button type="info" @click="resetLoginForm">é‡ç½®</el-button>
        </el-form-item>
      </el-form>
    </div>
  </div>
</template>
<script>
export default {
  data() {
    return {
      // è¿™æ˜¯ç™»å½•è¡¨å•çš„æ•°æ®ç»‘å®šå¯¹è±¡
      loginForm: {
        username: "admin",
        password: "123456",
      },
      // è¿™æ˜¯è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      loginFormRules: {
        // éªŒè¯ç”¨æˆ·åæ˜¯å¦åˆæ³•
        username: [
          { required: true, message: "è¯·è¾“å…¥ç™»å½•åç§°", trigger: "blur" },
          {
            min: 3,
            max: 10,
            message: "é•¿åº¦åœ¨ 3 åˆ° 10 ä¸ªå­—ç¬¦",
            trigger: "blur",
          },
        ],
        // éªŒè¯å¯†ç æ˜¯å¦åˆæ³•
        password: [
          { required: true, message: "è¯·è¾“å…¥ç™»å½•å¯†ç ", trigger: "blur" },
          {
            min: 6,
            max: 15,
            message: "é•¿åº¦åœ¨ 6 åˆ° 15 ä¸ªå­—ç¬¦",
            trigger: "blur",
          },
        ],
      },
    };
  },
  methods: {
    // ç‚¹å‡»é‡ç½®æŒ‰é’®ï¼Œé‡ç½®ç™»å½•è¡¨å•
    resetLoginForm() {
      // console.log(this);
      this.$refs.loginFormRef.resetFields();
    },
  },
};
</script>
<style scoped>
.login_container {
  background-color: #2b4b6b;
  height: 100%;
}
.login_box {
  width: 450px;
  height: 300px;
  background-color: #fff;
  border-radius: 3px;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}
.avatar_box {
  height: 130px;
  width: 130px;
  border: 1px solid #eee;
  border-radius: 50%;
  padding: 10px;
  box-shadow: 0 0 10px #ddd;
  position: absolute;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
}
img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background-color: #eee;
}
.login_form {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 0 20px;
  box-sizing: border-box;
}

.btns {
  display: flex;
  justify-content: flex-end;
}
</style>
```

å…³äºå…¨å±€æ ·å¼ï¼Œå®šä¹‰åœ¨`assets/css/global.css`æ–‡ä»¶ä¸­ï¼Œåœ¨`main.js`æ–‡ä»¶ä¸­å¯¼å…¥å…¨å±€æ ·å¼

```js
import "./assets/css/global.css";
```

`global.css`ä¸­çš„åˆæ­¥ä»£ç ï¼š

```css
html,
body,
#app {
  height: 100%;
  margin: 0;
  padding: 0;
}
```

å…³äºè®©æ–‡æœ¬æ¡†æˆ–è€…æ˜¯å¯†ç æ¡†æ˜¾ç¤º`icon`å›¾æ ‡ï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å›¾æ ‡åº“ã€‚

ä¸‹è½½å¥½çš„å›¾æ ‡åº“(`fonts`)æ‹·è´åˆ°`assets`ç›®å½•ä¸‹é¢ï¼Œåœ¨`main.js`ä¸­å¼•å…¥å¯¹åº”çš„æ ·å¼ã€‚

```js
import "./assets/fonts/iconfont.css";
```

é€šè¿‡`prefix-icon`å±æ€§ä¸ºæ–‡æœ¬æ¡†æˆ–å¯†ç æ¡†å‰é¢æ·»åŠ å¯¹åº”çš„å›¾æ ‡ã€‚

```html
<el-input
  prefix-icon="iconfont icon-user"
  v-model="loginForm.username"
></el-input>
```

å…·ä½“çš„ç¬¬ä¸‰æ–¹å›¾æ ‡ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒï¼š`assets/fonts/demo_fontclass.html`æ–‡ä»¶ã€‚

## 6ã€ç™»å½•å‰çš„è¡¨å•æ ¡éªŒ

å½“ç”¨æˆ·å•å‡»â€œç™»å½•â€æŒ‰é’®çš„æ—¶å€™ï¼Œä¸æ˜¯ç«‹å³å‘é€è¯·æ±‚ï¼Œè€Œæ˜¯å…ˆè¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥çš„æ•°æ®æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®äº†æ‰ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ã€‚

å½“ç”¨æˆ·å•å‡»â€œç™»å½•â€æŒ‰é’®çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡`validate`æ–¹æ³•æ¥å®Œæˆå¯¹æ•´ä¸ªè¡¨å•è¿›è¡Œæ ¡éªŒã€‚

ç»™ç™»å½•æŒ‰é’®æ·»åŠ å•å‡»äº‹ä»¶

```html
<el-button type="primary" @click="login">ç™»å½•</el-button>
```

`login`æ–¹æ³•å®ç°

```js
 login() {
      this.$refs.loginFormRef.validate((valid) => {
        console.log(valid);
      });
    },
```

é€šè¿‡è¡¨å•å®ä¾‹æ¥è°ƒç”¨`validate`æ–¹æ³•ï¼Œæ¥å®Œæˆè¡¨å•æ ¡éªŒï¼Œæ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯è¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„å‚æ•°è¡¨ç¤ºæ ¡éªŒçš„ç»“æœï¼Œå¦‚æœæ ¡éªŒæˆåŠŸå‚æ•°`valid`ä¸º`true`,å¦åˆ™ä¸º`false`.

## 7ã€é…ç½®`axios`å‘èµ·ç™»å½•è¯·æ±‚

å®‰è£…`axios`

```
npm install axios
```

åœ¨`main.js`æ–‡ä»¶ä¸­ï¼Œå¯¼å…¥`axios`,å¹¶ä¸”å°†å…¶æŒ‚è½½åˆ°`prototype`åŸå‹ä¸Šï¼ŒåŒæ—¶é…ç½®æ‰€è¦è®¿é—®çš„æœåŠ¡ç«¯çš„æ ¹è·¯å¾„

```js
import axios from "axios";
// é…ç½®è¯·æ±‚çš„è·Ÿè·¯å¾„
axios.defaults.baseURL = "http://127.0.0.1:8888/api/private/v1/";
Vue.prototype.$http = axios;
```

ä¸‹é¢å°±å¯ä»¥åœ¨`Login.vue`ç»„ä»¶ä¸­çš„`login`æ–¹æ³•ï¼Œé€šè¿‡`axios`å‘é€è¯·æ±‚ã€‚

```js
  login() {
      this.$refs.loginFormRef.validate(async (valid) => {
        // console.log(valid);
        if (!valid) return;//å‡ºé”™ï¼Œå°±ç»ˆæ­¢
        const { data: res } = await this.$http.post("login", this.loginForm);
        if (res.meta.status !== 200) return console.log("ç™»å½•å¤±è´¥ï¼");
        console.log("ç™»å½•æˆåŠŸ");
      });
    },
```

ç”±äº`axios`æŒ‚è½½åˆ°äº†`Vue`çš„åŸå‹çš„`$http`ä¸Šï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç»„ä»¶ä¸­éƒ½å¯ä»¥é€šè¿‡`this.$http`æ¥è·å–`axios`,ç„¶åè°ƒç”¨å…¶ä¸­çš„`post`æˆ–è€…æ˜¯`get`ç­‰æ–¹æ³•æ¥å‘é€è¯·æ±‚ã€‚

è¯·æ±‚çš„æ•°æ®å°±æ˜¯ç”¨æˆ·åœ¨è¡¨å•ä¸­è¾“å…¥çš„ï¼Œè€Œè¿™é‡Œè¡¨å•å·²ç»ä¸`loginForm`å¯¹è±¡è¿›è¡Œäº†ç»‘å®šï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡`loginForm`å¯¹è±¡æ¥è·å–ç”¨æˆ·åœ¨ç™»å½•è¡¨å•ä¸­è¾“å…¥çš„æ•°æ®ï¼Œ

`post`è¯·æ±‚è¿”å›çš„ç»“æœæ˜¯`Promise`å¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨`async`ä¸`await`ç®€åŒ–å…¶å¤„ç†çš„è¿‡ç¨‹ã€‚

æœ€ååˆ¤æ–­å…¶çŠ¶æ€ç ï¼Œä»è€Œå†³å®šç”¨æˆ·æ˜¯å¦ç™»å½•æˆåŠŸã€‚

## 8ã€é…ç½®`Message`æç¤ºæ¡†

åœ¨`plugins/element.js`æ–‡ä»¶ä¸­å¯¼å…¥`Message`ç»„ä»¶ï¼Œå¹¶ä¸”å°†å…¶æŒ‚è½½åˆ°`Vue`å®ä¾‹çš„åŸå‹ä¸Šã€‚

```js
import Vue from "vue";
import { Button, Form, FormItem, Input, Message } from "element-ui";

Vue.use(Button);
Vue.use(Form);
Vue.use(FormItem);
Vue.use(Input);

Vue.prototype.$message = Message;
```

ä¿®æ”¹`Login.vue`ç»„ä»¶ä¸­çš„`login`æ–¹æ³•

```js
  login() {
      this.$refs.loginFormRef.validate(async (valid) => {
        // console.log(valid);
        if (!valid) return;
        const { data: res } = await this.$http.post("login", this.loginForm);
        if (res.meta.status !== 200) return this.$message.error("ç™»å½•å¤±è´¥ï¼");
        this.$message.success("ç™»å½•æˆåŠŸ");
      });
    },
```

åœ¨ç™»å½•æˆåŠŸåè°ƒç”¨çš„æ˜¯`Message`ç»„ä»¶ä¸­çš„`success`æ–¹æ³•ï¼Œç™»å½•å¤±è´¥è°ƒç”¨çš„æ˜¯`error`æ–¹æ³•ã€‚

## 9ã€å®¢æˆ·ç«¯å­˜å‚¨`token`ä¿¡æ¯

å‰é¢åœ¨è®²è§£`token`çš„åŸç†çš„æ—¶å€™è®²è§£è¿‡ï¼Œåœ¨å®¢æˆ·ç«¯è¦å­˜å‚¨æœåŠ¡ç«¯è¿”å›çš„`token`ä¿¡æ¯ã€‚

å› ä¸ºé¡¹ç›®ä¸­é™¤äº†ç™»å½•ä¹‹å¤–çš„å…¶å®ƒ`API`æ¥å£ï¼Œå¿…é¡»åœ¨ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®ã€‚è¿™æ ·ï¼Œåœ¨è®¿é—®å…¶å®ƒçš„æ¥å£çš„æ—¶å€™ï¼Œæµè§ˆå™¨åªè¦å°†å­˜å‚¨çš„`token`ä¿¡æ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ ¡éªŒæˆåŠŸï¼Œå°±å…è®¸å®¢æˆ·ç«¯è®¿é—®æŒ‡å®šçš„æ¥å£ã€‚

é‚£ä¹ˆï¼Œ`token`ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨`sessionStorage`ä¸­å‘¢ï¼Ÿè¿˜æ˜¯`localStorage`ä¸­å‘¢ï¼Ÿ

`token`ä¿¡æ¯åªåœ¨å½“å‰ç½‘ç«™æ‰“å¼€æœŸé—´ç”Ÿæ•ˆï¼Œæ‰€ä»¥å°†`tokenä¿¡æ¯`å­˜å‚¨åˆ°`sessionStorage`ä¸­ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå…·ä½“çš„å®ç°ã€‚

```js
   login() {
      this.$refs.loginFormRef.validate(async (valid) => {
        // console.log(valid);
        if (!valid) return;
        const { data: res } = await this.$http.post("login", this.loginForm);
        if (res.meta.status !== 200) return this.$message.error("ç™»å½•å¤±è´¥ï¼");
        this.$message.success("ç™»å½•æˆåŠŸ");
        //å­˜å‚¨tokenä¿¡æ¯
        window.sessionStorage.setItem("token", res.data.token);
        //è·³è½¬åˆ°homeé¡µé¢
        this.$router.push("/home");
      });
    },
```

å½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†`token`ä¿¡æ¯å­˜å‚¨åˆ°`sessionStorage`ä¸­ï¼ŒåŒæ—¶ï¼Œè·³è½¬åˆ°`home`é¡µé¢ã€‚

åœ¨`components`ç›®å½•ä¸‹åˆ›å»º`Home.vue`.

åŸºæœ¬çš„ä»£ç å¦‚ä¸‹ï¼š

```vue
<template>
  <div>Homeç»„ä»¶</div>
</template>

<script>
export default {};
</script>

<style scoped></style>
```

åŒæ—¶åœ¨`route.js`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰åŸºæœ¬çš„è·¯ç”±è§„åˆ™

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
Vue.use(Router);
export default new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    { path: "/home", component: Home },
  ],
});
```

## 10ã€é€šè¿‡è·¯ç”±å¯¼èˆªå®ˆå«æ§åˆ¶é¡µé¢è®¿é—®æƒé™

é€šè¿‡å‰é¢çš„è®²è§£ï¼Œæˆ‘ä»¬çŸ¥é“è¦æƒ³è®¿é—®`Home`ç»„ä»¶çš„å†…å®¹ï¼Œå¿…é¡»è¦ç™»å½•ã€‚

ä½†æ˜¯ï¼Œç°åœ¨é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œå¦‚æœæŸä¸ªç”¨æˆ·çŸ¥é“äº†è®¿é—®`Home`ç»„ä»¶çš„`URL`åœ°å€ï¼Œé‚£ä¹ˆä»–å¯ä»¥åœ¨åœ°å€æ ä¸­ç›´æ¥è¾“å…¥è¯¥åœ°å€ï¼Œä¹Ÿå¯ä»¥è®¿é—®`Home`ç»„ä»¶ï¼ˆè¿™é‡Œå¯ä»¥åˆ é™¤`token`ä¿¡æ¯æ¥æ¼”ç¤ºä¸€ä¸‹ï¼‰ï¼Œè¿™æ ·æ•´ä¸ªç™»å½•å°±æ²¡æœ‰ä»»ä½•çš„æ•ˆæœã€‚

æ€æ ·é¿å…è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

è¿™å°±éœ€è¦ç”¨åˆ°è·¯ç”±å¯¼èˆªå®ˆå«æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯å¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œä½†æ˜¯ç›´æ¥é€šè¿‡`URL`è®¿é—®ç‰¹å®šé¡µé¢ï¼Œéœ€è¦é‡æ–°è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¿›è¡Œç™»å½•ã€‚ç™»å½•ä»¥åæ‰èƒ½è®¿é—®ã€‚

è·¯ç”±å¯¼èˆªå®ˆå«åŸºæœ¬ç”¨æ³•ã€‚

```js
// ä¸ºè·¯ç”±å¯¹è±¡ï¼Œæ·»åŠ `beforeEach`å¯¼èˆªå®ˆå«
router.beforeEach((to, from, next) => {
  //å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯ç™»å½•é¡µï¼Œç›´æ¥æ”¾è¡Œ
  if (to.path === "/login") return next();
  const tokenStr = window.sessionStorage.getItem("token");
  // æ²¡æœ‰token,å¼ºåˆ¶è·³è½¬åˆ°ç™»å½•é¡µ
  if (!tokenStr) return next("/login");
  next();
});
```

è·¯ç”±å¯¼èˆªå®ˆå«æœ¬è´¨å°±æ˜¯`beforeEach`å‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå›è°ƒå‡½æ•°ä¸­ç¬¬ä¸€ä¸ªå‚æ•°`to`,è¡¨ç¤ºå°†è¦è®¿é—®çš„åœ°å€ï¼Œ`from`:è¡¨ç¤ºæ˜¯ä»å“ªä¸ªåœ°å€è·³è½¬è¿‡æ¥çš„ã€‚`next` è¡¨ç¤ºç»§ç»­æ‰§è¡Œçš„å‡½æ•°ã€‚

ä¸‹é¢çœ‹ä¸€ä¸‹`router.js`æ–‡ä»¶çš„ä»£ç æ”¹é€ 

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    { path: "/home", component: Home },
  ],
});
// æŒ‚è½½è·¯ç”±å¯¼èˆªå®ˆå«
router.beforeEach((to, from, next) => {
  // to å°†è¦è®¿é—®çš„è·¯å¾„
  // from ä»£è¡¨ä»å“ªä¸ªè·¯å¾„è·³è½¬è€Œæ¥
  // next æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºæ”¾è¡Œ
  //     next()  æ”¾è¡Œ    next('/login')  å¼ºåˆ¶è·³è½¬åˆ°ç™»å½•é¡µ

  if (to.path === "/login") return next();
  // è·å–token
  const tokenStr = window.sessionStorage.getItem("token");
  if (!tokenStr) return next("/login");
  next();
});
export default router;
```

## 11ã€å®ç°é€€å‡ºåŠŸèƒ½

åŸºäº`token`çš„æ–¹å¼å®ç°é€€å‡ºåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œåªè¦é”€æ¯æœ¬åœ°çš„`token`å³å¯ã€‚è¿™æ ·ï¼Œåç»­çš„è¯·æ±‚å°±ä¸ä¼šæ‡ˆæ€ `token`ï¼Œå¿…é¡»é‡æ–°ç™»å½•ä»¥åï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„`token`ä¹‹åæ‰å¯ä»¥è®¿é—®å…¶å®ƒçš„é¡µé¢ã€‚

```js
// æ¸…ç©ºtoken
window.sessionStorage.clear();
// è·³è½¬åˆ°ç™»å½•é¡µ
this.$router.push("/login");
```

åœ¨`Home`ç»„ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªâ€œé€€å‡ºâ€æŒ‰é’®ï¼Œå®ç°é€€å‡ºåŠŸèƒ½ã€‚

```vue
<template>
  <div>
    <el-button type="info" @click="logout">é€€å‡º</el-button>
  </div>
</template>

<script>
export default {
  methods: {
    logout() {
      window.sessionStorage.clear();
      this.$router.push("/login");
    },
  },
};
</script>

<style scoped></style>
```

# ä¸‰ã€ä¸»é¡µå¸ƒå±€å’ŒåŠŸèƒ½å®ç°

## 1ã€ä¸»é¡µåŸºæœ¬å¸ƒå±€å®ç°

è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨äº†`element-ui`ä¸­çš„å¸ƒå±€ç»„ä»¶å®Œæˆçš„ã€‚

`Home.vue`ç»„ä»¶çš„å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<template>
  <el-container class="home-container">
    <!-- å¤´éƒ¨åŒºåŸŸ -->
    <el-header>
      <el-button type="info" @click="logout">é€€å‡º</el-button>Header
    </el-header>
    <!-- é¡µé¢ä¸»ä½“åŒºåŸŸ -->
    <el-container>
      <!-- ä¾§è¾¹æ  -->
      <el-aside width="200px">Aside</el-aside>
      <!-- å³ä¾§å†…å®¹ä¸»ä½“ -->
      <el-main>Main</el-main>
    </el-container>
  </el-container>
</template>

<script>
export default {
  methods: {
    logout() {
      window.sessionStorage.clear();
      this.$router.push("/login");
    },
  },
};
</script>

<style scoped>
.home-container {
  height: 100%;
}
.el-header {
  background-color: #373d41;
}
.el-aside {
  background-color: #333744;
}
.el-main {
  background-color: #eaedf1;
}
</style>
```

æ³¨æ„ï¼šåœ¨`plugins/element.js`æ–‡ä»¶ä¸­è¦å¯¼å…¥ç›¸åº”çš„å¸ƒå±€ç»„ä»¶ã€‚

```js
import Vue from "vue";
import {
  Button,
  Form,
  FormItem,
  Input,
  Message,
  Container,
  Header,
  Aside,
  Main,
} from "element-ui";

Vue.use(Button);
Vue.use(Form);
Vue.use(FormItem);
Vue.use(Input);
Vue.use(Container);
Vue.use(Header);
Vue.use(Aside);
Vue.use(Main);
Vue.prototype.$message = Message;
```

## 2ã€å¤´éƒ¨åŒºåŸŸå¸ƒå±€è®¾è®¡

é¦–å…ˆå¯¹å¤´éƒ¨åŒºåŸŸçš„ç»“æ„åšäº†ä¸€ä¸ªç®€å•çš„ä¿®æ”¹ï¼Œæ·»åŠ äº†`logo`å›¾æ ‡ï¼Œä»¥åŠç›¸åº”çš„æ–‡å­—ã€‚

```vue
<!-- å¤´éƒ¨åŒºåŸŸ -->
<el-header>
      <div class="header-div">
        <img src="../assets/logo.png" alt="logo" />
        <span>ç”µå•†åå°ç®¡ç†ç³»ç»Ÿ</span>
      </div>
      <el-button type="info" @click="logout">é€€å‡º</el-button>
    </el-header>
```

ä¸‹é¢å°±æ˜¯å¯¹å¤´éƒ¨åŒºåŸŸçš„æ ·å¼å¤„ç†

```css
.el-header {
  background-color: #373d41;
  display: flex;
  justify-content: space-between;
  padding-left: 0;
  align-items: center;
  color: #fff;
  font-size: 20px;
}
.header-div {
  display: flex;
  align-items: center;
}
```

## 3ã€å®ç°å¯¼èˆªèœå•çš„åŸºæœ¬ç»“æ„

è¿™é‡Œéœ€è¦äº†è§£`element-ui`ä¸­å¯¼èˆªèœå•çš„åŸºæœ¬ä½¿ç”¨å°±å¯ä»¥ã€‚

```html
<!-- é¡µé¢ä¸»ä½“åŒºåŸŸ -->
<el-container>
  <!-- ä¾§è¾¹æ  -->
  <el-aside width="200px">
    <!--èœå•åŒºåŸŸ-->
    <el-menu
      default-active="2"
      background-color="#545c64"
      text-color="#fff"
      active-text-color="#ffd04b"
    >
      <!-- ä¸€çº§èœå• -->
      <el-submenu index="1">
        <!-- ä¸€çº§èœå•çš„æ¨¡æ¿åŒºåŸŸ -->
        <template slot="title">
          <!-- å›¾æ ‡ -->
          <i class="el-icon-location"></i>
          <!-- æ–‡æœ¬ -->
          <span>å¯¼èˆªä¸€</span>
        </template>
        <!-- äºŒçº§èœå• -->
        <el-menu-item index="1-1">
          <!-- å›¾æ ‡ -->
          <i class="el-icon-location"></i>
          <!-- æ–‡æœ¬ -->
          <span>å¯¼èˆªä¸€</span>
        </el-menu-item>
      </el-submenu>
    </el-menu>
  </el-aside>
  <!-- å³ä¾§å†…å®¹ä¸»ä½“ -->
  <el-main>Main</el-main>
</el-container>
```

è¿™é‡Œæˆ‘ä»¬æ˜¯åœ¨`<el-aside>`å·¦ä¾§åŒºåŸŸæ·»åŠ äº†ä¸€ä¸ªèœå•ï¼Œè€Œä¸”è¿™é‡Œè¦æ±‚èœå•åªä¿ç•™åˆ°äºŒçº§èœå•ã€‚

åœ¨`element.js`æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¯¹èœå•ç»„ä»¶çš„æ³¨å†Œã€‚

```js
import Vue from "vue";
import {
  Button,
  Form,
  FormItem,
  Input,
  Message,
  Container,
  Header,
  Aside,
  Main,
  Menu,
  Submenu,
  MenuItem,
} from "element-ui";

Vue.use(Button);
Vue.use(Form);
Vue.use(FormItem);
Vue.use(Input);
Vue.use(Container);
Vue.use(Header);
Vue.use(Aside);
Vue.use(Main);
Vue.use(Menu);
Vue.use(Submenu);
Vue.use(MenuItem);
Vue.prototype.$message = Message;
```

## 4ã€é€šè¿‡`axios` æ‹¦æˆªå™¨æ·»åŠ `token`éªŒè¯

ç°åœ¨æˆ‘ä»¬é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæƒ³è¦è®¿é—®å—ä¿æŠ¤çš„`API`åº”è¯¥æ€æ ·å¤„ç†å‘¢ï¼Ÿ

å¯¹äº†ï¼Œå¯ä»¥å°†æˆ‘ä»¬å­˜åœ¨`sessionStorage`ä¸­çš„`token`ä¿¡æ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœåˆæ³•ï¼Œè¿è¡Œè®¿é—®å…¶å¯¹åº”çš„æ¥å£ï¼Œ

å…³é”®æ˜¯æ€æ ·å°†`token`ä¿¡æ¯å‘é€åˆ°æœåŠ¡ç«¯å‘¢ï¼Ÿ

å¿…é¡»åœ¨è¯·æ±‚å¤´ä¸­ä½¿ç”¨`Authorization`å­—æ®µæ¥ä¿å­˜`token`æ•°æ®ã€‚è¿™æ—¶é€šè¿‡è¯¥å­—æ®µï¼Œå¯ä»¥å°†`token`æ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ã€‚

è€Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œé™¤äº†ç™»å½•æ¥å£ä¸éœ€è¦`token`æ•°æ®ä»¥å¤–ï¼Œå…¶å®ƒçš„æ¥å£éƒ½æ˜¯éœ€è¦çš„ï¼Œè¿™å°±éœ€è¦åœ¨æ¯ä¸ªè¯·æ±‚æœåŠ¡ç«¯çš„`API`æ¥å£ä¸­éƒ½è¦åŠ ä¸Š`Authorization`å­—æ®µã€‚

é‚£é—®é¢˜æ˜¯æ€æ ·åœ¨æ¯ä¸ªè¯·æ±‚ä¸­éƒ½åŠ ä¸Š`Authorization`å­—æ®µå‘¢ï¼Ÿ

è¿™é‡Œå¯ä»¥é€šè¿‡`axios`è¯·æ±‚æ‹¦æˆªå™¨æ·»åŠ `token`ä¿¡æ¯ã€‚

åŸºæœ¬çš„è¯­æ³•ï¼š

```js
 // axiosè¯·æ±‚æ‹¦æˆª
axios.interceptors.request.use(config => {
    // ä¸ºè¯·æ±‚å¤´å¯¹è±¡ï¼Œæ·»åŠ  Token éªŒè¯çš„ Authorization å­—æ®µ
    config.headers.Authorization = window.sessionStorage.getItem('token')
    return config
}
```

åœ¨`axios`ä¸­çš„`interceptors` å±æ€§ä¸­æœ‰ä¸€ä¸ª`request`,å®ƒå°±æ˜¯`axios`çš„è¯·æ±‚æ‹¦æˆªå™¨ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡ä½¿ç”¨`axios`å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œ`request`è¿™ä¸ªæ‹¦æˆªå™¨ã€‚è¿™æ—¶ä¼šè°ƒç”¨`use`å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è¯·æ±‚åœ¨åˆ°è¾¾æœåŠ¡ç«¯ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ`use`å‡½æ•°ï¼‰ï¼Œåœ¨è¯¥å‡½æ•°çš„å›è°ƒå‡½æ•°ä¸­ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæˆåç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯å°†è¯·æ±‚çš„å†…å®¹åšäº†ä¸€æ¬¡å¤„ç†åï¼Œåœ¨å‘é€åˆ°æœåŠ¡ç«¯ã€‚

å…·ä½“å®ç°å¦‚ä¸‹ï¼Œåœ¨`main.js`æ–‡ä»¶ä¸­ï¼Œåœ¨å°†`axios`æŒ‚è½½åˆ°`Vue`åŸå‹å¯¹è±¡ä¸Šä¹‹å‰ï¼Œå¯ç”¨`axios`çš„æ‹¦æˆªå™¨ã€‚

```js
import axios from "axios";
// é…ç½®è¯·æ±‚çš„è·Ÿè·¯å¾„
axios.defaults.baseURL = "http://127.0.0.1:8888/api/private/v1/";
//axiosæ‹¦æˆªå™¨
axios.interceptors.request.use((config) => {
  // console.log(config)
  config.headers.Authorization = window.sessionStorage.getItem("token");
  //æœ€åå¿…é¡»è¿”å›config
  return config;
});
Vue.prototype.$http = axios;
```

## 5ã€è·å–å·¦ä¾§èœå•æ•°æ®

åœ¨`Home.vue`ä¸­å‘é€è¯·æ±‚ï¼Œè·å–èœå•æ•°æ®ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š

```js
<script>
export default {
  data() {
    return {
      menulist: [],//èœå•æ•°æ®
    };
  },
  created() {
      //è°ƒç”¨getMenuListæ–¹æ³•è·å–èœå•æ•°æ®
    this.getMenuList();
  },
  methods: {
    logout() {
      window.sessionStorage.clear();
      this.$router.push("/login");
    },
    //è·å–èœå•æ•°æ®
    async getMenuList() {
      const { data: res } = await this.$http.get("menus");
      if (res.meta.status !== 200) return this.$message.error(res.meta.msg);
      this.menulist = res.data;
      console.log(res);
    },
  },
};
</script>
```

åœ¨ç»„ä»¶åˆ›å»ºå®Œæˆåï¼Œå‘é€è¯·æ±‚è·å–èœå•æ•°æ®ã€‚

## 6ã€æ¸²æŸ“èœå•ç»“æ„

åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»è·å–åˆ°äº†èœå•æ•°æ®ã€‚ä¸‹é¢è¦å°†èœå•æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚

æ³¨æ„ï¼šæœåŠ¡ç«¯è¿”å›çš„èœå•æ•°æ®çš„æ ¼å¼ã€‚

```html
<!-- ä¸€çº§èœå• -->
<el-submenu :index="item.id + ''" v-for="item in menulist" :key="item.id">
  <!-- ä¸€çº§èœå•çš„æ¨¡æ¿åŒºåŸŸ -->
  <template slot="title">
    <!-- å›¾æ ‡ -->
    <i class="el-icon-location"></i>
    <!-- æ–‡æœ¬ -->
    <span>{{item.authName}}</span>
  </template>
  <!-- äºŒçº§èœå• -->
  <el-menu-item
    :index="subItem.id+''"
    v-for="subItem in item.children"
    :key="subItem.id"
  >
    <!-- å›¾æ ‡ -->
    <i class="el-icon-location"></i>
    <!-- æ–‡æœ¬ -->
    <span>{{subItem.authName}}</span>
  </el-menu-item>
</el-submenu>
```

ç”±äºæœåŠ¡ç«¯è¿”å›çš„èœå•æ•°æ®åªè¦ä¸¤çº§ï¼Œæ‰€ä»¥è¿™é‡Œé€šè¿‡ä¸¤ä¸ª`for`å¾ªç¯åµŒå¥—ï¼Œå°±å¯ä»¥è·å–åˆ°æ‰€æœ‰çš„èœå•æ•°æ®ã€‚

é¦–å…ˆï¼Œç¬¬ä¸€å±‚å¾ªç¯éå†`menulist`,è·å–ä¸€çº§èœå•çš„å†…å®¹ï¼Œæ³¨æ„:`index`å±æ€§çš„å–å€¼åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼Œä¸èƒ½èƒ½ä¸ºæ•°å­—ï¼Œå¹¶ä¸”è¦å”¯ä¸€ï¼Œ

ç„¶åï¼Œç¬¬äºŒå±‚å¾ªç¯éå†`item.children`è·å–äºŒçº§èœå•å†…å®¹ã€‚

æ€è€ƒï¼šå¦‚æœæ˜¯å¤šå±‚èœå•ï¼ˆä¸æ­¢äºŒå±‚ï¼‰åº”è¯¥æ€æ ·å¤„ç†ï¼Ÿ

## 7ã€èœå•å›¾æ ‡å¤„ç†

åœ¨`Home.vue`ç»„ä»¶ä¸­æ›´æ¢èœå•åç§°å‰é¢çš„å›¾æ ‡ã€‚

è¿™é‡Œä¸€çº§èœå•çš„å›¾æ ‡ï¼Œä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„å›¾æ ‡ã€‚

```js
 data() {
    return {
      menulist: [],
      // èœå•å›¾æ ‡
      iconsObj: {
        "125": "iconfont icon-user",
        "103": "iconfont icon-tijikongjian",
        "101": "iconfont icon-shangpin",
        "102": "iconfont icon-danju",
        "145": "iconfont icon-baobiao",
      },
    };
  },
```

`iconsObj` å¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯ä¸€çº§èœå•çš„ç¼–å·ä¸å›¾æ ‡æ ·å¼çš„å¯¹åº”å…³ç³»ã€‚

```html
<!-- å›¾æ ‡ -->
<i :class="iconsObj[item.id]"></i>
```

è¿™é‡Œå¯¹ä¸€çº§èœå•çš„æ ·å¼è¿›è¡ŒåŠ¨æ€çš„ç»‘å®šï¼Œä»`iconsObj`å¯¹è±¡ä¸­æ ¹æ®èœå•ç¼–å·è·å–å…·ä½“çš„æ ·å¼ã€‚

äºŒçº§èœå•é‡‡ç”¨å›ºå®šçš„å›¾æ ‡

```html
<!-- å›¾æ ‡ -->
<i class="el-icon-menu"></i>
```

è°ƒæ•´å›¾æ ‡ä¸èœå•åç§°ä¹‹é—´çš„å¡«å……è·ã€‚

```css
.iconfont {
  margin-right: 10px;
}
```

ä¸‹é¢æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœå°±æ˜¯æ¯æ¬¡åªæ‰“å¼€ä¸€ä¸ªèœå•é¡¹ã€‚

è¿™é‡Œéœ€è¦ç»™`<el-menu>`æ·»åŠ `unique-opened`å±æ€§å°±å¯ä»¥äº†ã€‚

åŒæ—¶ï¼Œå½“æˆ‘ä»¬å•å‡»ï¼ŒäºŒçº§èœå•çš„æ—¶å€™ï¼Œå‘ç°èœå•è¶…å‡ºäº†æŒ‡å®šåŒºåŸŸï¼Œè¿™é‡Œåªéœ€è¦å°†`<el-menu>`çš„è¾¹æ¡†å»æ‰å°±å¯ä»¥äº†ã€‚

```
 .el-menu {
    border-right: none;
  }
```

## 8ã€å·¦ä¾§èœå•çš„æŠ˜å ä¸å±•å¼€æ•ˆæœ

é¦–å…ˆåœ¨ä¾§è¾¹æ ä¸‹é¢æ·»åŠ ä¸€ä¸ªæŠ˜å çš„å›¾æ ‡ã€‚

```html
<!-- ä¾§è¾¹æ  -->
<el-aside width=" 200px">
  <div class="toggle-button" @click="toggleCollapse">|||</div></el-aside
>
```

ä¸‹é¢å®šä¹‰å¯¹åº”çš„æ ·å¼

```css
.toggle-button {
  background-color: #4a5064;
  font-size: 10px;
  line-height: 24px;
  color: #fff;
  text-align: center;
  letter-spacing: 0.2em;
  cursor: pointer;
}
```

æ§åˆ¶èœå•çš„æŠ˜å ä¸å±•å¼€ï¼Œéœ€è¦ç»™`el-menu`æ·»åŠ `collapse`å±æ€§ï¼Œè¯¥å±æ€§ä¸º`true`,è¡¨ç¤ºå±•å¼€èœå•ï¼Œä¸º`false`æŠ˜å èœå•ã€‚

åŒæ—¶ï¼Œå¯ä»¥ç»™`el-menu`æ·»åŠ å±æ€§`collapse-transition`å°†èœå•æŠ˜å çš„åŠ¨ç”»å»æ‰ï¼Œä¸º`false`çš„æ—¶å€™å°±å¯ä»¥å»æ‰ã€‚

```html
<el-menu
  default-active="2"
  background-color="#545c64"
  text-color="#fff"
  active-text-color="#409EFF"
  unique-opened
  :collapse="isCollapse"
  :collapse-transition="false"
></el-menu>
```

`isCollapse`å±æ€§çš„å®šä¹‰å¦‚ä¸‹ï¼š

```js
 data() {
    return {
      menulist: [],
      // èœå•å›¾æ ‡
      iconsObj: {
        "125": "iconfont icon-user",
        "103": "iconfont icon-tijikongjian",
        "101": "iconfont icon-shangpin",
        "102": "iconfont icon-danju",
        "145": "iconfont icon-baobiao",
      },
      // æ˜¯å¦æŠ˜å 
      isCollapse: false,
    };
```

`isCollapse`å±æ€§é»˜è®¤å€¼ä¸º`false`,è¡¨ç¤ºèœå•æ˜¯ä¸æŠ˜å çš„ã€‚

å½“å•å‡»äº†æŒ‰é’®åï¼Œåœ¨`toggleCollapse`æ–¹æ³•ä¸­ä¿®æ”¹`isCollapse`å±æ€§,æ§åˆ¶èœå•çš„éšè—åŸŸå±•ç¤º

```js
 // ç‚¹å‡»æŒ‰é’®ï¼Œåˆ‡æ¢èœå•çš„æŠ˜å ä¸å±•å¼€
    toggleCollapse() {
      this.isCollapse = !this.isCollapse;
    },
```

ç”±äºæ•´ä¸ªèœå•æ‰€åœ¨çš„å·¦ä¾§åŒºåŸŸçš„å®½åº¦åœ¨è¿™é‡Œï¼Œéƒ½å›ºå®šæ­»äº†ï¼Œä¸º`200px`.

```html
<el-aside width=" 200px"></el-aside>
```

è¿™æ ·å¯¼è‡´çš„ç»“æœå°±æ˜¯ï¼Œå½“èœå•æŠ˜å èµ·æ¥ä»¥åï¼Œæ•´ä¸ªå·¦ä¾§åŒºåŸŸçš„å®½åº¦æ²¡æœ‰æ”¹å˜ï¼Œè¿™æ ·æ•ˆæœæ¯”è¾ƒå·®ã€‚

```html
<el-aside :width="isCollapse ? '64px' : '200px'"></el-aside>
```

æ‰€ä»¥è¿™é‡Œæ ¹æ®èœå•æ˜¯å¦æŠ˜å ï¼ŒåŠ¨æ€ä¿®æ”¹å·¦ä¾§åŒºåŸŸçš„å®½åº¦ã€‚

## 9ã€å®ç°é¦–é¡µè·¯ç”±çš„é‡å®šå‘

å½“ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œä¼šå±•ç¤º`Home`ç»„ä»¶çš„å†…å®¹ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬è¿˜æƒ³å±•ç¤ºä¸€ä¸ªæ¬¢è¿ç»„ä»¶ä¸­çš„å†…å®¹ã€‚

è¿™é‡Œå¯ä»¥ä½¿ç”¨å­è·¯ç”±ä»¥åŠè·¯ç”±é‡å®šå‘æ¥å®ç°ã€‚

ä¸‹é¢ï¼Œå…ˆåœ¨`components`ä¸­å®šä¹‰ä¸€ä¸ªæ¬¢è¿çš„ç»„ä»¶`Welcome.vue`

```vue
<template>
  <div>
    <h2>æ¬¢è¿ç™»å½•ç”µå•†ç®¡ç†ç³»ç»Ÿ</h2>
  </div>
</template>
```

æ³¨æ„ï¼šå¦‚æœç»„ä»¶ä¸­åªæ˜¯å±•ç¤ºå›ºå®šçš„å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰æ ·å¼ï¼Œå¯ä»¥åªå†™ä¸€ä¸ª`template`æ¨¡æ¿ã€‚

ä¿®æ”¹`router.js`æ–‡ä»¶ä¸­çš„è·¯ç”±è§„åˆ™ï¼š

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
//å¯¼å…¥Welcomeç»„ä»¶
import Welcome from "./components/Welcome.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [{ path: "/welcome", component: Welcome }],
    },
  ],
});
```

å½“ç”¨æˆ·è®¿é—®`/home`çš„æ—¶å€™ï¼Œå…ˆå‘ˆç°å‡º`Home`ç»„ä»¶çš„å†…å®¹ï¼Œç„¶åé‡å®šå‘åˆ°`/welcome`ï¼Œè¿™æ—¶ä¼šå±•ç¤º`Welcome`ç»„ä»¶çš„å†…å®¹ã€‚

é‚£ä¹ˆ`Welcome`ç»„ä»¶çš„å†…å®¹æ˜¯åœ¨`Home`ç»„ä»¶ä¸­è¿›è¡Œå±•ç¤ºï¼Œæ‰€ä»¥éœ€è¦åœ¨`Home`ç»„ä»¶ä¸­ä½¿ç”¨` <router-view>`æ·»åŠ ä¸€ä¸ªå ä½ç¬¦ã€‚

```html
<!-- å³ä¾§å†…å®¹ä¸»ä½“ -->
<el-main>
  <router-view></router-view>
</el-main>
```

è¿™é‡Œåœ¨`Home`ç»„ä»¶çš„å³ä¾§å†…å®¹ä¸»ä½“åŒºåŸŸå±•ç¤º`Welcome`ç»„ä»¶çš„å†…å®¹ã€‚

## 10ã€å¯ç”¨èœå•é“¾æ¥åŠŸèƒ½

è¦æƒ³è®©`element-ui`çš„èœå•å…·æœ‰é“¾æ¥åŠŸèƒ½ï¼Œéœ€è¦ä¸ºèœå•æ·»åŠ ` router`å±æ€§ï¼Œé»˜è®¤å€¼ä¸º`true`,è¡¨ç¤ºå¯ç”¨è¶…é“¾æ¥åŠŸèƒ½ã€‚

```html
<el-menu
  default-active="2"
  background-color="#545c64"
  text-color="#fff"
  active-text-color="#409EFF"
  unique-opened
  :collapse="isCollapse"
  :collapse-transition="false"
  router
  <!--å¯ç”¨é“¾æ¥--
>
  ></el-menu
>
```

å½“å•å‡»äºŒçº§èœå•çš„æ—¶å€™ï¼Œè¦è·³è½¬åˆ°å…·ä½“çš„é¡µé¢ã€‚

é‚£ä¹ˆåœ°å€åº”è¯¥æ€æ ·ç¡®å®šå‘¢ï¼Ÿ

å½“å•å‡»äºŒçº§èœå•çš„æ—¶å€™ï¼Œå‘ç°æ¨¡æ‹Ÿçš„å€¼ä¸º`<el-menu-item>`çš„`index`å±æ€§çš„å–å€¼ã€‚

æ‰€ä»¥è¿™é‡Œéœ€è¦å°†`index`çš„å€¼ï¼Œä¿®æ”¹æˆèœå•çš„åœ°å€ï¼Œè€Œè¿™ä¸ªåœ°å€æ•°æ®æ˜¯æœåŠ¡ç«¯è¿”å›çš„ã€‚

æ‰€ä»¥ä¿®æ”¹åçš„å†…å®¹å¦‚ä¸‹ï¼š

```html
<el-menu-item
  :index="'/' + subItem.path"
  v-for="subItem in item.children"
  :key="subItem.id"
>
  <!-- å›¾æ ‡ -->
  <i class="el-icon-menu"></i>
  <!-- æ–‡æœ¬ -->
  <span>{{subItem.authName}}</span>
</el-menu-item>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¿®æ”¹äº†`index`å±æ€§çš„å–å€¼ï¼Œæ³¨æ„è·¯å¾„å‰é¢è¦åŠ ä¸Š`/`.

# å››ã€ç”¨æˆ·åˆ—è¡¨å¸ƒå±€å’ŒåŠŸèƒ½å®ç°

## 1ã€ç”¨æˆ·åˆ—è¡¨åŸºæœ¬å±•ç¤º

å½“å•å‡»èœå•â€œç”¨æˆ·åˆ—è¡¨â€çš„æ—¶å€™ï¼Œå°†ç”¨æˆ·åˆ—è¡¨ç»„ä»¶ï¼Œåœ¨å…¶å³ä¾§è¿›è¡Œå±•ç¤ºã€‚

é¦–å…ˆï¼Œåœ¨`components`ç›®å½•ä¸‹é¢åˆ›å»º`user`ç›®å½•ï¼Œè¯¥ç›®å½•å­˜æ”¾çš„å°±æ˜¯ç”¨æˆ·åˆ—è¡¨ç»„ä»¶`Users.vue`.

```html
<template>
  <div>ç”¨æˆ·åˆ—è¡¨</div>
</template>
<script>
  export default {};
</script>
<style scoped></style>
```

åœ¨`router.js`æ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±è§„åˆ™ã€‚

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
      ],
    },
  ],
});
```

åœ¨`Home`æ·»åŠ å­è·¯ç”±ï¼Œè¿™æ ·å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯`/users`ï¼Œé‚£ä¹ˆä¼šå±•ç¤º`User`ç»„ä»¶çš„å†…å®¹ï¼Œå¹¶ä¸”æ˜¯åœ¨`Home`ç»„ä»¶çš„"å³ä¾§å†…å®¹ä¸»ä½“"åŒºåŸŸå±•ç¤º

```html
<!-- å³ä¾§å†…å®¹ä¸»ä½“ -->
<el-main>
  <router-view></router-view>
</el-main>
```

## 2ã€ä¿å­˜èœå•çš„æ¿€æ´»çŠ¶æ€

å½“å•å‡»äº†æŸä¸ªèœå•é¡¹ä»¥åï¼Œåº”è¯¥è®©è¯¥èœå•é«˜äº®æ˜¾ç¤ºï¼ŒåŒæ—¶å¦‚æœç”¨æˆ·å•å‡»åˆ·æ–°æŒ‰é’®ï¼Œä¹Ÿåº”è¯¥èƒ½å¤Ÿä¿æŒèœå•çš„é«˜äº®æ˜¾ç¤ºã€‚

è¿™é‡Œéœ€è¦ç»™`<el-menu>`æ·»åŠ `default-active`å±æ€§æ¥å®ç°ï¼Œå¦‚æœè¯¥å±æ€§çš„å€¼ä¸º`/users`ï¼ˆèœå•çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯`index`å±æ€§çš„å€¼ï¼‰ï¼Œè¡¨æ˜ç”¨æˆ·åˆ—è¡¨è¿™ä¸ªèœå•è¢«é€‰ä¸­ã€‚

é¦–å…ˆï¼Œè®©`default-active`å±æ€§ç»‘å®šä¸€ä¸ªåŠ¨æ€å€¼`activePath`,é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

```html
<el-menu <!--æ·»åŠ default-active-->
  :default-active="activePath" background-color="#545c64" text-color="#fff"
  active-text-color="#409EFF" unique-opened :collapse="isCollapse"
  :collapse-transition="false" router ></el-menu
>
```

`activePath`å±æ€§çš„å®šä¹‰å¦‚ä¸‹ï¼š

```js
  data() {
    return {
      menulist: [],
      iconsObj: {
        "125": "iconfont icon-user",
        "103": "iconfont icon-tijikongjian",
        "101": "iconfont icon-shangpin",
        "102": "iconfont icon-danju",
        "145": "iconfont icon-baobiao",
      },
      isCollapse: false,
      // è¢«æ¿€æ´»çš„é“¾æ¥åœ°å€
      activePath: "",
    };
  },
```

ä¸‹é¢ï¼Œæˆ‘ä»¬è¦è€ƒè™‘çš„å°±æ˜¯ï¼Œå•å‡»äº†å“ªä¸ªäºŒçº§èœå•ï¼Œå°±éœ€è¦å°†å¯¹åº”çš„åœ°å€èµ‹å€¼ç»™`activePath`å±æ€§ã€‚

```html
<!-- äºŒçº§èœå• -->
<el-menu-item
  :index="'/' + subItem.path"
  v-for="subItem in item.children"
  :key="subItem.id"
  @click="saveNavState('/' + subItem.path)"
></el-menu-item>
```

åœ¨ä¸Šé¢çš„ä»£ç æ‰¾ä¸­ï¼Œæˆ‘ä»¬ç»™äºŒçº§èœå•æ·»åŠ äº†å•å‡»äº‹ä»¶ï¼Œå½“äº‹ä»¶è§¦å‘åæ‰§è¡Œ`saveNavState`æ–¹æ³•ï¼Œå°†æ‰€å•å‡»çš„èœå•çš„è·¯å¾„ä½œä¸ºå‚æ•°ä¼ é€’åˆ°è¯¥æ–¹æ³•ä¸­ï¼Œ

åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå°†ä¼ é€’è¿‡æ¥çš„èœå•çš„åœ°å€èµ‹å€¼ç»™`activePath`å±æ€§ã€‚

```js
 // ä¿å­˜é“¾æ¥çš„æ¿€æ´»çŠ¶æ€
    saveNavState(activePath) {
      window.sessionStorage.setItem('activePath', activePath)
      this.activePath = activePath
    }
```

åŒæ—¶ï¼Œè¿™é‡Œè¿˜è¦è€ƒè™‘å½“å•å‡»åˆ·æ–°æŒ‰é’®çš„æ—¶å€™ï¼Œä¹Ÿè¦ä¿æŒå½“å‰æ‰€å•å‡»èœå•çš„é€‰ä¸­çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯é«˜äº®çŠ¶æ€ï¼Œæ‰€ä»¥å°†æ‰€å•å‡»çš„èœå•çš„åœ°å€å­˜å‚¨åˆ°äº†`sessionStorage`ä¸­ã€‚

è€Œå½“ç‚¹å‡»æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ`created`è¿™ä¸ªé’©å­å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åœ¨è¯¥é’©å­å‡½æ•°ä¸­ï¼ŒæŠŠ`sessionStorage`ä¸­å­˜å‚¨çš„åœ°å€å–å‡ºæ¥ï¼Œäº¤ç»™`activePath`å±æ€§ã€‚

## 3ã€ç”¨æˆ·åˆ—è¡¨åŸºæœ¬å¸ƒå±€å®ç°

åœ¨ç”¨æˆ·åˆ—è¡¨çš„åŸºæœ¬å¸ƒå±€ä¸­ï¼Œåˆ›å»ºäº†é¢åŒ…å±‘ï¼ŒåŒæ—¶åˆ›å»ºäº†å¡ç‰‡åŒºåŸŸï¼Œåœ¨å¡ç‰‡åŒºåŸŸä¸­é€šè¿‡`el-row`ä¸`el-col`è¿›è¡Œäº†æ …æ ¼å¸ƒå±€ã€‚

```html
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>ç”¨æˆ·ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>ç”¨æˆ·åˆ—è¡¨</el-breadcrumb-item>
    </el-breadcrumb>
    <!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
    <el-card>
      <!-- æœç´¢ä¸æ·»åŠ åŒºåŸŸï¼Œgutterï¼šæ …æ ¼é—´éš” -->
      <el-row :gutter="20">
        <!--å 8åˆ—-->
        <el-col :span="8">
          <el-input placeholder="è¯·è¾“å…¥å†…å®¹">
            <el-button slot="append" icon="el-icon-search"></el-button>
          </el-input>
        </el-col>
        <el-col :span="4">
          <el-button type="primary">æ·»åŠ ç”¨æˆ·</el-button>
        </el-col>
      </el-row>
    </el-card>
  </div>
</template>
<script>
  export default {};
</script>
<style scoped></style>
```

åŒæ—¶éœ€è¦åœ¨`element.js`æ–‡ä»¶ä¸­å®Œæˆç»„ä»¶çš„æ³¨å†Œã€‚

```js
Vue.use(Breadcrumb);
Vue.use(BreadcrumbItem);
Vue.use(Card);
Vue.use(Row);
Vue.use(Col);
```

å¦‚æœéœ€è¦ä¿®æ”¹å…¨å±€çš„æ ·å¼ï¼Œå®šä¹‰åœ¨`assets/css/global.css`æ–‡ä»¶ä¸­ã€‚

```css
/* å…¨å±€æ ·å¼è¡¨ */
html,
body,
#app {
  height: 100%;
  margin: 0;
  padding: 0;
}
.el-breadcrumb {
  margin-bottom: 15px;
  font-size: 12px;
}

.el-card {
  box-shadow: 0 1px 1px rgba(0, 0, 0, 0.15) !important;
}
```

## 4ã€è·å–ç”¨æˆ·åˆ—è¡¨æ•°æ®

åœ¨`Users.vue`ç»„ä»¶ä¸­çš„`created`é’©å­å‡½æ•°ä¸­ï¼Œæ„å»ºè¯·æ±‚ï¼Œè·å–ç”¨æˆ·æ•°æ®ï¼Œè¿™æ¬¡è¯·æ±‚çš„æ–¹å¼ä¸º`get`è¯·æ±‚ï¼Œå¹¶ä¸”éœ€è¦å‚æ•°ã€‚

```js
<script>
export default {
  data() {
    return {
      // è·å–ç”¨æˆ·åˆ—è¡¨çš„å‚æ•°å¯¹è±¡
      queryInfo: {
        query: "",
        // å½“å‰çš„é¡µæ•°
        pagenum: 1,
        // å½“å‰æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
        pagesize: 2,
      },
      userlist: [],
      total: 0,
    };
  },
  created() {
    this.getUserList();
  },
  methods: {
    async getUserList() {
      const { data: res } = await this.$http.get("users", {
          //é€šè¿‡paramsç»„ç»‡å‚æ•°ã€‚
        params: this.queryInfo,
      });
      if (res.meta.status !== 200) {
        return this.$message.error("è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥ï¼");
      }
        //è·å–ç”¨æˆ·æ•°æ®
      this.userlist = res.data.users;
        //è·å–æ€»çš„è®°å½•æ•°ã€‚
      this.total = res.data.total;
      console.log(res);
    },
  },
};
</script>
```

## 5ã€ä½¿ç”¨è¡¨æ ¼å±•ç¤ºç”¨æˆ·æ•°æ®

è¡¨æ ¼åŸºæœ¬ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œå…·ä½“çš„ç»†èŠ‚å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚

æˆ‘ä»¬æ˜¯åœ¨`el-card`ä¸­ï¼Œç›´æ¥æ·»åŠ äº†è¡¨æ ¼å†…å®¹ã€‚

```html
<!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
<el-card>
  <!-- æœç´¢ä¸æ·»åŠ åŒºåŸŸ -->
  <el-row :gutter="20">
    <el-col :span="8">
      <el-input placeholder="è¯·è¾“å…¥å†…å®¹">
        <el-button slot="append" icon="el-icon-search"></el-button>
      </el-input>
    </el-col>
    <el-col :span="4">
      <el-button type="primary">æ·»åŠ ç”¨æˆ·</el-button>
    </el-col>
  </el-row>
  <!-- ç”¨æˆ·åˆ—è¡¨åŒºåŸŸ -->
  <el-table :data="userlist" border stripe>
    <el-table-column type="index"></el-table-column>
    <el-table-column label="å§“å" prop="username"></el-table-column>
    <el-table-column label="é‚®ç®±" prop="email"></el-table-column>
    <el-table-column label="ç”µè¯" prop="mobile"></el-table-column>
    <el-table-column label="è§’è‰²" prop="role_name"></el-table-column>
    <el-table-column label="çŠ¶æ€"></el-table-column>
    <el-table-column label="æ“ä½œ"></el-table-column>
  </el-table>
</el-card>
```

ç»™è¡¨æ ¼æŒ‡å®šäº†æ•°æ®æºï¼Œè¾¹æ¡†ï¼Œä»¥åŠå„è¡Œæ¢è‰²çš„åŠŸèƒ½ã€‚

åŒæ—¶ç»™è¡¨æ ¼æ·»åŠ äº†è¡¨å¤´ï¼Œä»¥åŠé€šè¿‡`prop`æŒ‡å®šæ¯åˆ—æ‰€å±•ç¤ºçš„æ•°æ®ã€‚

åœ¨`element.js`æ–‡ä»¶ä¸­å®Œæˆå¯¹è¡¨æ ¼ç»„ä»¶çš„æ³¨å†Œã€‚

```js
Vue.use(Table);
Vue.use(TableColumn);
```

å¯ä»¥åœ¨`global.css`ä¸­å¯¹è¡¨æ ¼çš„æ ·å¼è¿›è¡Œé‡å†™ã€‚

```css
.el-table {
  margin-top: 15px;
  font-size: 12px;
}
```

## 6ã€è‡ªå®šä¹‰çŠ¶æ€åˆ—çš„æ˜¾ç¤ºæ•ˆæœ

åœ¨è¡¨æ ¼çš„çŠ¶æ€è¿™ä¸€åˆ—ä¸Šæ·»åŠ ä¸€ä¸ª`switch`å¼€å…³ï¼Œå¦‚æœè·å–åˆ°çš„çŠ¶æ€æ˜¯`true`,åˆ™è®©`switch`å¼€å…³å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå¦åˆ™å¤„äºå…³é—­çŠ¶æ€ã€‚

åœ¨è¡¨æ ¼çš„çŠ¶æ€è¿™ä¸€åˆ—ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªä½œç”¨åŸŸçš„æ’æ§½ï¼ˆå¯ä»¥é€šè¿‡`scope`æ¥è·å–åˆ°å½“å‰è¡Œçš„æ•°æ®ï¼‰ï¼Œåœ¨æ’æ§½ä¸­ä½¿ç”¨äº†`el-switch`ç»„ä»¶ã€‚

```html
<el-table-column label="çŠ¶æ€">
  <template slot-scope="scope">
    <el-switch v-model="scope.row.mg_state"></el-switch>
  </template>
</el-table-column>
```

åœ¨`element.js`æ–‡ä»¶ä¸­ä¹Ÿéœ€è¦å®Œæˆ`Switch`ç»„ä»¶çš„æ³¨å†Œ

```
Vue.use(Switch);
```

æ’æ§½çš„é—®é¢˜ã€‚

## 7ã€è‡ªå®šä¹‰æ“ä½œåˆ—

å…³äºç”¨æˆ·åˆ—è¡¨ä¸­çš„æ“ä½œåˆ—ï¼Œä¹Ÿæ˜¯é€šè¿‡ä½œç”¨åŸŸæ’æ§½æ¥å®Œæˆçš„ã€‚

å› ä¸ºï¼Œæˆ‘ä»¬åœ¨å•å‡»åˆ é™¤æŒ‰é’®ï¼Œæˆ–è€…æ˜¯ç¼–è¾‘æŒ‰é’®çš„æ—¶å€™æ˜¯å¯ä»¥é€šè¿‡`scope`æ¥è·å–å¯¹åº”ç”¨æˆ·çš„ç¼–å·çš„ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæŠŠåŸºæœ¬ç»“æ„åˆ›å»ºå‡ºæ¥ï¼ŒåæœŸåœ¨å®Œå–„ä½œç”¨åŸŸæ’æ§½ã€‚

```html
<el-table-column label="æ“ä½œ" width="180px">
  <template>
    <!-- ä¿®æ”¹æŒ‰é’® -->
    <el-button type="primary" icon="el-icon-edit" size="mini"></el-button>
    <!-- åˆ é™¤æŒ‰é’® -->
    <el-button type="danger" icon="el-icon-delete" size="mini"></el-button>
    <!-- åˆ†é…è§’è‰²æŒ‰é’® -->
    <el-tooltip
      effect="dark"
      content="åˆ†é…è§’è‰²"
      placement="top"
      :enterable="false"
    >
      <el-button type="warning" icon="el-icon-setting" size="mini"></el-button>
    </el-tooltip>
  </template>
</el-table-column>
```

åŒæ—¶åœ¨`element.js`æ–‡ä»¶ä¸­å¯¼å…¥`Tooltip`ç»„ä»¶ã€‚

```
Vue.use(Tooltip);
```

## 8ã€å®ç°åˆ†é¡µæ•ˆæœ

åœ¨`Users.vue`ç»„ä»¶ä¸­ä½¿ç”¨åˆ†é¡µç»„ä»¶å®Œæˆåˆ†é¡µã€‚

åœ¨`el-table`ä¸‹é¢æ·»åŠ åˆ†é¡µç»„ä»¶ã€‚

```html
<!-- åˆ†é¡µåŒºåŸŸ -->
<el-pagination
  @size-change="handleSizeChange"
  @current-change="handleCurrentChange"
  :current-page="queryInfo.pagenum"
  :page-sizes="[1, 2, 5, 10]"
  :page-size="queryInfo.pagesize"
  layout="total, sizes, prev, pager, next, jumper"
  :total="total"
></el-pagination>
```

å¯¹åº”å¤„ç†å‡½æ•°

```js
  // ç›‘å¬ pagesize æ”¹å˜çš„äº‹ä»¶ï¼Œå½“æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°å‘ç”Ÿæ”¹å˜äº†ï¼Œé‡æ–°è·å–æ•°æ®ã€‚
    handleSizeChange(newSize) {
      // console.log(newSize)
      this.queryInfo.pagesize = newSize;
      this.getUserList();
    },
    // ç›‘å¬ é¡µç å€¼ æ”¹å˜çš„äº‹ä»¶,å½“é¡µç å€¼å‘ç”Ÿæ”¹å˜äº†ï¼Œé‡æ–°è·å–æ•°æ®
    handleCurrentChange(newPage) {
      console.log(newPage);
      this.queryInfo.pagenum = newPage;
      this.getUserList();
    },
```

æ³¨å†Œ`Pagination`ç»„ä»¶

```
Vue.use(Pagination);
```

ä¹Ÿå¯ä»¥åœ¨`global.css`ä¸­ä¿®æ”¹å¯¹åº”çš„æ ·å¼ã€‚

## 9ã€ä¿®æ”¹ç”¨æˆ·çŠ¶æ€

å½“å•å‡»`Switch`ç»„ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å®Œæˆç”¨æˆ·çŠ¶æ€çš„æ›´æ–°ã€‚

å½“`Switch`ç»„ä»¶æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘`change`äº‹ä»¶ã€‚

```html
<template slot-scope="scope">
  <el-switch
    v-model="scope.row.mg_state"
    @change="userStateChanged(scope.row)"
  ></el-switch>
</template>
```

åœ¨è¿™é‡Œæˆ‘ä»¬å°†`scope.row.mg_state`ä¸`switch`è¿›è¡Œäº†åŒå‘æ•°æ®ç»‘å®šï¼Œå¦‚æœ`mg_state`å±æ€§çš„å€¼ä¸º`false`,è¡¨ç¤º`switch`å…³é—­çŠ¶æ€ï¼Œå¦åˆ™å°±æ˜¯æ‰“å¼€çŠ¶æ€ã€‚

åä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æ‰‹åŠ¨çš„ä¿®æ”¹äº†`switch`ç»„ä»¶çš„çŠ¶æ€ï¼Œé‚£ä¹ˆ`mg_state` çš„å€¼ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚

å‡å¦‚æˆ‘ä»¬ç°åœ¨å°†ä¸€ä¸ª`switch`ç»„ä»¶çš„çŠ¶æ€æœ‰å…³é—­çŠ¶æ€ä¿®æ”¹æˆæ‰“å¼€çš„çŠ¶æ€ï¼Œé‚£ä¹ˆ`mg_state`çš„å€¼ä¹Ÿä¼šæœ‰`false`å˜æˆ`true`,é‚£ä¹ˆæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å‘é€ä¸€ä¸ªå¼‚æ­¥çš„è¯·æ±‚ï¼Œå°†è¿™ä¸ªæ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ï¼Œä»è€Œå®Œæˆå½“å‰ç”¨æˆ·çŠ¶æ€çš„æ›´æ–°ã€‚

```js
   // ç›‘å¬ switch å¼€å…³çŠ¶æ€çš„æ”¹å˜
    async userStateChanged(userinfo) {
      //console.log(userinfo);
      const { data: res } = await this.$http.put(
        `users/${userinfo.id}/state/${userinfo.mg_state}`
      );
      if (res.meta.status !== 200) {
        userinfo.mg_state = !userinfo.mg_state;
        return this.$message.error("æ›´æ–°ç”¨æˆ·çŠ¶æ€å¤±è´¥ï¼");
      }
      this.$message.success("æ›´æ–°ç”¨æˆ·çŠ¶æ€æˆåŠŸï¼");
    },
```

æ³¨æ„ï¼šè¿™é‡Œå‘é€è¯·æ±‚çš„æ–¹å¼ä¸º`put`.

åŒæ—¶è¿˜éœ€è¦æ³¨æ„ï¼šå¦‚æœæ›´æ–°æ•°æ®åº“å¤±è´¥äº†ï¼Œæˆ‘ä»¬è¦å°†`switch`ç»„ä»¶çš„çŠ¶æ€è¿›è¡Œè¿˜åŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰‹åŠ¨çš„ä¿®æ”¹ äº†`switch`ç»„ä»¶çš„çŠ¶æ€ï¼ˆå‡å¦‚é»˜è®¤çŠ¶æ€æ˜¯å…³é—­çŠ¶æ€ï¼‰ï¼Œåœ¨é¡µé¢ä¸Šå·²ç»å‘ˆç°äº†æ‰“å¼€çŠ¶æ€ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ•°æ®åº“æ›´æ–°å¤±è´¥äº†ï¼Œéœ€è¦å°†`switch`ç»„ä»¶çš„çŠ¶æ€æœ‰æ‰“å¼€çŠ¶æ€è¿˜åŸåˆ°å…³é—­çŠ¶æ€ã€‚

## 10ã€ç”¨æˆ·æœç´¢åŠŸèƒ½å®ç°

```html
<el-col :span="8">
  <el-input
    placeholder="è¯·è¾“å…¥å†…å®¹"
    v-model="queryInfo.query"
    clearable
    @clear="getUserList"
  >
    <el-button
      slot="append"
      icon="el-icon-search"
      @click="getUserList"
    ></el-button>
  </el-input>
</el-col>
```

å°†æœç´¢æ¡†ä¸`queryInfo.query`å±æ€§è¿›è¡ŒåŒå‘æ•°æ®ç»‘å®šï¼ŒåŒæ—¶ç»™æœç´¢æ¡†å³ä¾§æ·»åŠ ä¸€ä¸ªåˆ é™¤çš„å›¾æ ‡ï¼Œå•å‡»åˆ é™¤çš„å›¾æ ‡ä¼šå°†ç”¨æˆ·åœ¨æœç´¢æ¡†ä¸­è¾“å…¥çš„å†…å®¹æ¸…ç©ºï¼ŒåŒæ—¶è§¦å‘`@clear`äº‹ä»¶ï¼Œè°ƒç”¨`getUserList`æ–¹æ³•ï¼Œè¿™æ—¶å°±ä¼šæŸ¥è¯¢å‡ºæ‰€æœ‰çš„ç”¨æˆ·æ•°æ®ã€‚

å½“ç”¨æˆ·åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å®Œæœç´¢çš„æ¡ä»¶åï¼Œå•å‡»æœç´¢æŒ‰é’®è§¦å‘å•å‡»äº‹ä»¶ï¼Œè°ƒç”¨`getUserList`æ–¹æ³•ï¼Œè¿™æ—¶ç”±äºæœç´¢æ¡†ä¸`query`å±æ€§è¿›è¡Œäº†åŒå‘æ•°æ®ç»‘å®šï¼Œæ‰€ä»¥`query`å±æ€§ä¸­å­˜å‚¨äº†ç”¨æˆ·è¾“å…¥çš„æœç´¢æ¡ä»¶ï¼Œè¿™æ ·åœ¨è°ƒç”¨`getUserList`æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå°†æœç´¢æ¡ä»¶å‘é€æœåŠ¡ç«¯ï¼Œä»è€Œå®Œæˆæ•°æ®çš„æœç´¢ã€‚

# äº”ã€ç”¨æˆ·æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤åŠŸèƒ½å®ç°

## 1ã€å±•ç¤ºç”¨æˆ·æ·»åŠ å¯¹è¯æ¡†

å¯¹è¯æ¡†çš„å±•ç¤ºéœ€è¦ç”¨åˆ°`Dialog`ç»„ä»¶ã€‚

åœ¨`el-card`ç»„ä»¶ä¸‹é¢æ·»åŠ å¯¹è¯æ¡†

```html
<!-- æ·»åŠ ç”¨æˆ·çš„å¯¹è¯æ¡† -->
<el-dialog title="æ·»åŠ ç”¨æˆ·" :visible.sync="addDialogVisible" width="50%">
  <!-- åº•éƒ¨åŒºåŸŸ -->
  <span slot="footer" class="dialog-footer">
    <el-button @click="addDialogVisible = false">å– æ¶ˆ</el-button>
    <el-button type="primary" @click="addDialogVisible = false"
      >ç¡® å®š</el-button
    >
  </span>
</el-dialog>
```

é€šè¿‡å±æ€§`addDialogVisible`æ§åˆ¶å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—ã€‚

```json
data() {
    return {
      // è·å–ç”¨æˆ·åˆ—è¡¨çš„å‚æ•°å¯¹è±¡
      queryInfo: {
        query: "",
        // å½“å‰çš„é¡µæ•°
        pagenum: 1,
        // å½“å‰æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
        pagesize: 2,
      },
      userlist: [],
      total: 0,
      // æ§åˆ¶æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      addDialogVisible: false,
    };
```

å½“å•å‡»å¯¹è¯æ¡†ä¸­çš„â€œå–æ¶ˆâ€æŒ‰é’®å’Œâ€œç¡®å®šâ€æŒ‰é’®çš„æ—¶å€™ï¼Œéƒ½ä¼šä¿®æ”¹`addDialogVisible`å±æ€§çš„å€¼ä¸º`false`,å…³é—­å¯¹è¯æ¡†ã€‚

```html
<el-col :span="4">
  <el-button type="primary" @click="addDialogVisible = true"
    >æ·»åŠ ç”¨æˆ·</el-button
  >
</el-col>
```

å½“å•å‡»â€œæ·»åŠ ç”¨æˆ·â€æŒ‰é’®çš„æ—¶å€™ï¼Œä¿®æ”¹`addDialogVisible`å±æ€§çš„å€¼ä¸º`true`,å±•ç¤ºå‡ºå¯¹åº”çš„å¯¹è¯æ¡†ã€‚

`Vue.use(Dialog)`

## 2ã€å±•ç¤ºæ·»åŠ ç”¨æˆ·è¡¨å•

åœ¨å¯¹è¯æ¡†ä¸­æ·»åŠ ç”¨æˆ·è¡¨å•

```html
<!-- æ·»åŠ ç”¨æˆ·çš„å¯¹è¯æ¡† -->
<el-dialog title="æ·»åŠ ç”¨æˆ·" :visible.sync="addDialogVisible" width="50%">
  <!-- å†…å®¹ä¸»ä½“åŒºåŸŸ -->
  <!--ç”¨æˆ·è¡¨å•-->
  <el-form
    :model="addForm"
    :rules="addFormRules"
    ref="addFormRef"
    label-width="70px"
  >
    <el-form-item label="ç”¨æˆ·å" prop="username">
      <el-input v-model="addForm.username"></el-input>
    </el-form-item>
    <el-form-item label="å¯†ç " prop="password">
      <el-input v-model="addForm.password"></el-input>
    </el-form-item>
    <el-form-item label="é‚®ç®±" prop="email">
      <el-input v-model="addForm.email"></el-input>
    </el-form-item>
    <el-form-item label="æ‰‹æœº" prop="mobile">
      <el-input v-model="addForm.mobile"></el-input>
    </el-form-item>
  </el-form>

  <!-- åº•éƒ¨åŒºåŸŸ -->
  <span slot="footer" class="dialog-footer">
    <el-button @click="addDialogVisible = false">å– æ¶ˆ</el-button>
    <el-button type="primary" @click="addDialogVisible = false"
      >ç¡® å®š</el-button
    >
  </span>
</el-dialog>
```

å®šä¹‰è¡¨å•æ•°æ®å±æ€§ä¸æ ¡éªŒè§„åˆ™

```js
  data() {
    return {
      // è·å–ç”¨æˆ·åˆ—è¡¨çš„å‚æ•°å¯¹è±¡
      queryInfo: {
        query: "",
        // å½“å‰çš„é¡µæ•°
        pagenum: 1,
        // å½“å‰æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
        pagesize: 2,
      },
      userlist: [],
      total: 0,
      // æ§åˆ¶æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      addDialogVisible: false,
      // æ·»åŠ ç”¨æˆ·çš„è¡¨å•æ•°æ®
      addForm: {
        username: "",
        password: "",
        email: "",
        mobile: "",
      },
      // æ·»åŠ è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      addFormRules: {
        username: [
          { required: true, message: "è¯·è¾“å…¥ç”¨æˆ·å", trigger: "blur" },
          {
            min: 3,
            max: 10,
            message: "ç”¨æˆ·åçš„é•¿åº¦åœ¨3~10ä¸ªå­—ç¬¦ä¹‹é—´",
            trigger: "blur",
          },
        ],
        password: [
          { required: true, message: "è¯·è¾“å…¥å¯†ç ", trigger: "blur" },
          {
            min: 6,
            max: 15,
            message: "ç”¨æˆ·åçš„é•¿åº¦åœ¨6~15ä¸ªå­—ç¬¦ä¹‹é—´",
            trigger: "blur",
          },
        ],
        email: [{ required: true, message: "è¯·è¾“å…¥é‚®ç®±", trigger: "blur" }],
        mobile: [{ required: true, message: "è¯·è¾“å…¥æ‰‹æœºå·", trigger: "blur" }],
      },
    };
```

## 3ã€è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™

ç°åœ¨éœ€è¦å¯¹é‚®ç®±ä¸æ‰‹æœºå·ç è¿›è¡Œè§„åˆ™æ ¡éªŒã€‚å…·ä½“çš„ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š`https://element.eleme.cn/#/zh-CN/component/form`

ä¸­ï¼Œå¯¹è¡¨å•çš„è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™çš„å®ç°ã€‚

åœ¨`data`ä¸­å®šä¹‰æ ¡éªŒçš„å‡½æ•°ã€‚

```js
data() {
    // éªŒè¯é‚®ç®±çš„è§„åˆ™
    var checkEmail = (rule, value, cb) => {
      // éªŒè¯é‚®ç®±çš„æ­£åˆ™è¡¨è¾¾å¼
      const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;

      if (regEmail.test(value)) {
        // åˆæ³•çš„é‚®ç®±
        return cb();
      }

      cb(new Error("è¯·è¾“å…¥åˆæ³•çš„é‚®ç®±"));
    };

    // éªŒè¯æ‰‹æœºå·çš„è§„åˆ™
    var checkMobile = (rule, value, cb) => {
      // éªŒè¯æ‰‹æœºå·çš„æ­£åˆ™è¡¨è¾¾å¼
      const regMobile = /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;

      if (regMobile.test(value)) {
        return cb();
      }

      cb(new Error("è¯·è¾“å…¥åˆæ³•çš„æ‰‹æœºå·"));
    };



    return {
      // è·å–ç”¨æˆ·åˆ—è¡¨çš„å‚æ•°å¯¹è±¡
      queryInfo: {
        query: "",
        // å½“å‰çš„é¡µæ•°
        pagenum: 1,
        // å½“å‰æ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®
        pagesize: 2,
      },
      userlist: [],
      total: 0,
      // æ§åˆ¶æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      addDialogVisible: false,
      // æ·»åŠ ç”¨æˆ·çš„è¡¨å•æ•°æ®
      addForm: {
        username: "",
        password: "",
        email: "",
        mobile: "",
      },
```

ä½¿ç”¨è§„åˆ™æ ¡éªŒçš„å‡½æ•°ã€‚

```js
  email: [
          { required: true, message: "è¯·è¾“å…¥é‚®ç®±", trigger: "blur" },
          { validator: checkEmail, trigger: "blur" },
        ],
        mobile: [
          { required: true, message: "è¯·è¾“å…¥æ‰‹æœºå·", trigger: "blur" },
          { validator: checkMobile, trigger: "blur" },
        ],
```

è¿™é‡Œæ˜¯é€šè¿‡`validator`æ¥ä½¿ç”¨æ ¡éªŒçš„å‡½æ•°ã€‚

## 4ã€å®ç°è¡¨å•é‡ç½®æ“ä½œ

å¦‚æœåœ¨è¡¨å•ä¸­è¾“å…¥äº†å†…å®¹ï¼Œç„¶åå•å‡»äº†â€œå–æ¶ˆâ€æŒ‰é’®ï¼Œè¿™æ—¶å†æ¬¡å•å‡»â€œæ·»åŠ â€æŒ‰é’®åï¼Œå¼¹å‡ºçš„è¡¨å•ä¸­è¿˜ä¿ç•™äº†ä¸Šæ¬¡è¾“å…¥çš„å†…å®¹ã€‚

è€Œåƒè¿™ç§æƒ…å†µï¼Œè¡¨å•åº”è¯¥æ˜¯å‘ˆç°å‡ºæœ€å¼€å§‹çš„é»˜è®¤çŠ¶æ€ã€‚

å…·ä½“çš„å®ç°å¦‚ä¸‹ï¼š

```html
<el-dialog
  title="æ·»åŠ ç”¨æˆ·"
  :visible.sync="addDialogVisible"
  width="50%"
  @close="addDialogClosed"
></el-dialog>
```

ç»™`dialog`å¯¹è¯æ¡†æ·»åŠ äº†`@close`äº‹ä»¶ï¼Œå½“å…³é—­çª—å£çš„æ—¶å€™ä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚

åœ¨`addDialogClosed`æ–¹æ³•ä¸­ï¼Œå°†è¡¨å•çš„å†…å®¹è¿›è¡Œé‡ç½®ã€‚åœ¨`methods`ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹çš„æ–¹æ³•ã€‚

```js
  // ç›‘å¬æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡†çš„å…³é—­äº‹ä»¶
    addDialogClosed() {
      this.$refs.addFormRef.resetFields();
    },
```

## 5ã€å®Œæˆç”¨æˆ·æ·»åŠ 

é¦–å…ˆï¼Œä¿®æ”¹æ·»åŠ å¯¹è¯æ¡†ä¸­çš„â€œç¡®å®šâ€æŒ‰é’®ï¼Œä¸ºå…¶æ·»åŠ å•å‡»äº‹ä»¶ã€‚

```html
<!-- åº•éƒ¨åŒºåŸŸ -->
<span slot="footer" class="dialog-footer">
  <el-button @click="addDialogVisible = false">å– æ¶ˆ</el-button>
  <el-button type="primary" @click="addUser">ç¡® å®š</el-button>
</span>
```

`addUser`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
  // ç‚¹å‡»æŒ‰é’®ï¼Œæ·»åŠ æ–°ç”¨æˆ·
    addUser() {
      this.$refs.addFormRef.validate(async (valid) => {
          //è¡¨å•æ²¡æœ‰æ ¡éªŒé€šè¿‡ï¼Œç»ˆæ­¢è¯·æ±‚çš„å‘é€ã€‚
        if (!valid) return;
        // å¯ä»¥å‘èµ·æ·»åŠ ç”¨æˆ·çš„ç½‘ç»œè¯·æ±‚
        const { data: res } = await this.$http.post("users", this.addForm);

        if (res.meta.status !== 201) {
          this.$message.error("æ·»åŠ ç”¨æˆ·å¤±è´¥ï¼");
        }

        this.$message.success("æ·»åŠ ç”¨æˆ·æˆåŠŸï¼");
        // éšè—æ·»åŠ ç”¨æˆ·çš„å¯¹è¯æ¡†
        this.addDialogVisible = false;
        // é‡æ–°è·å–ç”¨æˆ·åˆ—è¡¨æ•°æ®
        this.getUserList();
      });
    },
```

## 6ã€å±•ç¤ºä¿®æ”¹ç”¨æˆ·çš„å¯¹è¯æ¡†

åœ¨æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡†çš„ä¸‹é¢ï¼Œå†æ¬¡åˆ›å»ºä¸€ä¸ªå¯¹è¯æ¡†è¡¨ç¤ºä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„å¯¹è¯æ¡†ã€‚

```html
<!-- ä¿®æ”¹ç”¨æˆ·çš„å¯¹è¯æ¡† -->
<el-dialog title="ä¿®æ”¹ç”¨æˆ·" :visible.sync="editDialogVisible" width="50%">
  ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
  <span slot="footer" class="dialog-footer">
    <el-button @click="editDialogVisible = false">å– æ¶ˆ</el-button>
    <el-button type="primary" @click="editDialogVisible = false"
      >ç¡® å®š</el-button
    >
  </span>
</el-dialog>
```

`editDialogVisible`å±æ€§æ§åˆ¶å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—ã€‚

åœ¨`data`ä¸­å®šä¹‰è¯¥å±æ€§ï¼Œé»˜è®¤å–å€¼ä¸º`false`

```js
 // æ§åˆ¶ä¿®æ”¹ç”¨æˆ·å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      editDialogVisible: false,
```

ä¸ºè¡¨æ ¼ä¸­çš„æ“ä½œåˆ—ä¸­çš„ç¼–è¾‘æŒ‰é”®æ·»åŠ å•å‡»äº‹ä»¶ï¼Œè¯¥äº‹ä»¶è§¦å‘åå¼¹å‡ºä¿®æ”¹ç”¨æˆ·çš„çª—å£ã€‚

```html
<!-- ä¿®æ”¹æŒ‰é’® -->
<el-button
  type="primary"
  icon="el-icon-edit"
  size="mini"
  @click="showEditDialog"
></el-button>
```

`showEditDialog`æ–¹æ³•çš„å®ç°å¦‚ä¸‹

```js
  // å±•ç¤ºç¼–è¾‘ç”¨æˆ·çš„å¯¹è¯æ¡†
    async showEditDialog() {
      this.editDialogVisible = true;
    },
```

è¿™æ ·å°±å®ç°äº†å•å‡»ä¿®æ”¹æŒ‰é’®ï¼Œå¼¹å‡ºçª—å£çš„æ•ˆæœã€‚

ä¸‹é¢è¦å®ç°çš„åŠŸèƒ½å°±æ˜¯åœ¨ä¿®æ”¹çš„çª—å£ä¸­æ·»åŠ è¡¨å•ï¼Œç„¶åå°†è¦ä¿®æ”¹çš„ç”¨æˆ·æ•°æ®å¡«å……åˆ°è¡¨å•ä¸­ã€‚

## 7ã€æ ¹æ®ç”¨æˆ·ç¼–å·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯

å½“å•å‡»â€œä¿®æ”¹""æŒ‰é’®çš„æ—¶å€™ï¼Œé¦–å…ˆå…ˆè·å–ç”¨æˆ·çš„ç¼–å·ï¼Œç„¶åæ ¹æ®è¯¥ç¼–å·æŸ¥è¯¢å‡ºå¯¹åº”çš„ç”¨æˆ·æ•°æ®ã€‚

```html
<template slot-scope="scope">
  <!-- ä¿®æ”¹æŒ‰é’® -->
  <el-button
    type="primary"
    icon="el-icon-edit"
    size="mini"
    @click="showEditDialog(scope.row.id)"
  ></el-button
></template>
```

é€šè¿‡ä½œç”¨åŸŸæ’æ§½ï¼Œå°†è¦ç¼–è¾‘çš„ç”¨æˆ·ç¼–å·ä¼ é€’åˆ°`showEditDialog`æ–¹æ³•ä¸­ã€‚

```js
  // å±•ç¤ºç¼–è¾‘ç”¨æˆ·çš„å¯¹è¯æ¡†
    async showEditDialog(id) {
      const { data: res } = await this.$http.get("users/" + id);

      if (res.meta.status !== 200) {
        return this.$message.error("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼");
      }

      this.editForm = res.data;
      this.editDialogVisible = true;
    },
```

æ ¹æ®ä¼ é€’è¿‡æ¥çš„å“Ÿç”¨æˆ·ç¼–å·ï¼Œå‘é€å¼‚æ­¥è¯·æ±‚ï¼Œè·å–å…·ä½“çš„ç”¨æˆ·æ•°æ®ï¼Œç„¶åèµ‹å€¼ç»™`editForm`å±æ€§ã€‚

åœ¨`data`ä¸­å®šä¹‰`editForm`å±æ€§æ¥ä¿å­˜è¦ç¼–è¾‘çš„ç”¨æˆ·æ•°æ®ã€‚

```js
// æŸ¥è¯¢åˆ°çš„è¦ç¼–è¾‘çš„ç”¨æˆ·ä¿¡æ¯å¯¹è±¡
      editForm: {},
```

## 8ã€å±•ç¤ºä¿®æ”¹ç”¨æˆ·çš„è¡¨å•

åœ¨ä¿®æ”¹ç”¨æˆ·çš„å¯¹è¯æ¡†ä¸­åˆ›å»ºä¿®æ”¹çš„è¡¨å•ï¼Œå±•ç¤ºè¦ä¿®æ”¹çš„æ•°æ®ã€‚

```html
<!-- ä¿®æ”¹ç”¨æˆ·çš„å¯¹è¯æ¡† -->
<el-dialog title="ä¿®æ”¹ç”¨æˆ·" :visible.sync="editDialogVisible" width="50%">
  <el-form
    :model="editForm"
    :rules="editFormRules"
    ref="editFormRef"
    label-width="70px"
  >
    <el-form-item label="ç”¨æˆ·å">
      <el-input v-model="editForm.username" disabled></el-input>
    </el-form-item>
    <el-form-item label="é‚®ç®±" prop="email">
      <el-input v-model="editForm.email"></el-input>
    </el-form-item>
    <el-form-item label="æ‰‹æœº" prop="mobile">
      <el-input v-model="editForm.mobile"></el-input>
    </el-form-item>
  </el-form>
  <span slot="footer" class="dialog-footer">
    <el-button @click="editDialogVisible = false">å– æ¶ˆ</el-button>
    <el-button type="primary" @click="editDialogVisible = false"
      >ç¡® å®š</el-button
    >
  </span>
</el-dialog>
```

åœ¨è¡¨å•ä¸­ï¼Œ`model`å±æ€§å·²ç»ç»‘å®šäº†`editForm`å¯¹è±¡ï¼Œè€Œè¯¥å¯¹è±¡ä¸­å­˜å‚¨äº†è¦ä¿®æ”¹çš„ç”¨æˆ·æ•°æ®ï¼Œç„¶åå°†`editForm`ä¸­çš„å±æ€§ä¸æ–‡æœ¬æ¡†è¿›è¡ŒåŒå‘ç»‘å®šï¼Œè¿™æ ·æ–‡æœ¬æ¡†ä¸­å°±ä¼šå±•ç¤ºå‡ºè¦ä¿®æ”¹çš„ç”¨æˆ·æ•°æ®ã€‚

åŒæ—¶ç»™`el-form`è¡¨å•æ·»åŠ äº†`rules`å±æ€§ï¼ŒæŒ‡å®šäº†æ ¡éªŒè§„åˆ™ï¼Œæ ¡éªŒè§„åˆ™æœ‰`editFormRules`å¯¹è±¡å®Œæˆå®šä¹‰ï¼Œè®©æ¯ä¸€ä¸ª`el-form-item`è¡¨å•é¡¹é€šè¿‡`prop`å±æ€§ä¸æ ¡éªŒè§„åˆ™å¯¹è±¡`editFormRules`ä¸­çš„å±æ€§è¿›è¡Œç»‘å®šï¼Œä»è€Œå®Œæˆæ ¡éªŒã€‚

```js
   // æŸ¥è¯¢åˆ°çš„è¦ç¼–è¾‘çš„ç”¨æˆ·ä¿¡æ¯å¯¹è±¡
      editForm: {},
      // ä¿®æ”¹è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      editFormRules: {
        email: [
          { required: true, message: "è¯·è¾“å…¥ç”¨æˆ·é‚®ç®±", trigger: "blur" },
          { validator: checkEmail, trigger: "blur" },
        ],
        mobile: [
          { required: true, message: "è¯·è¾“å…¥ç”¨æˆ·æ‰‹æœº", trigger: "blur" },
          { validator: checkMobile, trigger: "blur" },
        ],
      },
```

## 9ã€å®Œæˆç”¨æˆ·ä¿¡æ¯ç¼–è¾‘æ“ä½œ

é¦–å…ˆç»™ç”¨æˆ·ç¼–è¾‘çª—å£ä¸­çš„ç¡®å®šæŒ‰é’®ï¼Œæ·»åŠ å•å‡»äº‹ä»¶ï¼Œå¯¹åº”çš„å¤„ç†å‡½æ•°ä¸º`editUserInfo`

```html
<el-button type="primary" @click="editUserInfo">ç¡® å®š</el-button>
```

`editUserInfo`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
 // ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯å¹¶æäº¤
    editUserInfo() {
      this.$refs.editFormRef.validate(async (valid) => {
        if (!valid) return;
        // å‘èµ·ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯çš„æ•°æ®è¯·æ±‚
        const { data: res } = await this.$http.put(
          "users/" + this.editForm.id,
          {
            email: this.editForm.email,
            mobile: this.editForm.mobile,
          }
        );

        if (res.meta.status !== 200) {
          return this.$message.error("æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼");
        }
        // å…³é—­å¯¹è¯æ¡†
        this.editDialogVisible = false;
        // åˆ·æ–°æ•°æ®åˆ—è¡¨
        this.getUserList();
        // æç¤ºä¿®æ”¹æˆåŠŸ
        this.$message.success("æ›´æ–°ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼");
      });
    },
```

## 10ã€åˆ é™¤ç”¨æˆ·æ•°æ®

åœ¨åˆ é™¤å…·ä½“çš„ç”¨æˆ·æ•°æ®ä¹‹å‰ï¼Œåº”è¯¥å…ˆç»™ç”¨æˆ·ä¸€ä¸ªæç¤ºä¿¡æ¯ã€‚

é¦–å…ˆå…ˆæ‰¾åˆ°è¡¨æ ¼ä¸­çš„æ“ä½œåˆ—ï¼Œç„¶ååœ¨æ‰¾åˆ°åˆ é™¤æŒ‰é’®ï¼Œç»™è¯¥æŒ‰é’®æ·»åŠ å•å‡»äº‹ä»¶ã€‚

```html
<!-- åˆ é™¤æŒ‰é’® -->
<el-button
  type="danger"
  icon="el-icon-delete"
  size="mini"
  @click="removeUserById(scope.row.id)"
></el-button>
```

åœ¨è°ƒç”¨`removeUserById`æ–¹æ³•çš„æ—¶å€™ï¼Œå°†ç”¨æˆ·ç¼–å·ä½œä¸ºå‚æ•°ã€‚

```js
 // æ ¹æ®Idåˆ é™¤å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯
    async removeUserById(id) {
      // å¼¹æ¡†è¯¢é—®ç”¨æˆ·æ˜¯å¦åˆ é™¤æ•°æ®
      //ç”±äºConfirmæŒ‚è½½åˆ°äº†`Vue`çš„åŸå‹ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨this
      const confirmResult = await this.$confirm(
        "æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥ç”¨æˆ·, æ˜¯å¦ç»§ç»­?",
        "æç¤º",
        {
          confirmButtonText: "ç¡®å®š",
          cancelButtonText: "å–æ¶ˆ",
          type: "warning",//çª—å£ä¸­çš„å›¾æ ‡
        }
      ).catch((err) => err); //å¤„ç†å–æ¶ˆçš„æƒ…å†µã€‚

      // å¦‚æœç”¨æˆ·ç¡®è®¤åˆ é™¤ï¼Œåˆ™è¿”å›å€¼ä¸ºå­—ç¬¦ä¸² confirm
      // å¦‚æœç”¨æˆ·å–æ¶ˆäº†åˆ é™¤ï¼Œåˆ™è¿”å›å€¼ä¸ºå­—ç¬¦ä¸² cancel
      // console.log(confirmResult)
      if (confirmResult !== "confirm") {
        return this.$message.info("å·²å–æ¶ˆåˆ é™¤");
      }

      this.$message.success("åˆ é™¤ç”¨æˆ·æˆåŠŸï¼" + id);
    },
```

åœ¨`element.js`æ–‡ä»¶ä¸­å¯¼å…¥`MessageBox`,å¹¶ä¸”å°†`confirm`æŒ‚è½½åˆ°`Vue`çš„åŸå‹ä¸Šã€‚

```
import {MessageBox} from "element-ui"
Vue.prototype.$confirm = MessageBox.confirm;
```

ä¸‹é¢è¦å®ç°çš„å°±æ˜¯å‘é€å¼‚æ­¥è¯·æ±‚åˆ é™¤ç”¨æˆ·æ•°æ®ã€‚

ä¿®æ”¹åçš„`removeUserById`çš„æ–¹æ³•å¦‚ä¸‹ï¼š

```js
   // æ ¹æ®Idåˆ é™¤å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯
    async removeUserById(id) {
      // å¼¹æ¡†è¯¢é—®ç”¨æˆ·æ˜¯å¦åˆ é™¤æ•°æ®
      //ç”±äºConfirmæŒ‚è½½åˆ°äº†`Vue`çš„åŸå‹ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨this
      const confirmResult = await this.$confirm(
        "æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥ç”¨æˆ·, æ˜¯å¦ç»§ç»­?",
        "æç¤º",
        {
          confirmButtonText: "ç¡®å®š",
          cancelButtonText: "å–æ¶ˆ",
          type: "warning",
        }
      ).catch((err) => err); //å¤„ç†å–æ¶ˆçš„æƒ…å†µã€‚

      // å¦‚æœç”¨æˆ·ç¡®è®¤åˆ é™¤ï¼Œåˆ™è¿”å›å€¼ä¸ºå­—ç¬¦ä¸² confirm
      // å¦‚æœç”¨æˆ·å–æ¶ˆäº†åˆ é™¤ï¼Œåˆ™è¿”å›å€¼ä¸ºå­—ç¬¦ä¸² cancel
      // console.log(confirmResult)
      if (confirmResult !== "confirm") {
        return this.$message.info("å·²å–æ¶ˆåˆ é™¤");
      }
//æŒ‡å®šåˆ é™¤æ¥å£,å‘é€deleteè¯·æ±‚
      const { data: res } = await this.$http.delete("users/" + id);

      if (res.meta.status !== 200) {
        return this.$message.error("åˆ é™¤ç”¨æˆ·å¤±è´¥ï¼");
      }

      this.$message.success("åˆ é™¤ç”¨æˆ·æˆåŠŸï¼");
      this.getUserList();
    },
```

# å…­ã€æƒé™åˆ—è¡¨

## 1ã€åˆ›å»ºæƒé™åˆ—è¡¨ç»„ä»¶

é¦–å…ˆå…ˆåˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æƒé™ç»„ä»¶ï¼Œå¹¶ä¸”æŒ‡å®šå¯¹åº”çš„è·¯ç”±è§„åˆ™ã€‚

åœ¨`components`ç›®å½•ä¸‹é¢åˆ›å»º`power`ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹é¢åˆ›å»º`Rights.vue`æ–‡ä»¶ã€‚

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>æƒé™ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>æƒé™åˆ—è¡¨</el-breadcrumb-item>
    </el-breadcrumb>

    <!-- å¡ç‰‡è§†å›¾ -->
    <el-card>
      <el-table :data="rightsList" border stripe>
        <el-table-column type="index"></el-table-column>
        <el-table-column label="æƒé™åç§°" prop="authName"></el-table-column>
        <el-table-column label="è·¯å¾„" prop="path"></el-table-column>
        <el-table-column label="æƒé™ç­‰çº§" prop="level">
          <template slot-scope="scope">
            <el-tag v-if="scope.row.level === '0'">ä¸€çº§</el-tag>
            <el-tag type="success" v-else-if="scope.row.level === '1'"
              >äºŒçº§</el-tag
            >
            <el-tag type="warning" v-else>ä¸‰çº§</el-tag>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
  </div>
</template>

<script>
export default {
  data() {
    return {
      // æƒé™åˆ—è¡¨
      rightsList: [],
    };
  },
  created() {
    // è·å–æ‰€æœ‰çš„æƒé™
    this.getRightsList();
  },
  methods: {
    // è·å–æƒé™åˆ—è¡¨
    async getRightsList() {
      const { data: res } = await this.$http.get("rights/list");
      if (res.meta.status !== 200) {
        return this.$message.error("è·å–æƒé™åˆ—è¡¨å¤±è´¥ï¼");
      }

      this.rightsList = res.data;
      console.log(this.rightsList);
    },
  },
};
</script>

<style scoped></style>
```

è·¯ç”±è®¾ç½®ï¼š

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights }, //æƒé™ç»„ä»¶
      ],
    },
  ],
});
```

`Vue.use(Tag);`

## 2ã€ç”¨æˆ·è§’è‰²æƒé™å…³ç³»ä»‹ç»

# ä¸ƒã€è§’è‰²åˆ—è¡¨

## 1ã€å±•ç¤ºè§’è‰²æ•°æ®

åœ¨`components/power`ç›®å½•ä¸‹é¢åˆ›å»º`Roles.vue`

æ•´ä¸ªçš„ç»„ä»¶ç»“æ„å¦‚ä¸‹ï¼š

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>æƒé™ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>è§’è‰²åˆ—è¡¨</el-breadcrumb-item>
    </el-breadcrumb>
    <!-- å¡ç‰‡è§†å›¾ -->
    <el-card>
      <!-- æ·»åŠ è§’è‰²æŒ‰é’®åŒºåŸŸ -->
      <el-row>
        <el-col>
          <el-button type="primary">æ·»åŠ è§’è‰²</el-button>
        </el-col>
      </el-row>
      <!-- è§’è‰²åˆ—è¡¨åŒºåŸŸ -->
      <el-table :data="rolelist" border stripe>
        <!-- å±•å¼€åˆ— -->
        <el-table-column type="expand"></el-table-column>
        <!-- ç´¢å¼•åˆ— -->
        <el-table-column type="index"></el-table-column>
        <el-table-column label="è§’è‰²åç§°" prop="roleName"></el-table-column>
        <el-table-column label="è§’è‰²æè¿°" prop="roleDesc"></el-table-column>
        <el-table-column label="æ“ä½œ" width="300px">
          <template slot-scope="scope">
            <el-button size="mini" type="primary" icon="el-icon-edit"
              >ç¼–è¾‘</el-button
            >
            <el-button size="mini" type="danger" icon="el-icon-delete"
              >åˆ é™¤</el-button
            >
            <el-button
              size="mini"
              type="warning"
              icon="el-icon-setting"
              @click="showSetRightDialog(scope.row)"
              >åˆ†é…æƒé™</el-button
            >
          </template>
        </el-table-column>
      </el-table>
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      // æ‰€æœ‰è§’è‰²åˆ—è¡¨æ•°æ®
      rolelist: [],
    };
  },
  created() {
    this.getRolesList();
  },
  methods: {
    // è·å–æ‰€æœ‰è§’è‰²çš„åˆ—è¡¨
    async getRolesList() {
      const { data: res } = await this.$http.get("roles");

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–è§’è‰²åˆ—è¡¨å¤±è´¥ï¼");
      }

      this.rolelist = res.data;

      //   console.log(this.rolelist);
    },
  },
};
</script>
```

åœ¨ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªå±•å¼€åˆ—ã€‚

```html
<!-- å±•å¼€åˆ— -->
<el-table-column type="expand"></el-table-column>
```

è·¯ç”±è®¾ç½®ï¼š

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
import Roles from "./components/power/Roles.vue";

Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
      ],
    },
  ],
});
```

æ·»åŠ äº†`Roles.vue`è¿™ä¸ªç»„ä»¶å¯¹åº”çš„è·¯ç”±å†…å®¹ã€‚

## 2ã€æ¸²æŸ“ä¸€çº§æƒé™

è¿™é‡Œé‡ç‚¹è¦æ³¨æ„çš„å°±æ˜¯ï¼Œæ•´ä¸ªæ•°æ®çš„ç»“æ„ã€‚

å½“ç‚¹å‡»â€œå±•å¼€åˆ—â€æ—¶å€™ï¼Œä¼šå±•ç¤ºå‡ºå½“å‰è§’è‰²å…·æœ‰çš„æƒé™ã€‚

è€Œç³»ç»Ÿä¸­ï¼Œæƒé™åˆ†ä¸ºäº†ä¸‰çº§ï¼Œåˆ†åˆ«ä¸º 1 çº§æƒé™ï¼ŒäºŒçº§æƒé™å’Œä¸‰çº§æƒé™ã€‚

æ•´ä¸ªæƒé™çš„å¸ƒé‡‡ç”¨çš„æ˜¯æ …æ ¼å¸ƒå±€ï¼Œä¸€çº§æƒé™å ç”¨ 5 åˆ—ï¼ŒäºŒçº§ä¸ä¸‰çº§æƒé™å ç”¨ 19 åˆ—ã€‚

åœ¨"å±•å¼€åˆ—"ä¸­ï¼Œé€šè¿‡ä½œç”¨åŸŸæ’æ§½æ¥å®Œæˆæƒé™çš„å±•ç¤ºã€‚

```html
<!-- å±•å¼€åˆ— -->
<el-table-column type="expand">
  <template slot-scope="scope">
    <el-row
      :class="['bdbottom', i1 === 0 ? 'bdtop' : '']"
      v-for="(item1, i1) in scope.row.children"
      :key="item1.id"
    >
      <!-- æ¸²æŸ“ä¸€çº§æƒé™ -->
      <el-col :span="5">
        <!-- æƒé™å -->
        <el-tag>{{item1.authName}}</el-tag>
        <!-- å³ä¾§ç®­å¤´å›¾æ ‡ -->
        <i class="el-icon-caret-right"></i>
      </el-col>

      <!-- æ¸²æŸ“äºŒçº§å’Œä¸‰çº§æƒé™ -->
      <el-col :span="19"></el-col>
    </el-row>
  </template>
</el-table-column>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡`scope.row.children`è·å–çš„æ˜¯å½“å‰è§’è‰²å…·æœ‰çš„æƒé™æ•°æ®ï¼Œä¸‹é¢é€šè¿‡`for`å¾ªç¯è¿›è¡Œéå†ã€‚

åŸºæœ¬çš„æ ·å¼å¦‚ä¸‹

```css
<style scoped>
.el-tag {
  margin: 7px;
}

.bdtop {
  border-top: 1px solid #eee;
}

.bdbottom {
  border-bottom: 1px solid #eee;
}
</style>
```

## 3ã€æ¸²æŸ“äºŒçº§æƒé™

```vue
<!-- å±•å¼€åˆ— -->
<el-table-column type="expand">
          <template slot-scope="scope">
            <el-row
              :class="['bdbottom', i1 === 0 ? 'bdtop' : '']"
              v-for="(item1, i1) in scope.row.children"
              :key="item1.id"
            >
              <!-- æ¸²æŸ“ä¸€çº§æƒé™ -->
              <el-col :span="5">
                <el-tag>{{item1.authName}}</el-tag>
                <i class="el-icon-caret-right"></i>
              </el-col>

              <!-- æ¸²æŸ“äºŒçº§å’Œä¸‰çº§æƒé™ -->
              <el-col :span="19">
                <!-- é€šè¿‡forå¾ªç¯åµŒå¥—ï¼Œæ¸²æŸ“äºŒçº§æƒé™ -->
                <el-row
                  :class="[i2 === 0 ? '' : 'bdtop']"
                  v-for="(item2, i2) in item1.children"
                  :key="item2.id"
                >
                  <el-col :span="6">
                    <el-tag type="success">{{item2.authName}}</el-tag>
                    <i class="el-icon-caret-right"></i>
                  </el-col>
                  <el-col :span="18"></el-col>
                </el-row>
              </el-col>
            </el-row>
          </template>
        </el-table-column>
```

è¿™é‡Œé€šè¿‡å¯¹ä¸€çº§æƒé™ä¸‹çš„`chilren`å±æ€§è¿›è¡Œéå†ï¼Œä»è€Œå®ŒæˆäºŒçº§æƒé™çš„æ¸²æŸ“ã€‚

## 4ã€æ¸²æŸ“ä¸‰çº§æƒé™

```html
<!-- å±•å¼€åˆ— -->
<el-table-column type="expand">
  <template slot-scope="scope">
    <el-row
      :class="['bdbottom', i1 === 0 ? 'bdtop' : '']"
      v-for="(item1, i1) in scope.row.children"
      :key="item1.id"
    >
      <!-- æ¸²æŸ“ä¸€çº§æƒé™ -->
      <el-col :span="5">
        <el-tag>{{item1.authName}}</el-tag>
        <i class="el-icon-caret-right"></i>
      </el-col>

      <!-- æ¸²æŸ“äºŒçº§å’Œä¸‰çº§æƒé™ -->
      <el-col :span="19">
        <!-- é€šè¿‡forå¾ªç¯åµŒå¥—ï¼Œæ¸²æŸ“äºŒçº§æƒé™ -->
        <el-row
          :class="[i2 === 0 ? '' : 'bdtop']"
          v-for="(item2, i2) in item1.children"
          :key="item2.id"
        >
          <el-col :span="6">
            <el-tag type="success">{{item2.authName}}</el-tag>
            <i class="el-icon-caret-right"></i>
          </el-col>
          <!--æ¸²æŸ“ä¸‰çº§æƒé™ -->
          <el-col :span="18">
            <el-tag
              type="warning"
              v-for="(item3) in item2.children"
              :key="item3.id"
              >{{item3.authName}}</el-tag
            >
          </el-col>
        </el-row>
      </el-col>
    </el-row>
  </template>
</el-table-column>
```

è¿™é‡Œé€šè¿‡å¯¹äºŒçº§æƒé™ä¸‹çš„`chilren`å±æ€§è¿›è¡Œéå†ï¼Œä»è€Œå®Œæˆä¸‰çº§æƒé™çš„æ¸²æŸ“ã€‚

## 5ã€åˆ é™¤æŒ‡å®šè§’è‰²ä¸‹çš„æƒé™

é¦–å…ˆç»™æ¯ä¸ªæƒé™åç§°å³ä¸Šè§’æ·»åŠ ä¸€ä¸ªå‰å·æŒ‰é’®ï¼Œå½“å•å‡»è¯¥å‰å·æŒ‰é’®åï¼Œåˆ é™¤å¯¹åº”çš„æƒé™ã€‚

```vue
<!-- å±•å¼€åˆ— -->
<el-table-column type="expand">
          <template slot-scope="scope">
            <el-row
              :class="['bdbottom', i1 === 0 ? 'bdtop' : '']"
              v-for="(item1, i1) in scope.row.children"
              :key="item1.id"
            >
              <!-- æ¸²æŸ“ä¸€çº§æƒé™ -->
              <el-col :span="5">
                <el-tag closable @close="removeRightById(scope.row, item1.id)">{{item1.authName}}</el-tag>
                <i class="el-icon-caret-right"></i>
              </el-col>

              <!-- æ¸²æŸ“äºŒçº§å’Œä¸‰çº§æƒé™ -->
              <el-col :span="19">
                <!-- é€šè¿‡forå¾ªç¯åµŒå¥—ï¼Œæ¸²æŸ“äºŒçº§æƒé™ -->
                <el-row
                  :class="[i2 === 0 ? '' : 'bdtop']"
                  v-for="(item2, i2) in item1.children"
                  :key="item2.id"
                >
                  <el-col :span="6">
                    <el-tag
                      type="success"
                      closable
                      @close="removeRightById(scope.row, item2.id)"
                    >{{item2.authName}}</el-tag>
                    <i class="el-icon-caret-right"></i>
                  </el-col>
                  <!--æ¸²æŸ“ä¸‰çº§æƒé™ -->
                  <el-col :span="18">
                    <el-tag
                      type="warning"
                      v-for="(item3) in item2.children"
                      :key="item3.id"
                      closable
                      @close="removeRightById(scope.row, item3.id)"
                    >{{item3.authName}}</el-tag>
                  </el-col>
                </el-row>
              </el-col>
            </el-row>
          </template>
        </el-table-column>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç»™`el-tag`ç»„ä»¶æ·»åŠ äº†`closable`å±æ€§ï¼ŒåŒæ—¶æŒ‡å®šäº†`@close`äº‹ä»¶ã€‚

äº‹ä»¶è§¦å‘åï¼Œæ‰§è¡Œ`removeRightById`å¤„ç†å‡½æ•°ï¼Œå°†è§’è‰²çš„ä¿¡æ¯ä»¥åŠæƒé™ç¼–å·ä¼ é€’åˆ°è¯¥æ–¹æ³•ä¸­ã€‚

```js
   // æ ¹æ®Idåˆ é™¤å¯¹åº”çš„æƒé™
    async removeRightById(role, rightId) {
      // å¼¹æ¡†æç¤ºç”¨æˆ·æ˜¯å¦è¦åˆ é™¤
      const confirmResult = await this.$confirm(
        "æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥æ–‡ä»¶, æ˜¯å¦ç»§ç»­?",
        "æç¤º",
        {
          confirmButtonText: "ç¡®å®š",
          cancelButtonText: "å–æ¶ˆ",
          type: "warning",
        }
      ).catch((err) => err);

      if (confirmResult !== "confirm") {
        return this.$message.info("å–æ¶ˆäº†åˆ é™¤ï¼");
      }

      const { data: res } = await this.$http.delete(
        `roles/${role.id}/rights/${rightId}`
      );

      if (res.meta.status !== 200) {
        return this.$message.error("åˆ é™¤æƒé™å¤±è´¥ï¼");
      }

      // this.getRolesList()
      role.children = res.data; //å°†è¿”å›çš„æœ€æ–°æ•°æ®é‡æ–°èµ‹å€¼ç»™childrenå±æ€§ã€‚
    },
```

# å…«ã€åˆ†é…æƒé™ã€è§’è‰²

## 1ã€åˆ†é…æƒé™---å±•ç¤ºæƒé™ä¿¡æ¯

å½“ç”¨æˆ·ç‚¹å‡»`åˆ†é…æƒé™`æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œåœ¨è¿™ä¸ªå¯¹è¯æ¡†ä¸­ä»¥æ ‘å½¢æ–¹å¼å±•ç¤ºå‡ºæ‰€æœ‰çš„æƒé™ã€‚

åœ¨`el-card`ç»„ä»¶ä¸‹é¢æ·»åŠ çª—å£ç»„ä»¶ã€‚

```vue
<!-- åˆ†é…æƒé™çš„å¯¹è¯æ¡† -->
<el-dialog title="åˆ†é…æƒé™" :visible.sync="setRightDialogVisible" width="50%">
      <span slot="footer" class="dialog-footer">
        <el-button @click="setRightDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="setRightDialogVisible = false">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

å®šä¹‰`setRightDialogVisible`å±æ€§ï¼Œè¯¥å±æ€§çš„é»˜è®¤å€¼ä¸º`false`.

```js
// æ§åˆ¶åˆ†é…æƒé™å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      setRightDialogVisible: false,
```

å½“å•å‡»æ“ä½œåˆ—ä¸­çš„â€œåˆ†é…æƒé™â€æŒ‰é’®å¼¹å‡ºçª—å£ï¼ŒåŒæ—¶è·å–æ‰€æœ‰çš„æƒé™ä¿¡æ¯ã€‚

```vue
<el-button
  size="mini"
  type="warning"
  icon="el-icon-setting"
  @click="showSetRightDialog(scope.row)"
>åˆ†é…æƒé™</el-button>
```

åœ¨è°ƒç”¨`showSetRightDialog`æ–¹æ³•çš„æ—¶å€™ï¼Œä¼ é€’äº†å¯¹åº”çš„è§’è‰²ä¿¡æ¯ã€‚

```js

    // å±•ç¤ºåˆ†é…æƒé™çš„å¯¹è¯æ¡†
    async showSetRightDialog(role) {
      // è·å–æ‰€æœ‰æƒé™çš„æ•°æ®
      const { data: res } = await this.$http.get("rights/tree");

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–æƒé™æ•°æ®å¤±è´¥ï¼");
      }

      // æŠŠè·å–åˆ°çš„æƒé™æ•°æ®ä¿å­˜åˆ° data ä¸­
      this.rightslist = res.data;
      console.log(this.rightslist);
      console.log(role);
      // å±•ç¤ºå‡ºå¯¹è¯æ¡†
      this.setRightDialogVisible = true;
    },
```

æŠŠè·å–åˆ°çš„æƒé™æ•°æ®èµ‹å€¼ç»™äº†`rightslist`å±æ€§ã€‚

```js
  // æ‰€æœ‰æƒé™çš„æ•°æ®
      rightslist: [],
```

## 2ã€ä½¿ç”¨æ ‘å½¢æ–¹å¼å±•ç¤ºæƒé™æ•°æ®

ä¸‹é¢è¦åšçš„å°±æ˜¯ï¼Œåœ¨å¼¹å‡ºçš„çª—å£ä¸­ä½¿ç”¨æ ‘å½¢æ§ä»¶å±•ç¤ºæƒé™æ•°æ®ã€‚

```vue
<!-- åˆ†é…æƒé™çš„å¯¹è¯æ¡† -->
<el-dialog title="åˆ†é…æƒé™" :visible.sync="setRightDialogVisible" width="50%">
      <!-- æ ‘å½¢æ§ä»¶ -->
      <el-tree :data="rightslist" :props="treeProps"></el-tree>

      <span slot="footer" class="dialog-footer">
        <el-button @click="setRightDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="setRightDialogVisible = false">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä¸ºå¯¹è¯æ¡†æ·»åŠ äº†`el-tree`æ§ä»¶ï¼Œ`data`å±æ€§æŒ‡å®šäº†æ•°æ®æºï¼Œ`props`å±æ€§æŒ‡å®šäº†æ ‘å½¢æ§ä»¶ä¸­æ‰€è¦å±•ç¤ºçš„å†…å®¹ä»¥åŠçˆ¶å­å…³ç³»ã€‚

```js
  data() {
    return {
      // æ‰€æœ‰è§’è‰²åˆ—è¡¨æ•°æ®
      rolelist: [],
      // æ§åˆ¶åˆ†é…æƒé™å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      setRightDialogVisible: false,
      // æ‰€æœ‰æƒé™çš„æ•°æ®
      rightslist: [],
      // æ ‘å½¢æ§ä»¶çš„å±æ€§ç»‘å®šå¯¹è±¡
      treeProps: {
        label: "authName",
        children: "children",
      },
    };
```

åœ¨`element.js`ä¸­æ³¨å†Œ`Tree`ç»„ä»¶

```
Vue.use(Tree)
```

æ¥ä¸‹æ¥ï¼Œç»™æ ‘å½¢æ§ä»¶æ·»åŠ äº†å¦‚ä¸‹å±æ€§

```vue
<el-tree
  :data="rightslist"
  :props="treeProps"
  show-checkbox
  node-key="id"
  default-expand-all
></el-tree>
```

`show-checkbox`:æ¯ä¸€ä¸ªæƒé™åç§°å‰é¢æ·»åŠ å¤é€‰æ¡†ã€‚

`default-expand-all`: å°†æ•´æ£µæ ‘å…¨éƒ¨å±•å¼€ã€‚

`node-key`:é€‰ä¸­è·å–çš„æ˜¯æƒé™çš„ç¼–å·ã€‚

## 3ã€å°†æŸä¸ªè§’è‰²å·²æœ‰æƒé™é€‰ä¸­

å¦‚æœæƒ³è¦è®©`el-tree`ä¸­æƒé™åç§°å‰é¢çš„å¤é€‰æ¡†é€‰ä¸­ï¼Œéœ€è¦ç”¨åˆ°`default-checked-keys`å±æ€§, è¯¥å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­å­˜æ”¾çš„å°±æ˜¯è¦é€‰ä¸­çš„æƒé™çš„ç¼–å·ã€‚

```vue
<el-tree
  :data="rightslist"
  :props="treeProps"
  show-checkbox
  node-key="id"
  default-expand-all
  :default-checked-keys="defKeys"
></el-tree>
```

å®šä¹‰`defKeys`æ•°ç»„

```js
data() {
    return {
      // æ‰€æœ‰è§’è‰²åˆ—è¡¨æ•°æ®
      rolelist: [],
      // æ§åˆ¶åˆ†é…æƒé™å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      setRightDialogVisible: false,
      // æ‰€æœ‰æƒé™çš„æ•°æ®
      rightslist: [],
      // æ ‘å½¢æ§ä»¶çš„å±æ€§ç»‘å®šå¯¹è±¡
      treeProps: {
        label: "authName",
        children: "children",
      },
      // é»˜è®¤é€‰ä¸­çš„èŠ‚ç‚¹Idå€¼æ•°ç»„
      defKeys: [],
    };
```

æ€æ ·å°†æŸä¸ªè§’è‰²å·²ç»æœ‰çš„æƒé™é€‰ä¸­å‘¢(è¿™é‡Œæ˜¯å°†ä¸‰çº§æƒé™é€‰ä¸­)ï¼Œä¹Ÿå°±æ˜¯è¯´æ€æ ·å°†æŸä¸ªè§’è‰²å·²æœ‰çš„ä¸‰çº§æƒé™ç¼–å·å­˜å‚¨åˆ°`defKeys`æ•°ç»„ä¸­ï¼Ÿ

```js
  // é€šè¿‡é€’å½’çš„å½¢å¼ï¼Œè·å–è§’è‰²ä¸‹æ‰€æœ‰ä¸‰çº§æƒé™çš„idï¼Œå¹¶ä¿å­˜åˆ° defKeys æ•°ç»„ä¸­
    getLeafKeys(node, arr) {
      // å¦‚æœå½“å‰ node èŠ‚ç‚¹ä¸åŒ…å« children å±æ€§ï¼Œåˆ™æ˜¯ä¸‰çº§èŠ‚ç‚¹
      if (!node.children) {
        return arr.push(node.id);
      }

      node.children.forEach((item) => this.getLeafKeys(item, arr));
    },
```

è¿™é‡Œå°±æ˜¯é€šè¿‡é€’å½’çš„æ–¹å¼ï¼Œçœ‹ä¸€ä¸‹æŸä¸ªèŠ‚ç‚¹æ˜¯å¦è¿˜æœ‰`children`å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è¡¨ç¤ºå°±æ˜¯ä¸‰çº§æƒé™ï¼Œè¿™æ ·å°±å°†å¯¹åº”çš„æƒé™ç¼–å·å­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¦‚æœæœ‰

`children`å±æ€§ï¼Œç»§ç»­éå†ï¼Œå¹¶ä¸”å†æ¬¡è°ƒç”¨`getLeafKeys`å‡½æ•°ï¼Œåˆ¤æ–­é€šè¿‡å¾ªç¯å–å‡ºæ¥çš„èŠ‚ç‚¹æ˜¯å¦æœ‰`children`å±æ€§ï¼Œä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚

ä¸‹é¢è¦æ€è€ƒçš„å°±æ˜¯ï¼Œä»€ä¹ˆæ—¶å€™è°ƒç”¨`getLeafKeys`æ–¹æ³•å‘¢ï¼Ÿ

```js
// å±•ç¤ºåˆ†é…æƒé™çš„å¯¹è¯æ¡†
    async showSetRightDialog(role) {
      // è·å–æ‰€æœ‰æƒé™çš„æ•°æ®
      const { data: res } = await this.$http.get("rights/tree");

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–æƒé™æ•°æ®å¤±è´¥ï¼");
      }

      // æŠŠè·å–åˆ°çš„æƒé™æ•°æ®ä¿å­˜åˆ° data ä¸­
      this.rightslist = res.data;
      // console.log(this.rightslist);
      // console.log(role);
      // é€’å½’è·å–ä¸‰çº§èŠ‚ç‚¹çš„Idï¼ˆå¼€å§‹çš„èŠ‚ç‚¹ä¸ºå½“å‰è§’è‰²ï¼‰
      this.getLeafKeys(role, this.defKeys);

      // å±•ç¤ºå‡ºå¯¹è¯æ¡†
      this.setRightDialogVisible = true;
    },
```

æˆ‘ä»¬æ˜¯åœ¨`showSetRightDialog`æ–¹æ³•ä¸­è°ƒç”¨çš„`getLeafKeys`æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç”¨æˆ·å•å‡»`åˆ†é…æƒé™`æŒ‰é’®ï¼Œå¼¹å‡ºå¯¹è¯æ¡†å‰ï¼Œå°±åº”è¯¥è·å–å½“å‰è§’è‰²å·²æœ‰çš„æƒé™ç¼–å·ï¼Œ

å¹¶ä¸”å­˜å‚¨åˆ°äº†`defkeys`æ•°ç»„ä¸­ï¼Œè¿™æ ·å½“å¯¹è¯æ¡†å±•ç¤ºå‡ºæ¥ä»¥åï¼Œå°±ä¼šåœ¨å¯¹è¯æ¡†ä¸­ä»¥æ ‘å½¢ç»“æ„å±•ç¤ºæ‰€æœ‰æƒé™ï¼Œå¹¶ä¸”å°†è§’è‰²å·²ç»æœ‰çš„æƒé™å‰é¢çš„å¤é€‰æ¡†é€‰ä¸­ã€‚

æœ€åï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°çš„`Bug`éœ€è¦è§£å†³ï¼Œå°±æ˜¯æˆ‘ä»¬è¿™é‡Œæ˜¯ä¸æ–­çš„å‘`defKeys`æ•°ç»„ä¸­æ·»åŠ å†…å®¹ï¼Œè¿™æ ·å°±ä¼šå‡ºç°å¦‚ä¸‹çš„é—®é¢˜ï¼šå½“ç»™ç¬¬ä¸€ä¸ªè§’è‰²åˆ†é…å®Œæƒé™åï¼Œå…³é—­çª—å£ï¼Œ

åˆç»™ç¬¬äºŒä¸ªè§’è‰²åˆ†é…æƒé™ï¼Œè¿™æ ·æ‰€æœ‰çš„æƒé™ç¼–å·éƒ½ç´¯åŠ åˆ°äº†`defkeys`æ•°ç»„ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œåœ¨çª—å£å…³é—­åï¼Œåº”è¯¥å°†`defKeys`æ•°ç»„ä¸­çš„å†…å®¹æ¸…ç©ºã€‚

```js
  // ç›‘å¬åˆ†é…æƒé™å¯¹è¯æ¡†çš„å…³é—­äº‹ä»¶
    setRightDialogClosed() {
      this.defKeys = []
    },
```

å…³é—­çª—å£çš„æ—¶å€™ï¼Œè°ƒç”¨ä¸Šé¢çš„æ–¹æ³•

```js
   <!-- åˆ†é…æƒé™çš„å¯¹è¯æ¡† -->
    <el-dialog
      title="åˆ†é…æƒé™"
      :visible.sync="setRightDialogVisible"
      width="50%"
      @close="setRightDialogClosed"
    >
```

## 4ã€å®Œæˆæƒé™çš„åˆ†é…

å½“å•å‡»çª—å£ä¸­çš„â€œç¡®å®šâ€æŒ‰é’®çš„æ—¶å€™ï¼Œå®Œæˆæƒé™çš„åˆ†é…ã€‚

```vue
<span slot="footer" class="dialog-footer">
        <el-button @click="setRightDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="allotRights">ç¡® å®š</el-button>
      </span>
```

ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®åï¼Œæ‰§è¡Œ`allotRights`æ–¹æ³•ã€‚

```js
  // ç‚¹å‡»ä¸ºè§’è‰²åˆ†é…æƒé™
    async allotRights() {
      const keys = [
        ...this.$refs.treeRef.getCheckedKeys(),
        ...this.$refs.treeRef.getHalfCheckedKeys(),
      ];

      const idStr = keys.join(",");

      const { data: res } = await this.$http.post(
        `roles/${this.roleId}/rights`,
        { rids: idStr }
      );

      if (res.meta.status !== 200) {
        return this.$message.error("åˆ†é…æƒé™å¤±è´¥ï¼");
      }

      this.$message.success("åˆ†é…æƒé™æˆåŠŸï¼");
      this.getRolesList();
      this.setRightDialogVisible = false;
    },
```

å‘é€åˆ°æœåŠ¡ç«¯çš„æƒé™ç¼–å·ï¼Œè¦æ±‚æœ‰é€‰ä¸­çš„å’ŒåŠé€‰ä¸­ï¼ˆå¦‚æœå­çº§æƒé™æ²¡æœ‰å…¨éƒ¨é€‰ä¸­ï¼Œåˆ™çˆ¶çº§æƒé™å¯¹åº”çš„å¤é€‰æ¡†æ˜¯å¤„äºåŠé€‰ä¸­çŠ¶æ€ï¼‰çš„æƒé™ç¼–å·ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡`el-tree`ç»„ä»¶çš„`getCheckedKeys`æ–¹æ³•è·å–å…¨é€‰çš„æƒé™ç¼–å·ï¼Œé€šè¿‡`getHalfCheckedKeys`æ–¹æ³•è·å–åŠé€‰çš„æƒé™ç¼–å·ã€‚

æ‰€ä»¥è¿™é‡Œè¿˜éœ€è¦ç»™`el-tree`æ·»åŠ `ref`å¼•ç”¨ã€‚

```vue
<el-tree
        :data="rightslist"
        :props="treeProps"
        show-checkbox
        node-key="id"
        default-expand-all
        :default-checked-keys="defKeys"
        ref="treeRef"//æ·»åŠ refå¼•ç”¨
      ></el-tree>
```

è·å–åˆ°æƒé™çš„å…¨é€‰çš„æƒé™ç¼–å·ä¸åŠé€‰çš„æƒé™ç¼–å·åï¼Œéœ€è¦æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ç”¨é€—å·åˆ†éš”ã€‚

å½“ç„¶ï¼Œåœ¨å‘é€åˆ°æœåŠ¡ç«¯ä¸­çš„å†…å®¹é™¤äº†æƒé™ç¼–å·çš„å†…å®¹ï¼Œè¿˜è¦æœ‰å¯¹åº”çš„è§’è‰²ç¼–å·ã€‚

å½“ç”¨æˆ·å•å‡»â€œåˆ†é…æƒé™â€æŒ‰é’®ï¼Œæ‰“å¼€çª—å£çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è·å–åˆ°äº†è§’è‰²ä¿¡æ¯ï¼Œåœ¨è¿™é‡Œå¯ä»¥å°†è·å–åˆ°çš„è§’è‰²çš„ç¼–å·å­˜å‚¨åˆ°`data`çŠ¶æ€å±æ€§ä¸­ã€‚

```js
 // å±•ç¤ºåˆ†é…æƒé™çš„å¯¹è¯æ¡†
    async showSetRightDialog(role) {
        //è·å–è¦åˆ†é…æƒé™çš„è§’è‰²ç¼–å·ã€‚
      this.roleId = role.id;
      // è·å–æ‰€æœ‰æƒé™çš„æ•°æ®
      const { data: res } = await this.$http.get("rights/tree");

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–æƒé™æ•°æ®å¤±è´¥ï¼");
      }

      // æŠŠè·å–åˆ°çš„æƒé™æ•°æ®ä¿å­˜åˆ° data ä¸­
      this.rightslist = res.data;
      // console.log(this.rightslist);
      // console.log("role=", role);
      // é€’å½’è·å–ä¸‰çº§èŠ‚ç‚¹çš„Id
      this.getLeafKeys(role, this.defKeys);

      // å±•ç¤ºå‡ºå¯¹è¯æ¡†
      this.setRightDialogVisible = true;
    },
```

åœ¨`data`ä¸­å®šä¹‰`roleId` å±æ€§

```js
data() {
    return {
      // æ‰€æœ‰è§’è‰²åˆ—è¡¨æ•°æ®
      rolelist: [],
      // æ§åˆ¶åˆ†é…æƒé™å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      setRightDialogVisible: false,
      // æ‰€æœ‰æƒé™çš„æ•°æ®
      rightslist: [],
      // æ ‘å½¢æ§ä»¶çš„å±æ€§ç»‘å®šå¯¹è±¡
      treeProps: {
        label: "authName",
        children: "children",
      },
      // é»˜è®¤é€‰ä¸­çš„èŠ‚ç‚¹Idå€¼æ•°ç»„
      defKeys: [],
      // å½“å‰å³å°†åˆ†é…æƒé™çš„è§’è‰²id
      roleId: "",
    };
```

ä»¥ä¸Šå®Œæˆäº†å¯¹è§’è‰²åˆ†é…æƒé™çš„åŠŸèƒ½ã€‚

## 5ã€ä¸ºç”¨æˆ·åˆ†é…è§’è‰²

**å±•ç¤ºä¸ºç”¨æˆ·åˆ†é…è§’è‰²çš„å¯¹è¯æ¡†**

åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦è¿”å›`components/user/Users.vue`ç»„ä»¶,ã€‚

é¦–å…ˆç»™ç”¨æˆ·è¡¨æ ¼ä¸­ï¼Œæ“ä½œåˆ—ä¸­çš„åˆ†é…è§’è‰²æŒ‰é’®æ·»åŠ å•å‡»äº‹ä»¶ã€‚

```vue
<!-- åˆ†é…è§’è‰²æŒ‰é’® -->
<el-tooltip effect="dark" content="åˆ†é…è§’è‰²" placement="top" :enterable="false">
              <el-button
                type="warning"
                icon="el-icon-setting"
                size="mini"
                @click="setRole(scope.row)"
              ></el-button>
            </el-tooltip>
```

è¿™æ—¶ä¼šå°†ç”¨æˆ·çš„ä¿¡æ¯ä¼ é€’åˆ°`setRole` æ–¹æ³•ä¸­ã€‚

åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼šæŸ¥è¯¢å‡ºæ‰€æœ‰çš„è§’è‰²ï¼Œç„¶åå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œåœ¨è¿™ä¸ªçª—å£ä¸­ï¼Œä¼šæ˜¾ç¤ºè¦åˆ†é…è§’è‰²çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶å°†æŸ¥è¯¢å‡ºçš„è§’è‰²æœ€ç»ˆä¼šç»‘å®šåˆ°ä¸‹æ‹‰æ¡†ä¸­ã€‚

```js
 // å±•ç¤ºåˆ†é…è§’è‰²çš„å¯¹è¯æ¡†
    async setRole(userInfo) {
      this.userInfo = userInfo;

      // åœ¨å±•ç¤ºå¯¹è¯æ¡†ä¹‹å‰ï¼Œè·å–æ‰€æœ‰è§’è‰²çš„åˆ—è¡¨
      const { data: res } = await this.$http.get("roles");
      if (res.meta.status !== 200) {
        return this.$message.error("è·å–è§’è‰²åˆ—è¡¨å¤±è´¥ï¼");
      }

      this.rolesList = res.data;

      this.setRoleDialogVisible = true;
    },
  },
```

åœ¨è°ƒç”¨`setRole`æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå°†å¯¹åº”çš„è¦åˆ†é…è§’è‰²çš„ç”¨æˆ·ä¿¡æ¯ä¼ é€’è¿‡æ¥ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç»™äº†`userInfo`è¿™ä¸ªå±æ€§ï¼Œæœ€ç»ˆä¼šå°†è¿™ä¸ªå±æ€§ä¸­å­˜å‚¨çš„å†…å®¹ä¼ é€’åˆ°çª—å£ä¸­è¿›è¡Œå±•ç¤ºã€‚

æ¥ä¸‹æ¥ï¼Œä¼šæŸ¥è¯¢æ‰€æœ‰çš„è§’è‰²ä¿¡æ¯ï¼Œå¹¶ä¸”äº¤ç»™`roleList`è¿™ä¸ªå±æ€§å­˜å‚¨ã€‚æœ€åå±•ç¤ºå¯¹åº”çš„å¯¹è¯æ¡†ã€‚

å¯¹è¯æ¡†å†…å®¹

```vue
<!-- åˆ†é…è§’è‰²çš„å¯¹è¯æ¡† -->
<el-dialog title="åˆ†é…è§’è‰²" :visible.sync="setRoleDialogVisible" width="50%">
      <div>
        <p>å½“å‰çš„ç”¨æˆ·ï¼š{{userInfo.username}}</p>
        <p>å½“å‰çš„è§’è‰²ï¼š{{userInfo.role_name}}</p>
        <p></p>
      </div>
      <span slot="footer" class="dialog-footer">
        <el-button @click="setRoleDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="saveRoleInfo">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

å¯¹åº”çš„å±æ€§å®šä¹‰å¦‚ä¸‹ï¼š

```js
 // æ§åˆ¶åˆ†é…è§’è‰²å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      setRoleDialogVisible: false,
      // éœ€è¦è¢«åˆ†é…è§’è‰²çš„ç”¨æˆ·ä¿¡æ¯
      userInfo: {},
      // æ‰€æœ‰è§’è‰²çš„æ•°æ®åˆ—è¡¨
      rolesList: [],
```

**å°†æŸ¥è¯¢å‡ºæ¥çš„è§’è‰²æ•°æ®ç»‘å®šåˆ°ä¸‹æ‹‰æ¡†ä¸­**

åœ¨åˆ†åˆ«è§’è‰²çš„å¯¹è¯æ¡†ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªä¸‹æ‹‰æ¡†ï¼Œ

```vue
<!-- åˆ†é…è§’è‰²çš„å¯¹è¯æ¡† -->
<el-dialog title="åˆ†é…è§’è‰²" :visible.sync="setRoleDialogVisible" width="50%">
      <div>
        <p>å½“å‰çš„ç”¨æˆ·ï¼š{{userInfo.username}}</p>
        <p>å½“å‰çš„è§’è‰²ï¼š{{userInfo.role_name}}</p>
        <p>
          åˆ†é…æ–°è§’è‰²ï¼š
          <el-select v-model="selectedRoleId" placeholder="è¯·é€‰æ‹©">
            <el-option
              v-for="item in rolesList"
              :key="item.id"
              :label="item.roleName"
              :value="item.id"
            ></el-option>
          </el-select>
        </p>

      </div>
      <span slot="footer" class="dialog-footer">
        <el-button @click="setRoleDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="saveRoleInfo">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¾ªç¯çš„æ–¹å¼ï¼Œå°†`rolesList`ä¸­å­˜å‚¨çš„è§’è‰²æ•°æ®å…¨éƒ¨å–å‡ºæ¥ç»‘å®šåˆ°äº†`select`ä¸­ã€‚ `label`å±æ€§è¡¨ç¤ºçš„æ˜¯ä¸‹æ‹‰æ¡†ä¸­å±•ç¤ºçš„å†…å®¹ï¼Œ`value`:è¡¨ç¤ºé€‰æ‹©åçš„å€¼ï¼ŒåŒæ—¶é€‰æ‹©åçš„å€¼ä¹Ÿå°±æ˜¯æ‰€é€‰æ‹©çš„è§’è‰²ç¼–å·ä¼šå­˜å‚¨åˆ°`selectedRoleId`ä¸­ã€‚

éœ€è¦åœ¨`data`ä¸­å®šä¹‰`selectedRoleId`å±æ€§ã€‚

```js
 // å·²é€‰ä¸­çš„è§’è‰²Idå€¼
      selectedRoleId: "",
```

åŒæ—¶å°†`Select`ä¸`Option`ç»„ä»¶è¿›è¡Œæ³¨å†Œ

```
Vue.use(Select)
Vue.use(Option)
```

ä¸‹é¢è¦å®ç°çš„å°±æ˜¯å•å‡»`åˆ†é…è§’è‰²å¯¹è¯æ¡†`ä¸­çš„â€œç¡®å®šâ€æŒ‰é’®åï¼Œå®Œæˆè§’è‰²çš„åˆ†é…ã€‚

**å®Œæˆç”¨æˆ·è§’è‰²çš„åˆ†é…**

`saveRoleInfo`æ–¹æ³•çš„å®ç°å¦‚ä¸‹

```js
   // ç‚¹å‡»æŒ‰é’®ï¼Œåˆ†é…è§’è‰²
    async saveRoleInfo() {
      if (!this.selectedRoleId) {
        return this.$message.error("è¯·é€‰æ‹©è¦åˆ†é…çš„è§’è‰²ï¼");
      }

      const { data: res } = await this.$http.put(
        `users/${this.userInfo.id}/role`,
        {
          rid: this.selectedRoleId,
        }
      );

      if (res.meta.status !== 200) {
        return this.$message.error("æ›´æ–°è§’è‰²å¤±è´¥ï¼");
      }

      this.$message.success("æ›´æ–°è§’è‰²æˆåŠŸï¼");
      this.getUserList();
      this.setRoleDialogVisible = false;
    },
```

# ä¹ã€å•†å“åˆ†ç±»

## 1ã€å•†å“åˆ†ç±»åŠŸèƒ½ä»‹ç»

å•†å“åˆ†ç±»ç”¨äºåœ¨è´­ç‰©æ—¶ï¼Œå¿«é€Ÿæ‰¾åˆ°æ‰€è¦è´­ä¹°çš„å•†å“ï¼Œå¯ä»¥é€šè¿‡ç”µå•†å¹³å°ä¸»é¡µç›´è§‚çš„çœ‹åˆ°ã€‚

## 2ã€å•†å“åˆ†ç±»ç»„ä»¶åŸºæœ¬åˆ›å»º

åœ¨`components`ç›®å½•ä¸‹é¢åˆ›å»º`goods`ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹é¢åˆ›å»º`Cate.vue`ä½œä¸ºå•†å“åˆ†ç±»ç»„ä»¶ã€‚

åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“åˆ†ç±»</el-breadcrumb-item>
    </el-breadcrumb>

    <!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
    <el-card>
      <el-row>
        <el-col>
          <el-button type="primary">æ·»åŠ åˆ†ç±»</el-button>
        </el-col>
      </el-row>

      <!-- è¡¨æ ¼åŒºåŸŸ -->
      <!-- åˆ†é¡µåŒºåŸŸ -->
    </el-card>
  </div>
</template>
<script>
export default {};
</script>
<style scoped></style>
```

è®¾ç½®å¯¹åº”çš„è·¯ç”±å†…å®¹

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
import Roles from "./components/power/Roles.vue";
import Cate from "./components/goods/Cate.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
        { path: "/categories", component: Cate },
      ],
    },
  ],
});
```

## 3ã€è·å–å•†å“åˆ†ç±»æ•°æ®

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“åˆ†ç±»</el-breadcrumb-item>
    </el-breadcrumb>

    <!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
    <el-card>
      <el-row>
        <el-col>
          <el-button type="primary">æ·»åŠ åˆ†ç±»</el-button>
        </el-col>
      </el-row>

      <!-- è¡¨æ ¼åŒºåŸŸ -->
      <!-- åˆ†é¡µåŒºåŸŸ -->
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      // æŸ¥è¯¢æ¡ä»¶
      querInfo: {
        type: 3, //è¡¨ç¤ºå±•ç¤ºçš„æ˜¯ä¸‰çº§åˆ†ç±»
        pagenum: 1,
        pagesize: 5,
      },
      // å•†å“åˆ†ç±»çš„æ•°æ®åˆ—è¡¨ï¼Œé»˜è®¤ä¸ºç©º
      catelist: [],
      // æ€»æ•°æ®æ¡æ•°
      total: 0,
    };
  },
  created() {
    this.getCateList();
  },
  methods: {
    // è·å–å•†å“åˆ†ç±»æ•°æ®
    async getCateList() {
      const { data: res } = await this.$http.get("categories", {
        params: this.querInfo,
      });

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å•†å“åˆ†ç±»å¤±è´¥ï¼");
      }

      console.log(res.data);
      // æŠŠæ•°æ®åˆ—è¡¨ï¼Œèµ‹å€¼ç»™ catelist
      this.catelist = res.data.result;
      // ä¸ºæ€»æ•°æ®æ¡æ•°èµ‹å€¼
      this.total = res.data.total;
    },
  },
};
</script>
<style scoped></style>
```

## 4ã€ä½¿ç”¨`vue-table-width-tree-grid`å±•ç¤ºæ•°æ®

`vue-table-with-tree-grid` æ˜¯ä¸€ä¸ªæ ‘å½¢çš„è¡¨æ ¼æ’ä»¶

å®‰è£…

```
npm i vue-table-with-tree-grid
```

å®‰è£…å¥½ä»¥åï¼Œåœ¨`main.js`æ–‡ä»¶ä¸­æ³¨å†Œè¯¥ç»„ä»¶

å¯¼å…¥`vue-table-with-tree-grid`ç»„ä»¶

```
import TreeTable from "vue-table-with-tree-grid";
```

æ³¨å†Œç»„ä»¶

```
//æ³¨å†ŒTreeTableç»„ä»¶
Vue.component("tree-table", TreeTable);
```

```js
import Vue from "vue";
import App from "./App.vue";
import router from "./router";
import "./plugins/element.js";
import "./assets/css/global.css";
import "./assets/fonts/iconfont.css";
//å¯¼å…¥vue-table-with-tree-grid
import TreeTable from "vue-table-with-tree-grid";
import axios from "axios";
// é…ç½®è¯·æ±‚çš„è·Ÿè·¯å¾„
axios.defaults.baseURL = "http://127.0.0.1:8888/api/private/v1/";
axios.interceptors.request.use((config) => {
  // console.log(config)
  config.headers.Authorization = window.sessionStorage.getItem("token");
  //æœ€åå¿…é¡»è¿”å›config
  return config;
});
Vue.prototype.$http = axios;

Vue.config.productionTip = false;
//æ³¨å†ŒTreeTableç»„ä»¶
Vue.component("tree-table", TreeTable);
new Vue({
  router,
  render: (h) => h(App),
}).$mount("#app");
```

åœ¨`Cate.vue`ä¸­ä½¿ç”¨è¡¨æ ¼

```vue
<!-- è¡¨æ ¼åŒºåŸŸ -->

<tree-table
  :data="catelist"
  :columns="columns"
  :selection-type="false"
  :expand-type="false"
  show-index
  index-text="#"
  border
  :show-row-hover="false"
>
      </tree-table>
```

é…ç½®è¡¨æ ¼ä¸­çš„åˆ—(`columns`)

```js
export default {
  data() {
    return {
      // æŸ¥è¯¢æ¡ä»¶
      querInfo: {
        type: 3,
        pagenum: 1,
        pagesize: 5,
      },
      // å•†å“åˆ†ç±»çš„æ•°æ®åˆ—è¡¨ï¼Œé»˜è®¤ä¸ºç©º
      catelist: [],
      // æ€»æ•°æ®æ¡æ•°
      total: 0,
      // ä¸ºtableæŒ‡å®šåˆ—çš„å®šä¹‰
      columns: [
        {
          label: "åˆ†ç±»åç§°",
          prop: "cat_name",
        },
      ],
    };
  },
```

## 5ã€ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿åˆ—æ¸²æŸ“è¡¨æ ¼æ•°æ®

ä¸‹é¢æˆ‘ä»¬éœ€è¦åœ¨`å•†å“åˆ†ç±»`è¿™ä¸ªè¡¨æ ¼ä¸­å±•ç¤º"æ˜¯å¦æœ‰æ•ˆ"è¿™ä¸€åˆ—çš„æ•°æ®ã€‚è€Œè¿™ä¸€åˆ—æ•°æ®éœ€è¦å±•ç¤ºå‡ºç›¸åº”çš„å›¾æ ‡å†…å®¹ï¼Œ

æ‰€ä»¥éœ€è¦ç”¨åˆ°è‡ªå®šä¹‰æ¨¡æ¿åˆ—æ¥æ¸²æŸ“å¯¹åº”çš„æ•°æ®ã€‚

```vue
<!-- è¡¨æ ¼åŒºåŸŸ -->

<tree-table
  :data="catelist"
  :columns="columns"
  :selection-type="false"
  :expand-type="false"
  show-index
  index-text="#"
  border
  :show-row-hover="false"
>
        <!-- æ˜¯å¦æœ‰æ•ˆ -->
        <template slot="isok" slot-scope="scope">
          <i
            class="el-icon-success"
            v-if="scope.row.cat_deleted === false"
            style="color: lightgreen;"
          ></i>
          <i class="el-icon-error" v-else style="color: red;"></i>
        </template>
      </tree-table>
```

åœ¨è¡¨æ ¼ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªæ¨¡æ¿åˆ—åŒæ—¶é€šè¿‡ä½œç”¨åŸŸæ’æ§½è·å–å¯¹åº”çš„æ•°æ®ã€‚

å…³äºæ’æ§½`isok`çš„å®šä¹‰å¦‚ä¸‹

```js
 // ä¸ºtableæŒ‡å®šåˆ—çš„å®šä¹‰
      columns: [
        {
          label: "åˆ†ç±»åç§°",
          prop: "cat_name",
        },
        {
          label: "æ˜¯å¦æœ‰æ•ˆ",
          // è¡¨ç¤ºï¼Œå°†å½“å‰åˆ—å®šä¹‰ä¸ºæ¨¡æ¿åˆ—
          type: "template",
          // è¡¨ç¤ºå½“å‰è¿™ä¸€åˆ—ä½¿ç”¨æ¨¡æ¿åç§°
          template: "isok",
        },
      ],
```

é€šè¿‡`label`å®šä¹‰å½“å‰åˆ—çš„æ ‡é¢˜ï¼Œ`type:'template'`:è¡¨ç¤ºå½“å‰åˆ—ä¸ºæ¨¡æ¿åˆ—ï¼ŒåŒæ—¶`template`è¡¨ç¤ºè¿™ä¸€åˆ—ä½¿ç”¨æ¨¡æ¿çš„åç§°ã€‚

ä¸‹é¢æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä½¿ç”¨åŒæ ·çš„æ–¹å¼ï¼Œå°†â€œæ’åºâ€åˆ—ä¸â€œæ“ä½œâ€åˆ—çš„å†…å®¹ç»™æ„å»ºå‡ºæ¥ã€‚

```vue
<!-- è¡¨æ ¼åŒºåŸŸ -->

<tree-table
  :data="catelist"
  :columns="columns"
  :selection-type="false"
  :expand-type="false"
  show-index
  index-text="#"
  border
  :show-row-hover="false"
>
        <!-- æ˜¯å¦æœ‰æ•ˆ -->
        <template slot="isok" slot-scope="scope">
          <i
            class="el-icon-success"
            v-if="scope.row.cat_deleted === false"
            style="color: lightgreen;"
          ></i>
          <i class="el-icon-error" v-else style="color: red;"></i>
        </template>

        <!-- æ’åº -->
        <template slot="order" slot-scope="scope">
          <el-tag size="mini" v-if="scope.row.cat_level === 0">ä¸€çº§</el-tag>
          <el-tag
            type="success"
            size="mini"
            v-else-if="scope.row.cat_level === 1"
            >äºŒçº§</el-tag
          >
          <el-tag type="warning" size="mini" v-else>ä¸‰çº§</el-tag>
        </template>
        <!-- æ“ä½œ -->
        <template slot="opt">
          <el-button type="primary" icon="el-icon-edit" size="mini"
            >ç¼–è¾‘</el-button
          >
          <el-button type="danger" icon="el-icon-delete" size="mini"
            >åˆ é™¤</el-button
          >
        </template>
      </tree-table>
```

å¯¹åº”çš„æ•°æ®å¦‚ä¸‹ï¼š

```js
   // ä¸ºtableæŒ‡å®šåˆ—çš„å®šä¹‰
      columns: [
        {
          label: "åˆ†ç±»åç§°",
          prop: "cat_name",
        },
        {
          label: "æ˜¯å¦æœ‰æ•ˆ",
          // è¡¨ç¤ºï¼Œå°†å½“å‰åˆ—å®šä¹‰ä¸ºæ¨¡æ¿åˆ—
          type: "template",
          // è¡¨ç¤ºå½“å‰è¿™ä¸€åˆ—ä½¿ç”¨æ¨¡æ¿åç§°
          template: "isok",
        },
        {
          label: "æ’åº",
          // è¡¨ç¤ºï¼Œå°†å½“å‰åˆ—å®šä¹‰ä¸ºæ¨¡æ¿åˆ—
          type: "template",
          // è¡¨ç¤ºå½“å‰è¿™ä¸€åˆ—ä½¿ç”¨æ¨¡æ¿åç§°
          template: "order",
        },
        {
          label: "æ“ä½œ",
          // è¡¨ç¤ºï¼Œå°†å½“å‰åˆ—å®šä¹‰ä¸ºæ¨¡æ¿åˆ—
          type: "template",
          // è¡¨ç¤ºå½“å‰è¿™ä¸€åˆ—ä½¿ç”¨æ¨¡æ¿åç§°
          template: "opt",
        },
      ],
```

## 6ã€åˆ†é¡µåŠŸèƒ½å®ç°

```vue
<!-- åˆ†é¡µåŒºåŸŸ -->
<el-pagination
  @size-change="handleSizeChange"
  @current-change="handleCurrentChange"
  :current-page="querInfo.pagenum"
  :page-sizes="[3, 5, 10, 15]"
  :page-size="querInfo.pagesize"
  layout="total, sizes, prev, pager, next, jumper"
  :total="total"
>
      </el-pagination>
```

å¯¹åº”æ–¹æ³•çš„å®ç°

```js
// ç›‘å¬ pagesize æ”¹å˜
    handleSizeChange(newSize) {
      this.querInfo.pagesize = newSize;
      this.getCateList();
    },
    // ç›‘å¬ pagenum æ”¹å˜
    handleCurrentChange(newPage) {
      this.querInfo.pagenum = newPage;
      this.getCateList();
    },
```

## 7ã€æ„å»ºæ·»åŠ åˆ†ç±»çš„å¯¹è¯æ¡†ä¸è¡¨å•

å½“å•å‡»â€œæ·»åŠ åˆ†ç±»â€æŒ‰é’®ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œåœ¨è¿™ä¸ªçª—å£ä¸­å±•ç¤ºå¯¹åº”çš„è¡¨å•ã€‚

ä¸‹é¢å…ˆåˆ›å»ºæ·»åŠ åˆ†ç±»çš„å¯¹è¯æ¡†,å¹¶ä¸”åœ¨å¯¹è¯æ¡†ä¸­æ·»åŠ è¡¨å•

```vue
<!-- æ·»åŠ åˆ†ç±»çš„å¯¹è¯æ¡† -->
<el-dialog title="æ·»åŠ åˆ†ç±»" :visible.sync="addCateDialogVisible" width="50%">
      <!-- æ·»åŠ åˆ†ç±»çš„è¡¨å• -->
      <el-form
        :model="addCateForm"
        :rules="addCateFormRules"
        ref="addCateFormRef"
        label-width="100px"
      >
        <el-form-item label="åˆ†ç±»åç§°ï¼š" prop="cat_name">
          <el-input v-model="addCateForm.cat_name"></el-input>
        </el-form-item>
        <el-form-item label="çˆ¶çº§åˆ†ç±»ï¼š"> </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="addCateDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

ä¸‹é¢å®šä¹‰å¯¹åº”çš„æ•°æ®ï¼Œä»¥åŠæ ¡éªŒè§„åˆ™

```js
 // æ§åˆ¶æ·»åŠ åˆ†ç±»å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      addCateDialogVisible: false,
      // æ·»åŠ åˆ†ç±»çš„è¡¨å•æ•°æ®å¯¹è±¡(è¿™é‡Œéœ€è¦å‚æ•°APIæ–‡æ¡£)
      addCateForm: {
        // å°†è¦æ·»åŠ çš„åˆ†ç±»çš„åç§°
        cat_name: "",
        // çˆ¶çº§åˆ†ç±»çš„Id
        cat_pid: 0,
        // åˆ†ç±»çš„ç­‰çº§ï¼Œé»˜è®¤è¦æ·»åŠ çš„æ˜¯1çº§åˆ†ç±»
        cat_level: 0,
      },
      // æ·»åŠ åˆ†ç±»è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      addCateFormRules: {
        cat_name: [
          { required: true, message: "è¯·è¾“å…¥åˆ†ç±»åç§°", trigger: "blur" },
        ],
      },
```

å½“å•å‡»â€œæ·»åŠ åˆ†ç±»â€æŒ‰é’®åï¼Œå¼¹å‡ºçª—å£

```html
<el-button type="primary" @click="showAddCateDialog">æ·»åŠ åˆ†ç±»</el-button>
```

`showAddCateDialog`æ–¹æ³•çš„å®ç°å¦‚ä¸‹

```js
 // ç‚¹å‡»æŒ‰é’®ï¼Œå±•ç¤ºæ·»åŠ åˆ†ç±»çš„å¯¹è¯æ¡†
    showAddCateDialog() {
      // å†å±•ç¤ºå‡ºå¯¹è¯æ¡†
      this.addCateDialogVisible = true;
    },
```

## 8ã€è·å–çˆ¶çº§åˆ†ç±»æ•°æ®

åœ¨å¼¹å‡ºçš„æ·»åŠ åˆ†ç±»çª—å£ä¸­ï¼Œè¿˜éœ€è¦ä¸ºå…¶æ·»åŠ ä¸€ä¸ªä¸‹æ‹‰æ¡†ï¼Œåœ¨ä¸‹æ‹‰æ¡†ä¸­å±•ç¤ºçˆ¶çº§çš„ç±»åˆ«æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ·»åŠ æŸä¸ªç±»åˆ«çš„æ—¶å€™ï¼Œå¯ä»¥ç¡®å®šå…¶çˆ¶ç±»ã€‚

ç°åœ¨å…ˆè·å–ç³»ç»Ÿä¸­æ‰€æœ‰çš„çˆ¶ç±»çš„æ•°æ®(è¿™é‡Œåªè·å–å‰ä¸¤çº§ï¼Œç³»ç»Ÿå…±åˆ†ä¸º 3 çº§)

é¦–å…ˆå®šä¹‰è·å–çˆ¶çº§ç±»åˆ«æ•°æ®çš„æ–¹æ³•

```js
    // è·å–çˆ¶çº§åˆ†ç±»çš„æ•°æ®åˆ—è¡¨
    async getParentCateList() {
      const { data: res } = await this.$http.get("categories", {
        params: { type: 2 },//è¿™é‡Œåªè·å–ä¸¤çº§
      });

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–çˆ¶çº§åˆ†ç±»æ•°æ®å¤±è´¥ï¼");
      }

      console.log(res.data);
      //æŠŠè·å–åˆ°çš„çˆ¶ç±»æ•°æ®èµ‹å€¼ç»™parentCateListå±æ€§
      this.parentCateList = res.data;
    },
```

`getParentCateList`æ–¹æ³•çš„è°ƒç”¨æ˜¯åœ¨çª—å£æ‰“å¼€çš„æ—¶å€™è¢«è°ƒç”¨çš„ã€‚

```js
 // ç‚¹å‡»æŒ‰é’®ï¼Œå±•ç¤ºæ·»åŠ åˆ†ç±»çš„å¯¹è¯æ¡†
    showAddCateDialog() {
      // å…ˆè·å–çˆ¶çº§åˆ†ç±»çš„æ•°æ®åˆ—è¡¨
      this.getParentCateList();
      // å†å±•ç¤ºå‡ºå¯¹è¯æ¡†
      this.addCateDialogVisible = true;
    },
```

åŒæ—¶åœ¨`data`ä¸­å®šä¹‰`parentCateList`å±æ€§ï¼Œå­˜å‚¨è·å–åˆ°çš„ç±»åˆ«æ•°æ®ã€‚

```js
   // çˆ¶çº§åˆ†ç±»çš„åˆ—è¡¨
      parentCateList: [],
```

ä¸‹é¢æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†`parentCateList`ä¸­å­˜å‚¨çš„ç±»åˆ«æ•°æ®ç»‘å®šåˆ°ä¸‹æ‹‰æ¡†ä¸­ã€‚

## 9ã€æ¸²æŸ“çº§è”é€‰æ‹©å™¨

ä¸‹é¢æˆ‘ä»¬éœ€è¦åœ¨å¼¹å‡ºçš„çª—å£çš„è¡¨å•ä¸­æ·»åŠ ä¸€ä¸ªçº§è”çš„ç»„ä»¶`el-cascader`

```vue
<!-- æ·»åŠ åˆ†ç±»çš„å¯¹è¯æ¡† -->
<el-dialog title="æ·»åŠ åˆ†ç±»" :visible.sync="addCateDialogVisible" width="50%">
      <!-- æ·»åŠ åˆ†ç±»çš„è¡¨å• -->
      <el-form
        :model="addCateForm"
        :rules="addCateFormRules"
        ref="addCateFormRef"
        label-width="100px"
      >
        <el-form-item label="åˆ†ç±»åç§°ï¼š" prop="cat_name">
          <el-input v-model="addCateForm.cat_name"></el-input>
        </el-form-item>
        <el-form-item label="çˆ¶çº§åˆ†ç±»ï¼š">
          <!-- options ç”¨æ¥æŒ‡å®šæ•°æ®æº -->
          <!-- props ç”¨æ¥æŒ‡å®šé…ç½®å¯¹è±¡ï¼Œ -->
          <!-- v-model="selectedKeys":åœ¨çº§è”æ¡†ä¸­é€‰æ‹©çš„ç±»åˆ«çš„ç¼–å·éƒ½å­˜å‚¨åˆ°selectedKeysæ•°ç»„ä¸­-->
          <!-- å½“é€‰æ‹©ä¸åŒçš„å†…å®¹ï¼Œä¼šè§¦å‘changeäº‹ä»¶,è¿™æ—¶`selectedKeys`æ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯é€‰æ‹©é¡¹çš„id -->
          <el-cascader
            expand-trigger="hover"
            :options="parentCateList"
            :props="cascaderProps"
            v-model="selectedKeys"
            @change="parentCateChanged"
            clearable
          
          >
          </el-cascader>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="addCateDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

`props`ä¸­çš„`cascaderProps`å®šä¹‰å¦‚ä¸‹ï¼š

```js
  // æŒ‡å®šçº§è”é€‰æ‹©å™¨çš„é…ç½®å¯¹è±¡
      cascaderProps: {
        // value:è¡¨ç¤ºé€‰æ‹©ä¸€é¡¹åè·å–åˆ°çš„å€¼
        value: "cat_id",
        //è¡¨ç¤ºåœ¨çº§è”çª—å£ä¸­æ˜¾ç¤ºçš„å†…å®¹
        label: "cat_name",
        //childrenè¡¨ç¤ºçš„æ˜¯çˆ¶å­å…³ç³»ï¼Œè¿™é‡Œä¹Ÿæ˜¯é€šè¿‡æœåŠ¡ç«¯è¿”å›çš„`children`æ¥æŒ‡å®šå†…å®¹çš„çˆ¶å­å…³ç³»
        children: "children",
      },
```

`selectedKeys`å®šä¹‰

```js
      // é€‰ä¸­çš„çˆ¶çº§åˆ†ç±»çš„Idæ•°ç»„
      selectedKeys: [],
```

`parentCateChanged`æ–¹æ³•çš„å®ç°

```js
 // é€‰æ‹©é¡¹å‘ç”Ÿå˜åŒ–è§¦å‘è¿™ä¸ªå‡½æ•°
    parentCateChanged() {
      console.log(this.selectedKeys);
    },
```

æœ€åéœ€è¦æ³¨å†Œï¼š`Vue.use(Cascader);`

## 10ã€æ ¹æ®çˆ¶åˆ†ç±»çš„å˜åŒ–å¤„ç†è¡¨å•ä¸­çš„æ•°æ®

æˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬å•å‡»â€œæ·»åŠ åˆ†ç±»â€çª—å£ä¸­çš„â€œç¡®å®šâ€æŒ‰é’®çš„æ—¶å€™ï¼Œéœ€è¦å°†`ç±»åˆ«`è¡¨å•ä¸­çš„æ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ã€‚

è€Œè¡¨å•æ˜¯ä¸`addCateForm`å¯¹è±¡ç»‘å®šåœ¨ä¸€èµ·çš„ã€‚è¯¥å¯¹è±¡åœ¨`data`ä¸­çš„å®šä¹‰å¦‚ä¸‹ï¼š

```js
 // æ·»åŠ åˆ†ç±»çš„è¡¨å•æ•°æ®å¯¹è±¡(è¿™é‡Œéœ€è¦å‚æ•°APIæ–‡æ¡£)
      addCateForm: {
        // å°†è¦æ·»åŠ çš„åˆ†ç±»çš„åç§°
        cat_name: "",
        // çˆ¶çº§åˆ†ç±»çš„Id
        cat_pid: 0,
        // åˆ†ç±»çš„ç­‰çº§ï¼Œé»˜è®¤è¦æ·»åŠ çš„æ˜¯1çº§åˆ†ç±»
        cat_level: 0,
      },
```

é¦–å…ˆ`cat_name`å±æ€§çš„å€¼å·²ç»ç¡®å®šäº†ï¼Œå°±æ˜¯ç”¨æˆ·åœ¨â€œåˆ†ç±»åç§°â€æ–‡æœ¬æ¡†ä¸­è¾“å…¥çš„å†…å®¹ã€‚

ç°åœ¨`cat_pid`ä¸`cat_level`å±æ€§çš„å€¼æ²¡æœ‰ç¡®å®šã€‚

ä½†æ˜¯è¦æƒ³ç¡®å®šè¿™ä¸¤ä¸ªå±æ€§çš„å€¼ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°`el-cascader`ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·åœ¨è¯¥ç»„ä»¶ä¸­é€‰æ‹©çš„çˆ¶ç±»åˆ«ã€‚

æˆ‘ä»¬çŸ¥é“å½“é€‰æ‹©`el-cascader`ä¸­çš„ä¸åŒç±»åˆ«æ—¶ä¼šè§¦å‘`change`äº‹ä»¶ï¼Œåœ¨å¯¹åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°`parentCateChanged`ä¸­,ç¡®å®š`cat_pid`ä¸`cat_level`è¿™ä¸¤ä¸ªå±æ€§çš„å€¼ã€‚

```js
  // é€‰æ‹©é¡¹å‘ç”Ÿå˜åŒ–è§¦å‘è¿™ä¸ªå‡½æ•°
    parentCateChanged() {
      console.log(this.selectedKeys);
      // å¦‚æœ selectedKeys æ•°ç»„ä¸­çš„ length å¤§äº0ï¼Œè¯æ˜é€‰ä¸­çš„çˆ¶çº§åˆ†ç±»
      // åä¹‹ï¼Œå°±è¯´æ˜æ²¡æœ‰é€‰ä¸­ä»»ä½•çˆ¶çº§åˆ†ç±»
      if (this.selectedKeys.length > 0) {
        // çˆ¶çº§åˆ†ç±»çš„Id
        this.addCateForm.cat_pid = this.selectedKeys[
          this.selectedKeys.length - 1
        ];
        // ä¸ºå½“å‰åˆ†ç±»çš„ç­‰çº§èµ‹å€¼
        this.addCateForm.cat_level = this.selectedKeys.length;
        return;
      } else {
        // çˆ¶çº§åˆ†ç±»çš„Id
        this.addCateForm.cat_pid = 0;
        // ä¸ºå½“å‰åˆ†ç±»çš„ç­‰çº§èµ‹å€¼
        this.addCateForm.cat_level = 0;
      }
    },
```

é¦–å…ˆåˆ¤æ–­`selectedKeys`æ•°ç»„ä¸­æ˜¯å¦æœ‰å€¼ï¼Œæˆ‘ä»¬çŸ¥é“å½“ç”¨æˆ·é€‰æ‹©ä¸‹æ‹‰æ¡†ä¸­çš„ç±»åˆ«æ•°æ®æ—¶ï¼Œå¯¹åº”çš„æ‰€é€‰æ‹©çš„ç±»åˆ«çš„ç¼–å·ä¼šå­˜å‚¨åˆ°`selectedKeys`æ•°ç»„ä¸­ï¼Œå¦‚æœè¯¥æ•°ç»„æ²¡æœ‰å€¼ï¼Œè¡¨æ˜ç”¨æˆ·æ²¡æœ‰é€‰æ‹©ä»»ä½•ç±»åˆ«ã€‚é‚£ä¹Ÿå°±æ˜¯è¯´ç°åœ¨ç”¨æˆ·æ‰€æ·»åŠ çš„ç±»åˆ«æ˜¯æ ¹ç±»åˆ«ï¼Œæ‰€ä»¥`cat_pid`ä¸`cat_level`çš„å€¼éƒ½ä¸º 0.

å¦‚æœ`selectedKeys`æ•°ç»„ä¸­æœ‰å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å–å‡ºæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ª`id`å€¼ä½œä¸ºå½“å‰æ‰€æ·»åŠ ç±»åˆ«çš„çˆ¶ç±»åˆ«ç¼–å·ã€‚

ä¾‹å¦‚ï¼šå¦‚æœ`selectedKeys`æ•°ç»„ä¸­çš„å€¼ä¸º:[12,13] è¡¨æ˜ç”¨æˆ·é€‰æ‹©äº†ç¼–å·ä¸º`12`è¿™ä¸ªæ ¹ä¸‹çš„ç¼–å·ä¸º`13`çš„ç±»åˆ«ï¼Œè¿™æ—¶æ–°æ·»åŠ çš„ç±»åˆ«å°±æ˜¯ç¼–å·ä¸º`13`çš„å­ç±»åˆ«ã€‚

é€šè¿‡ä»¥ä¸Šçš„å¤„ç†ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿç¡®å®šå‡º`cat_pid`è¿™ä¸ªå±æ€§çš„å€¼ã€‚

ä¸‹é¢æ€è€ƒä¸€ä¸‹æ€æ ·ç¡®å®š`cat_level`è¿™ä¸ªå±æ€§çš„å€¼ï¼Ÿ

è¯¥å±æ€§è¡¨ç¤ºçš„æ˜¯å½“å‰ç±»åˆ«çš„ç­‰çº§ã€‚å¦‚æœæ˜¯ä¸€çº§åˆ™è¯¥å±æ€§çš„å€¼ä¸º 0ï¼ŒäºŒçº§ä¸º 1ï¼Œä¸‰çº§ä¸º 2.æ‰€ä»¥è¿™é‡Œå¯ä»¥æ ¹æ®æ•°ç»„çš„é•¿åº¦æ¥ç¡®å®šå‡º`cat_level`çš„å€¼ã€‚è¿˜æ˜¯ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå¦‚æœ`selectedKeys`æ•°ç»„ä¸­çš„å€¼ä¸º[12,13],é‚£ä¹ˆè·å–åˆ°çš„æ•°ç»„é•¿åº¦çš„å€¼ä¸º 2ï¼Œè¡¨æ˜ç°åœ¨æ‰€æ·»åŠ çš„ç±»åˆ«çš„ç­‰çº§å€¼ä¸º 2ï¼Œä¹Ÿå°±æ˜¯ä¸‰çº§ã€‚

æœ€åå¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼š

ç»™çª—å£çš„ç¡®å®šæŒ‰é’®ï¼Œæ·»åŠ å•å‡»äº‹ä»¶

```vue
<span slot="footer" class="dialog-footer">
        <el-button @click="addCateDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="addCate">ç¡® å®š</el-button>
      </span>
```

`addCate`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
  // ç‚¹å‡»æŒ‰é’®ï¼Œæ·»åŠ æ–°çš„åˆ†ç±»
    addCate() {
      console.log(this.addCateForm);
    },
```

å¯ä»¥æ‰“å°`addCateForm`ä¸­çš„å€¼ã€‚

## 11ã€å®Œæˆç±»åˆ«æ·»åŠ 

æœ€ç»ˆçš„`addCate`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
   // ç‚¹å‡»æŒ‰é’®ï¼Œæ·»åŠ æ–°çš„åˆ†ç±»
    addCate() {
      //   console.log(this.addCateForm);
      this.$refs.addCateFormRef.validate(async (valid) => {
        if (!valid) return;
        const { data: res } = await this.$http.post(
          "categories",
          this.addCateForm
        );

        if (res.meta.status !== 201) {
          return this.$message.error("æ·»åŠ åˆ†ç±»å¤±è´¥ï¼");
        }

        this.$message.success("æ·»åŠ åˆ†ç±»æˆåŠŸï¼");
        this.getCateList();
        this.addCateDialogVisible = false;
      });
    },
```

å°†`addCateForm`ä¸­å­˜å‚¨çš„æ•°æ®é€šè¿‡`post`æ–¹å¼å‘é€åˆ°æœåŠ¡ç«¯ã€‚

# åã€åˆ†ç±»å‚æ•°

## 1ã€åˆ†ç±»å‚æ•°åŠŸèƒ½ä»‹ç»

å•†å“å‚æ•°ç”¨äºæ˜¾ç¤ºå•†å“çš„å›ºå®šçš„ç‰¹å¾ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ç”µå•†å¹³å°å•†å“è¯¦æƒ…é¡µé¢ç›´è§‚çœ‹åˆ°ã€‚

![](images/58.png)

![](images/12.png)

## 2ã€æ„å»ºåˆ†ç±»å‚æ•°ç»„ä»¶

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>å‚æ•°åˆ—è¡¨</el-breadcrumb-item>
    </el-breadcrumb>

    <!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
    <el-card>
      <!-- è­¦å‘ŠåŒºåŸŸ -->
      <el-alert
        show-icon
        title="æ³¨æ„ï¼šåªå…è®¸ä¸ºç¬¬ä¸‰çº§åˆ†ç±»è®¾ç½®ç›¸å…³å‚æ•°ï¼"
        type="warning"
        :closable="false"
      ></el-alert>

      <!-- é€‰æ‹©å•†å“åˆ†ç±»åŒºåŸŸ -->
      <el-row class="cat_opt">
        <el-col>
          <span>é€‰æ‹©å•†å“åˆ†ç±»ï¼š</span>
          <!-- é€‰æ‹©å•†å“åˆ†ç±»çš„çº§è”é€‰æ‹©æ¡† -->
          <el-cascader
            expand-trigger="hover"
            :options="catelist"
            :props="cateProps"
            v-model="selectedCateKeys"
            @change="handleChange"
          >
          </el-cascader>
        </el-col>
      </el-row>
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      // å•†å“åˆ†ç±»åˆ—è¡¨
      catelist: [],
      // çº§è”é€‰æ‹©æ¡†çš„é…ç½®å¯¹è±¡
      cateProps: {
        value: "cat_id",
        label: "cat_name",
        children: "children",
      },
      // çº§è”é€‰æ‹©æ¡†åŒå‘ç»‘å®šåˆ°çš„æ•°ç»„
      selectedCateKeys: [],
    };
  },
  created() {
    this.getCateList();
  },

  methods: {
    // è·å–æ‰€æœ‰çš„å•†å“åˆ†ç±»åˆ—è¡¨
    async getCateList() {
      const { data: res } = await this.$http.get("categories");
      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å•†å“åˆ†ç±»å¤±è´¥ï¼");
      }

      this.catelist = res.data;

      console.log(this.catelist);
    },
    // çº§è”é€‰æ‹©æ¡†é€‰ä¸­é¡¹å˜åŒ–ï¼Œä¼šè§¦å‘è¿™ä¸ªå‡½æ•°
    handleChange() {
      //   console.log(this.selectedCateKeys);
      this.getParamsData();
    },
    // è·å–å‚æ•°çš„åˆ—è¡¨æ•°æ®
    async getParamsData() {
      // è¯æ˜é€‰ä¸­çš„ä¸æ˜¯ä¸‰çº§åˆ†ç±»
      //è¿™é‡Œåªå…è®¸é€‰æ‹©ç¬¬ä¸‰ä¸ªç±»åˆ«ã€‚
      if (this.selectedCateKeys.length !== 3) {
        this.selectedCateKeys = [];
        return;
      }
    },
  },
};
</script>
<style scoped>
.cat_opt {
  margin: 15px 0;
}
</style>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ„å»ºäº†çº§è”é€‰æ‹©æ¡†ï¼Œå¹¶ä¸”è·å–äº†ç±»åˆ«æ•°æ®ï¼Œå¡«å……åˆ°çº§è”é€‰æ‹©æ¡†ä¸­ã€‚

åŒæ—¶ï¼Œè¿™é‡Œå¯¹çº§è”é€‰æ‹©æ¡†ä¸­çš„ç±»åˆ«é€‰æ‹©æœ‰è¦æ±‚ï¼Œåªèƒ½é€‰æ‹©ç¬¬ä¸‰ä¸ªç±»åˆ«ã€‚

ä¸‹é¢åˆ›å»ºè·¯ç”±

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
import Roles from "./components/power/Roles.vue";
import Cate from "./components/goods/Cate.vue";
import Params from "./components/goods/Params.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
        { path: "/categories", component: Cate },
        { path: "/params", component: Params },
      ],
    },
  ],
});
```

åŒæ—¶ï¼Œç”±äºåœ¨æ•´ä¸ªé¡µé¢ä¸­ï¼Œä½¿ç”¨äº†`Alter`ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨`element.js`æ–‡ä»¶ä¸­æ³¨å†Œä¸€ä¸‹

```
Vue.use(Alert);
```

## 3ã€æ¸²æŸ“`Tab`é¡µç­¾ã€‚

å…³äºåˆ†ç±»å‚æ•°çš„å±•ç¤ºï¼Œæ˜¯é€šè¿‡`Tab`é¡µç­¾æ¥å®ç°çš„ã€‚

åœ¨é€‰æ‹©å•†å“åˆ†ç±»åŒºåŸŸçš„ä¸‹é¢æ·»åŠ `el-tabs`ç»„ä»¶ã€‚

```vue
<!-- tab é¡µç­¾åŒºåŸŸ -->
<el-tabs v-model="activeName" @tab-click="handleTabClick">
        <!-- æ·»åŠ åŠ¨æ€å‚æ•°çš„é¢æ¿ -->
        <el-tab-pane label="åŠ¨æ€å‚æ•°" name="many"></el-tab-pane>
        <el-tab-pane label="é™æ€å±æ€§" name="only"></el-tab-pane>
      </el-tabs>
```

`v-model`æ‰€ç»‘å®šçš„å±æ€§æŒ‡çš„è¢«æ¿€æ´»çš„é¡µç­¾çš„åç§°ã€‚

åœ¨`data`ä¸­å®šä¹‰`activeName`

```js
  // è¢«æ¿€æ´»çš„é¡µç­¾çš„åç§°
      activeName: "many",
```

å•å‡»é¡µç­¾ä¼šæ‰§è¡Œ`handleTabClick`å¤„ç†å‡½æ•°ã€‚

```js
  // tab é¡µç­¾ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°
    handleTabClick() {
      console.log(this.activeName);
      //   this.getParamsData();
    },
```

åŒæ—¶è¦å®Œæˆé¡µç­¾ç»„ä»¶çš„æ³¨å†Œã€‚

```js
Vue.use(Tabs);
Vue.use(TabPane);
```

## 4ã€æ¸²æŸ“æ·»åŠ å‚æ•°ä¸å±æ€§æŒ‰é’®

ç°åœ¨å·²ç»å°†åŸºæœ¬çš„`tab`é¡µç­¾æ¸²æŸ“å‡ºæ¥äº†ï¼Œä¸‹é¢è¦åšçš„å°±æ˜¯åœ¨"åŠ¨æ€å‚æ•°"ä¸â€œé™æ€å±æ€§â€è¿™ä¸¤ä¸ªé¡µç­¾ä¸‹é¢æ·»åŠ ç›¸åº”çš„æŒ‰é’®ï¼Œåˆ†åˆ«ä¸ºâ€œæ·»åŠ å‚æ•°â€æŒ‰é’®ä¸â€œæ·»åŠ å±æ€§â€æŒ‰é’®ã€‚

å¹¶ä¸”å½“ç”¨æˆ·é€‰æ‹©äº†â€œå•†å“åˆ†ç±»â€ä¸‹æ‹‰æ¡†ä¸­çš„ç¬¬ä¸‰ä¸ªç±»åˆ«çš„æ—¶å€™ï¼Œè¿™äº›æŒ‰é’®æ‰ä¼šå¯ç”¨ã€‚

æ‰€ä»¥è¿™é‡Œé€šè¿‡è®¡ç®—å±æ€§æ¥åˆ¤æ–­æ•°ç»„`selectedCateKeys`ä¸­çš„é•¿åº¦æ˜¯å¦ä¸º`3`,å¦‚æœä¸º`3`,è¡¨æ˜ç”¨æˆ·é€‰æ‹©äº†ä¸‰çº§ç±»åˆ«ã€‚

```vue
<!-- tab é¡µç­¾åŒºåŸŸ -->
<el-tabs v-model="activeName" @tab-click="handleTabClick">
        <!-- æ·»åŠ åŠ¨æ€å‚æ•°çš„é¢æ¿ -->
        <el-tab-pane label="åŠ¨æ€å‚æ•°" name="many">
          <!-- æ·»åŠ å‚æ•°çš„æŒ‰é’® -->
          <el-button type="primary" size="mini" :disabled="isBtnDisabled">æ·»åŠ å‚æ•°</el-button>
        </el-tab-pane>
        <el-tab-pane label="é™æ€å±æ€§" name="only">
          <el-button type="primary" size="mini" :disabled="isBtnDisabled">æ·»åŠ å±æ€§</el-button>
        </el-tab-pane>
      </el-tabs>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨é¡µç­¾ä¸­æ·»åŠ äº†ç›¸åº”çš„æŒ‰é’®ã€‚å¹¶ä¸”è®©`disabled`åŠ¨æ€ç»‘å®šäº†è®¡ç®—å±æ€§`isBtnDisabled`

```js
  computed: {
    // å¦‚æœæŒ‰é’®éœ€è¦è¢«ç¦ç”¨ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false
    isBtnDisabled() {
      if (this.selectedCateKeys.length !== 3) {
        return true;
      }
      return false;
    },
  },
```

å¦‚æœæ•°ç»„çš„é•¿åº¦ä¸ä¸º`3`,è¿”å›`true`.è¡¨æ˜è¦ç¦ç”¨æŒ‰é’®ã€‚

## 5ã€åˆ‡æ¢`Tab`é¡µç­¾è·å–æ•°æ®

ä¸‹é¢è¦å®ç°çš„å°±æ˜¯ï¼Œå½“å•å‡»`åŠ¨æ€å‚æ•°`ä¸`é™æ€å±æ€§`è¿™ä¸¤ä¸ªé¡µç­¾çš„æ—¶å€™ï¼Œè¦æŸ¥è¯¢åˆ°å¯¹åº”çš„æ•°æ®ï¼Œç„¶åç»‘å®šåˆ°ç›¸åº”çš„è¡¨æ ¼ä¸­ã€‚

è¦æƒ³è·å¾—å¯¹åº”çš„æ•°æ®ï¼Œè¿™é‡Œéœ€è¦ç¡®å®šä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·æ‰€é€‰æ‹©çš„ä¸‹æ‹‰æ¡†ä¸­ç¬¬ä¸‰ç±»åˆ«çš„ç¼–å·ï¼Œå†æœ‰ä¸€ä¸ªå°±æ˜¯æ‰€é€‰æ‹©çš„`Tab`é¡µç­¾ã€‚

æ€æ ·è·å–ç”¨æˆ·æ‰€é€‰æ‹©çš„â€œå•†å“åˆ†ç±»â€ä¸‹æ‹‰ä¸­ç”¨æˆ·é€‰æ‹©çš„ç¬¬ä¸‰ä¸ªç±»åˆ«çš„ç¼–å·å‘¢ï¼Ÿ

è¿™é‡Œï¼Œä¹Ÿæ˜¯é€šè¿‡è®¡ç®—å±æ€§æ¥å®Œæˆçš„ã€‚

```js
  computed: {
    // å¦‚æœæŒ‰é’®éœ€è¦è¢«ç¦ç”¨ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false
    isBtnDisabled() {
      if (this.selectedCateKeys.length !== 3) {
        return true;
      }
      return false;
    },
    // å½“å‰é€‰ä¸­çš„ä¸‰çº§åˆ†ç±»çš„Id
    cateId() {
      if (this.selectedCateKeys.length === 3) {
        return this.selectedCateKeys[2];
      }
      return null;
    },
  },
```

å…³äºç¡®å®šç”¨æˆ·åˆ°åº•é€‰æ‹©äº†å“ªä¸ª`Tab`é¡µç­¾ï¼Œå…¶å®å‰é¢æˆ‘ä»¬å·²ç»å¤„ç†è¿‡äº†ï¼Œ

æˆ‘ä»¬ç»™`el-tabs`æ ‡ç­¾æ·»åŠ äº†`v-model="activeName" `,å¹¶ä¸”` activeName: "many",`è¡¨ç¤ºçš„å°±æ˜¯ç”¨æˆ·æ¿€æ´»çš„é¡µç­¾çš„åç§°ã€‚

åŒæ—¶æ¯ä¸€ä¸ª`el-tab-pane `éƒ½æ·»åŠ äº†`name` å±æ€§

ç°åœ¨ï¼Œä¸¤ä¸ªå‚æ•°éƒ½å·²ç»ç¡®å®šå¥½äº†ï¼Œä¸‹é¢è¦è€ƒè™‘çš„å°±æ˜¯ä»€ä¹ˆæ—¶å€™å°†è¿™ä¸¤ä¸ªå‚æ•°å‘é€åˆ°æœåŠ¡ç«¯å‘¢ï¼Ÿ

ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼šç”¨æˆ·é€‰æ‹©äº†â€œå•†å“åˆ†ç±»â€ä¸‹æ‹‰æ¡†ä¸­çš„æŸä¸ªç¬¬ä¸‰çº§ç±»åˆ«æ—¶ï¼Œå°±åº”è¯¥å‘é€è¯·æ±‚ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºï¼Œæˆ‘ä»¬è¿™æ˜¯é»˜è®¤ä¼šæœ‰ä¸€ä¸ªé¡µç­¾æ˜¯é€‰ä¸­çš„ã€‚è¿™æ˜¯å¯ä»¥å°†é»˜è®¤é€‰ä¸­é¡µç­¾çš„åç§°ä¸ç±»åˆ«ç¼–å·å‘é€åˆ°æœåŠ¡ç«¯ã€‚

ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼šç”¨æˆ·é€‰æ‹©äº†æŸä¸ªä¸‰çº§ç±»åˆ«åï¼ŒåæœŸæœ‰é€‰æ‹©äº†å¦å¤–ä¸€ä¸ªé¡µç­¾ï¼Œè¿™æ˜¯ä¹Ÿåº”è¯¥å‘é€è¯·æ±‚ã€‚

```js
 // çº§è”é€‰æ‹©æ¡†é€‰ä¸­é¡¹å˜åŒ–ï¼Œä¼šè§¦å‘è¿™ä¸ªå‡½æ•°
    handleChange() {
      //   console.log(this.selectedCateKeys);
      this.getParamsData();
    },
    // tab é¡µç­¾ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°
    handleTabClick() {
      console.log(this.activeName);
      this.getParamsData();
    },

    // è·å–å‚æ•°çš„åˆ—è¡¨æ•°æ®
    async getParamsData() {
      // è¯æ˜é€‰ä¸­çš„ä¸æ˜¯ä¸‰çº§åˆ†ç±»
      //è¿™é‡Œåªå…è®¸é€‰æ‹©ç¬¬ä¸‰ä¸ªç±»åˆ«ã€‚
      if (this.selectedCateKeys.length !== 3) {
        this.selectedCateKeys = [];
        return;
      }
      // è¯æ˜é€‰ä¸­çš„æ˜¯ä¸‰çº§åˆ†ç±»
      console.log(this.selectedCateKeys);
      // æ ¹æ®æ‰€é€‰åˆ†ç±»çš„Idï¼Œå’Œå½“å‰æ‰€å¤„çš„é¢æ¿ï¼Œè·å–å¯¹åº”çš„å‚æ•°
      const { data: res } = await this.$http.get(
        `categories/${this.cateId}/attributes`,
        {
          params: { sel: this.activeName },
        }
      );

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å‚æ•°åˆ—è¡¨å¤±è´¥ï¼");
      }

      console.log(res.data);
      if (this.activeName === "many") {
        this.manyTableData = res.data;
      } else {
        this.onlyTableData = res.data;
      }
    },
```

å¦‚æœç”¨æˆ·é€‰æ‹©çš„æ˜¯"åŠ¨æ€å‚æ•°",å°†æŸ¥è¯¢åˆ°çš„æ•°æ®å­˜å‚¨åˆ°`manyTableData`è¿™ä¸ªçŠ¶æ€å±æ€§ä¸Šï¼Œå¦åˆ™å­˜å‚¨åˆ°`onlyTableData`è¿™ä¸ªå±æ€§ä¸Šï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬è¦å°†æ•°æ®ç»‘å®šåˆ°ä¸¤ä¸ªè¡¨æ ¼ä¸­ã€‚

## 6ã€æ¸²æŸ“è¡¨æ ¼

ç°åœ¨ï¼Œå·²ç»å°†æ•°æ®å…¨éƒ¨å–å‡ºæ¥äº†ï¼Œä¸‹é¢å°†è¿™äº›æ•°æ®æ¸²æŸ“åˆ°ç›¸åº”çš„è¡¨æ ¼ä¸­ã€‚

```vue
<!-- tab é¡µç­¾åŒºåŸŸ -->
<el-tabs v-model="activeName" @tab-click="handleTabClick">
        <!-- æ·»åŠ åŠ¨æ€å‚æ•°çš„é¢æ¿ -->
        <el-tab-pane label="åŠ¨æ€å‚æ•°" name="many">
          <!-- æ·»åŠ å‚æ•°çš„æŒ‰é’® -->
          <el-button type="primary" size="mini" :disabled="isBtnDisabled">æ·»åŠ å‚æ•°</el-button>
          <!-- åŠ¨æ€å‚æ•°è¡¨æ ¼ -->
          <el-table :data="manyTableData" border stripe>
            <!-- å±•å¼€è¡Œ -->
            <el-table-column type="expand"></el-table-column>
            <!-- ç´¢å¼•åˆ— -->
            <el-table-column type="index"></el-table-column>
            <el-table-column label="å‚æ•°åç§°" prop="attr_name"></el-table-column>
            <el-table-column label="æ“ä½œ">
              <template slot-scope="scope">
                <el-button
                  size="mini"
                  type="primary"
                  icon="el-icon-edit"
                  @click="showEditDialog(scope.row.attr_id)"
                >ç¼–è¾‘</el-button>
                <el-button
                  size="mini"
                  type="danger"
                  icon="el-icon-delete"
                  @click="removeParams(scope.row.attr_id)"
                >åˆ é™¤</el-button>
              </template>
            </el-table-column>
          </el-table>
        </el-tab-pane>
        <el-tab-pane label="é™æ€å±æ€§" name="only">
          <el-button type="primary" size="mini" :disabled="isBtnDisabled">æ·»åŠ å±æ€§</el-button>

          <!-- é™æ€å±æ€§è¡¨æ ¼ -->
          <el-table :data="onlyTableData" border stripe>
            <!-- å±•å¼€è¡Œ -->
            <el-table-column type="expand"></el-table-column>
            <!-- ç´¢å¼•åˆ— -->
            <el-table-column type="index"></el-table-column>
            <el-table-column label="å±æ€§åç§°" prop="attr_name"></el-table-column>
            <el-table-column label="æ“ä½œ">
              <template slot-scope="scope">
                <el-button
                  size="mini"
                  type="primary"
                  icon="el-icon-edit"
                  @click="showEditDialog(scope.row.attr_id)"
                >ç¼–è¾‘</el-button>
                <el-button
                  size="mini"
                  type="danger"
                  icon="el-icon-delete"
                  @click="removeParams(scope.row.attr_id)"
                >åˆ é™¤</el-button>
              </template>
            </el-table-column>
          </el-table>
        </el-tab-pane>
      </el-tabs>
```

åœ¨ä¸Šé¢çš„`el-tabs`é¡µç­¾ä¸­ï¼Œåˆ†åˆ«æ·»åŠ äº†ä¸¤ä¸ªè¡¨æ ¼ï¼Œåˆ†åˆ«æ¸²æŸ“"åŠ¨æ€å‚æ•°"â€œä¸â€é™æ€å±æ€§â€œç›¸åº”çš„æ•°æ®ã€‚

## 7ã€æ¸²æŸ“æ·»åŠ å‚æ•°çš„å¯¹è¯æ¡†

è¿™é‡Œçš„å‚æ•°åˆ†ä¸ºâ€œåŠ¨æ€å‚æ•°â€œä¸â€é™æ€å±æ€§â€œä¸¤ç§æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªçª—å£å®Œæˆæ·»åŠ çš„ã€‚

åœ¨`el-card`ç»„ä»¶ä¸‹é¢

é¦–å…ˆæ·»åŠ ä¸€ä¸ªçª—å£ç»„ä»¶ã€‚

```vue
<!-- æ·»åŠ å‚æ•°çš„å¯¹è¯æ¡† -->
<el-dialog
  :title="'æ·»åŠ ' + titleText"
  :visible.sync="addDialogVisible"
  width="50%"
  @close="addDialogClosed"
>
      <!-- æ·»åŠ å‚æ•°çš„å¯¹è¯æ¡† -->
      <el-form :model="addForm" :rules="addFormRules" ref="addFormRef" label-width="100px">
        <el-form-item :label="titleText" prop="attr_name">
          <el-input v-model="addForm.attr_name"></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="addDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

è¿™é‡Œï¼Œæˆ‘ä»¬ç»™çª—å£çš„æ ‡é¢˜é‡‡ç”¨äº†åŠ¨æ€ç»‘å®šçš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ä½¿ç”¨äº†è®¡ç®—å±æ€§ã€‚

```js
computed: {
    // å¦‚æœæŒ‰é’®éœ€è¦è¢«ç¦ç”¨ï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false
    isBtnDisabled() {
      if (this.selectedCateKeys.length !== 3) {
        return true;
      }
      return false;
    },
    // å½“å‰é€‰ä¸­çš„ä¸‰çº§åˆ†ç±»çš„Id
    cateId() {
      if (this.selectedCateKeys.length === 3) {
        return this.selectedCateKeys[2];
      }
      return null;
    },
    // åŠ¨æ€è®¡ç®—æ ‡é¢˜çš„æ–‡æœ¬
    titleText() {
      if (this.activeName === "many") {
        return "åŠ¨æ€å‚æ•°";
      }
      return "é™æ€å±æ€§";
    },
  },
```

è¿˜æœ‰å°±æ˜¯ç›‘å¬çª—å£å…³é—­äº‹ä»¶è§¦å‘åï¼Œå¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚

```js
 // ç›‘å¬æ·»åŠ å¯¹è¯æ¡†çš„å…³é—­äº‹ä»¶
    addDialogClosed() {
      this.$refs.addFormRef.resetFields();
    },
```

å¯¹åº”çš„`data`å±æ€§çš„å®šä¹‰å¦‚ä¸‹ï¼š

```js
 // æ§åˆ¶æ·»åŠ å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      addDialogVisible: false,
      // æ·»åŠ å‚æ•°çš„è¡¨å•æ•°æ®å¯¹è±¡
      addForm: {
        attr_name: "",
      },
      // æ·»åŠ è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      addFormRules: {
        attr_name: [
          { required: true, message: "è¯·è¾“å…¥å‚æ•°åç§°", trigger: "blur" },
        ],
      },
```

å•å‡»â€œæ·»åŠ å±æ€§â€ä¸â€œæ·»åŠ å‚æ•°â€æŒ‰é’®å°†å¯¹è¯æ¡†å±•ç¤ºå‡ºæ¥ã€‚

```vue
<!-- æ·»åŠ å‚æ•°çš„æŒ‰é’® -->
<el-button
  type="primary"
  size="mini"
  :disabled="isBtnDisabled"
  @click="addDialogVisible = true"
>æ·»åŠ å‚æ•°</el-button>
```

```vue
<el-button
  type="primary"
  size="mini"
  :disabled="isBtnDisabled"
  @click="addDialogVisible = true"
>æ·»åŠ å±æ€§</el-button>
```

## 8ã€å®Œæˆå‚æ•°çš„æ·»åŠ 

å½“å•å‡»å¼¹å‡ºçš„çª—å£ä¸­çš„"æ·»åŠ "æŒ‰é’®çš„æ—¶å€™ï¼Œå®Œæˆå¯¹åº”çš„æ·»åŠ ã€‚

```vue
<el-button type="primary" @click="addParams">ç¡® å®š</el-button>
```

å¯¹åº”çš„`addParams`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
   // ç‚¹å‡»æŒ‰é’®ï¼Œæ·»åŠ å‚æ•°
    addParams() {
      this.$refs.addFormRef.validate(async (valid) => {
        if (!valid) return;
        const { data: res } = await this.$http.post(
          `categories/${this.cateId}/attributes`,
          {
            attr_name: this.addForm.attr_name,//è·å–è¡¨å•ä¸­çš„æ•°æ®
            attr_sel: this.activeName,//è·å–å¯¹åº”çš„é¡µç­¾åç§°
          }
        );

        if (res.meta.status !== 201) {
          return this.$message.error("æ·»åŠ å‚æ•°å¤±è´¥ï¼");
        }

        this.$message.success("æ·»åŠ å‚æ•°æˆåŠŸï¼");
        this.addDialogVisible = false;
        this.getParamsData();
      });
    },
```

## 9ã€ä¿®æ”¹å‚æ•°

åœ¨å…·ä½“ä¿®æ”¹å‚æ•°ä¹‹å‰ï¼Œé¦–å…ˆä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œåœ¨è¯¥å¯¹è¯æ¡†ä¸­å±•ç¤ºè¦ä¿®æ”¹çš„å‚æ•°ã€‚

```vue
<!-- ä¿®æ”¹å‚æ•°çš„å¯¹è¯æ¡† -->
<el-dialog
  :title="'ä¿®æ”¹' + titleText"
  :visible.sync="editDialogVisible"
  width="50%"
  @close="editDialogClosed"
>
      <!-- æ·»åŠ å‚æ•°çš„å¯¹è¯æ¡† -->
      <el-form :model="editForm" :rules="editFormRules" ref="editFormRef" label-width="100px">
        <el-form-item :label="titleText" prop="attr_name">
          <el-input v-model="editForm.attr_name"></el-input>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="editDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button type="primary" @click="editParams">ç¡® å®š</el-button>
      </span>
    </el-dialog>
```

æ·»åŠ å¯¹åº”çš„`data`å±æ€§ã€‚

```js
  // æ§åˆ¶ä¿®æ”¹å¯¹è¯æ¡†çš„æ˜¾ç¤ºä¸éšè—
      editDialogVisible: false,
      // ä¿®æ”¹çš„è¡¨å•æ•°æ®å¯¹è±¡
      editForm: {},
      // ä¿®æ”¹è¡¨å•çš„éªŒè¯è§„åˆ™å¯¹è±¡
      editFormRules: {
        attr_name: [
          { required: true, message: "è¯·è¾“å…¥å‚æ•°åç§°", trigger: "blur" },
        ],
      },
```

ç»™ä¸¤ä¸ªè¡¨æ ¼ä¸­çš„ä¿®æ”¹æŒ‰é’®ï¼Œç»‘å®šå¯¹åº”çš„å•å‡»äº‹ä»¶ï¼Œå¼¹å‡ºä¸Šé¢æŒ‡å®šçš„çª—å£ã€‚

```vue
<el-button
  size="mini"
  type="primary"
  icon="el-icon-edit"
  @click="showEditDialog(scope.row.attr_id)"
>ç¼–è¾‘</el-button>
```

`showEditDialog`æ–¹æ³•å¦‚ä¸‹ï¼š

```js
 // ç‚¹å‡»æŒ‰é’®ï¼Œå±•ç¤ºä¿®æ”¹çš„å¯¹è¯æ¡†
    async showEditDialog(attr_id) {
      // æŸ¥è¯¢å½“å‰å‚æ•°çš„ä¿¡æ¯
      const { data: res } = await this.$http.get(
        `categories/${this.cateId}/attributes/${attr_id}`,
        {
          params: { attr_sel: this.activeName },
        }
      );

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å‚æ•°ä¿¡æ¯å¤±è´¥ï¼");
      }

      this.editForm = res.data;
      this.editDialogVisible = true;
    },
    // é‡ç½®ä¿®æ”¹çš„è¡¨å•
    editDialogClosed() {
      this.$refs.editFormRef.resetFields();
    },
```

ä¸‹é¢å°±æ˜¯å•å‡»çª—å£ä¸­çš„â€œç¡®å®šâ€æŒ‰é’®çš„æ—¶å€™ï¼Œå®Œæˆå‚æ•°ä¿¡æ¯çš„æ›´æ–°ã€‚

```vue
<el-button type="primary" @click="editParams">ç¡® å®š</el-button>
```

`editParams`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
   // ç‚¹å‡»æŒ‰é’®ï¼Œä¿®æ”¹å‚æ•°ä¿¡æ¯
    editParams() {
      this.$refs.editFormRef.validate(async (valid) => {
        if (!valid) return;
        const {
          data: res,
        } = await this.$http.put(
          `categories/${this.cateId}/attributes/${this.editForm.attr_id}`,
          { attr_name: this.editForm.attr_name, attr_sel: this.activeName }
        );

        if (res.meta.status !== 200) {
          return this.$message.error("ä¿®æ”¹å‚æ•°å¤±è´¥ï¼");
        }

        this.$message.success("ä¿®æ”¹å‚æ•°æˆåŠŸï¼");
        this.getParamsData();
        this.editDialogVisible = false;
      });
    },
```

## 10ã€åˆ é™¤å‚æ•°

å½“å•å‡»è¡¨æ ¼ä¸­çš„â€œåˆ é™¤â€æŒ‰é’®çš„æ—¶å€™ï¼Œå®Œæˆå‚æ•°æ•°æ®çš„åˆ é™¤ã€‚

```js
    // æ ¹æ®Idåˆ é™¤å¯¹åº”çš„å‚æ•°é¡¹
    async removeParams(attr_id) {
      const confirmResult = await this.$confirm(
        'æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥å‚æ•°, æ˜¯å¦ç»§ç»­?',
        'æç¤º',
        {
          confirmButtonText: 'ç¡®å®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning'
        }
      ).catch(err => err)

      // ç”¨æˆ·å–æ¶ˆäº†åˆ é™¤çš„æ“ä½œ
      if (confirmResult !== 'confirm') {
        return this.$message.info('å·²å–æ¶ˆåˆ é™¤ï¼')
      }

      // åˆ é™¤çš„ä¸šåŠ¡é€»è¾‘
      const { data: res } = await this.$http.delete(
        `categories/${this.cateId}/attributes/${attr_id}`
      )

      if (res.meta.status !== 200) {
        return this.$message.error('åˆ é™¤å‚æ•°å¤±è´¥ï¼')
      }

      this.$message.success('åˆ é™¤å‚æ•°æˆåŠŸï¼')
      this.getParamsData()
    }
```

ä»¥ä¸Šå°±æ˜¯å®Œæˆæ•°æ®åˆ é™¤çš„ä¸šåŠ¡æ“ä½œã€‚

ä¸‹é¢éœ€è¦ç»™ä¸¤ä¸ªè¡¨æ ¼ä¸­çš„â€œåˆ é™¤â€æŒ‰é’®æ·»åŠ å¯¹åº”çš„äº‹ä»¶ã€‚

```html
<el-button
  size="mini"
  type="danger"
  icon="el-icon-delete"
  @click="removeParams(scope.row.attr_id)"
  >åˆ é™¤</el-button
>
```

## 11ã€æ¸²æŸ“å‚æ•°ä¸‹çš„å¯é€‰é¡¹

å½“å•å‡»è¡¨æ ¼ä¸­ç¬¬ä¸€åˆ—ï¼Œå±•å¼€åˆ—çš„æ—¶å€™ï¼Œåº”è¯¥èƒ½å¤Ÿå±•ç¤ºå‡ºæ¯ä¸ªç±»åˆ«ä¸‹çš„å¯¹åº”çš„å±æ€§ã€‚

åœ¨å±•å¼€åˆ—ä¸­å±•ç¤ºçš„è¿™äº›å±æ€§ï¼Œéƒ½æ˜¯ä¿å­˜åœ¨`attr_vals`è¿™ä¸ªå±æ€§ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯ä»¥ç©ºæ ¼è¿›è¡Œåˆ†éš”ï¼Œæ‰€ä»¥è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä»¥â€œç©ºæ ¼â€æ¥ä½œä¸ºåˆ†éš”ç¬¦ï¼Œåˆ†éš”æˆæ•°ç»„ï¼Œç„¶åé€šè¿‡éå†çš„æ–¹å¼ï¼Œå†å°†å…¶æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚

```js
// è·å–å‚æ•°çš„åˆ—è¡¨æ•°æ®
    async getParamsData() {
      // è¯æ˜é€‰ä¸­çš„ä¸æ˜¯ä¸‰çº§åˆ†ç±»
      //è¿™é‡Œåªå…è®¸é€‰æ‹©ç¬¬ä¸‰ä¸ªç±»åˆ«ã€‚
      if (this.selectedCateKeys.length !== 3) {
        this.selectedCateKeys = [];
        return;
      }
      // è¯æ˜é€‰ä¸­çš„æ˜¯ä¸‰çº§åˆ†ç±»
      console.log(this.selectedCateKeys);
      // æ ¹æ®æ‰€é€‰åˆ†ç±»çš„Idï¼Œå’Œå½“å‰æ‰€å¤„çš„é¢æ¿ï¼Œè·å–å¯¹åº”çš„å‚æ•°
      const { data: res } = await this.$http.get(
        `categories/${this.cateId}/attributes`,
        {
          params: { sel: this.activeName },
        }
      );

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å‚æ•°åˆ—è¡¨å¤±è´¥ï¼");
      }
      //å¯¹attr_valsçš„å†…å®¹è¿›è¡Œåˆ†éš”ã€‚
      res.data.forEach((item) => {
        item.attr_vals = item.attr_vals ? item.attr_vals.split(" ") : [];
      });
      console.log(res.data);
      if (this.activeName === "many") {
        this.manyTableData = res.data;
      } else {
        this.onlyTableData = res.data;
      }
    },

```

åœ¨`getdParamsData`æ–¹æ³•ä¸­ï¼Œå¯¹æœåŠ¡ç«¯è¿”å›çš„å†…å®¹è¿›è¡Œéå†ï¼Œç„¶åè·å–æ¯ä¸€é¡¹ä¸­çš„`attr_vals`å±æ€§ï¼Œç„¶åæŒ‰ç…§ç©ºæ ¼è¿›è¡Œåˆ†éš”ã€‚

åˆ†éš”å®Œåï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œäº¤ç»™äº†`item.attr_vals`ã€‚

åœ¨å‰ç«¯å¯¹`item.attr_vals`è¿›è¡Œå¾ªç¯éå†ã€‚

åœ¨ä¸¤ä¸ªè¡¨æ ¼ä¸­çš„å±•å¼€åˆ—ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹çš„å†…å®¹ã€‚

```vue
<!-- å±•å¼€è¡Œ -->
<el-table-column type="expand">
              <template slot-scope="scope">
                <!-- å¾ªç¯æ¸²æŸ“Tagæ ‡ç­¾ -->
                <el-tag
                  v-for="(item, i) in scope.row.attr_vals"
                  :key="i"
                  closable
                  @close="handleClose(i, scope.row)"
                >{{item}}</el-tag>
              </template>
            </el-table-column>
```

## 12ã€å®ç°æŒ‡å®šå‚æ•°å±æ€§çš„æ·»åŠ 

ç»è¿‡ä¸Šé¢çš„æ“ä½œï¼Œç°åœ¨å·²ç»å®ç°äº†ï¼Œå•å‡»å±•å¼€åˆ—ï¼Œä¼šå±•ç¤ºå‡ºç›¸åº”çš„å±æ€§ã€‚ä¸‹é¢å®ç°å±æ€§çš„æ·»åŠ ã€‚

é¦–å…ˆå…ˆå±•ç¤ºå‡ºæ·»åŠ çš„çª—å£ã€‚

```vue
<!-- å±•å¼€è¡Œ -->
<el-table-column type="expand">
              <template slot-scope="scope">
                <!-- å¾ªç¯æ¸²æŸ“Tagæ ‡ç­¾ -->
                <el-tag
                  v-for="(item, i) in scope.row.attr_vals"
                  :key="i"
                  closable
                  @close="handleClose(i, scope.row)"
                >{{item}}</el-tag>
                <!-- è¾“å…¥çš„æ–‡æœ¬æ¡† -->
                <el-input
                  class="input-new-tag"
                  v-if="scope.row.inputVisible"
                  v-model="scope.row.inputValue"
                  ref="saveTagInput"
                  size="small"
                  @keyup.enter.native="handleInputConfirm(scope.row)"
                  @blur="handleInputConfirm(scope.row)"
                ></el-input>
                <!-- æ·»åŠ æŒ‰é’® -->
                <el-button
                  v-else
                  class="button-new-tag"
                  size="small"
                  @click="showInput(scope.row)"
                >+ New Tag</el-button>
              </template>
            </el-table-column>
```

åœ¨ä¸¤ä¸ªè¡¨æ ¼ä¸­çš„å±•å¼€è¡Œä¸­ï¼Œæ·»åŠ è¾“å…¥æ¡†ä¸æŒ‰é’®ã€‚

å¦‚æœ`scope.row.inputVisible`ä¸º`true`,å±•ç¤ºè¾“å…¥æ¡†ï¼Œå¦åˆ™å±•ç¤ºæ·»åŠ æŒ‰é’®ã€‚

ä¸‹é¢çœ‹ä¸€ä¸‹`scope.row.inputVisible`æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ

```js
//å¯¹attr_valsçš„å†…å®¹è¿›è¡Œåˆ†éš”ã€‚
res.data.forEach((item) => {
  item.attr_vals = item.attr_vals ? item.attr_vals.split(" ") : [];
  // æ§åˆ¶æ–‡æœ¬æ¡†çš„æ˜¾ç¤ºä¸éšè—
  item.inputVisible = false;
  // æ–‡æœ¬æ¡†ä¸­è¾“å…¥çš„å€¼
  item.inputValue = "";
});
```

åœ¨`getParamsData`æ–¹æ³•ä¸­ï¼Œåœ¨å¯¹è¿”å›çš„æ•°æ®è¿›è¡Œéå†ï¼Œå–å‡ºæ¯ä¸€é¡¹åï¼ŒæŒ‰ç…§ç©ºæ ¼åˆ†éš”ï¼Œç„¶ååœ¨ç»™`item`å¯¹è±¡æ·»åŠ `inputVisible`å±æ€§è®¾ç½®äº†`false`,`inputValue`è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

è¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¿è¯äº†`scope.row.inputVisible`,å€¼çš„å”¯ä¸€ï¼Œä¹Ÿå°±æ˜¯æ¯è¡Œä¸­çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚

`handleInputConfirm`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
 // æ–‡æœ¬æ¡†å¤±å»ç„¦ç‚¹ï¼Œæˆ–æ‘ä¸‹äº† Enter éƒ½ä¼šè§¦å‘
    async handleInputConfirm(row) {
      console.log(row);
    },
```

å½“ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ`showInput`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
    // ç‚¹å‡»æŒ‰é’®ï¼Œå±•ç¤ºæ–‡æœ¬è¾“å…¥æ¡†
    showInput(row) {
      // console.log(row);
      row.inputVisible = true;
    },
```

è¿™æ ·å°†`inputVisible`è®¾ç½®ä¸º`true`åï¼Œä¼šå±•ç¤ºå‡ºå¯¹åº”çš„æ–‡æœ¬æ¡†ã€‚

ç°åœ¨èƒ½å¤Ÿå®Œæˆæ·»åŠ æŒ‰é’®ä¸æ–‡æœ¬æ¡†çš„åˆ‡æ¢äº†**ï¼Œæ¥ä¸‹æ¥è¦å®ç°çš„å°±æ˜¯è®©æ–‡æœ¬æ¡†èƒ½å¤Ÿè‡ªåŠ¨è·å–åˆ°ç„¦ç‚¹ã€‚**

```js
  // ç‚¹å‡»æŒ‰é’®ï¼Œå±•ç¤ºæ–‡æœ¬è¾“å…¥æ¡†
    showInput(row) {
      // console.log(row);
      row.inputVisible = true;
      // $nextTick æ–¹æ³•çš„ä½œç”¨ï¼Œå°±æ˜¯å½“é¡µé¢ä¸Šå…ƒç´ è¢«é‡æ–°æ¸²æŸ“ä¹‹åï¼Œæ‰ä¼šæ‰§è¡Œå›è°ƒå‡½æ•°ä¸­çš„ä»£ç 
      this.$nextTick(() => {
        this.$refs.saveTagInput.$refs.input.focus();
      });
    },
```

åœ¨`showInput`æ–¹æ³•ä¸­ï¼Œæ·»åŠ äº†`$nextTick`å‡½æ•°ã€‚

å½“` row.inputVisible = true;`è®¾ç½®ä¸º`true`åï¼Œå¹¶ä¸èƒ½ä¿è¯ç«‹å³è·å–åˆ°æ–‡æœ¬æ¡†ï¼Œè€Œå½“`$nextTick`æ–¹æ³•æ‰§è¡Œäº†ï¼Œè¯´æ˜æ–‡æœ¬æ¡†æ¸²æŸ“å®Œäº†ã€‚

**ä¸‹é¢è¦å®ç°çš„å°±æ˜¯å±æ€§çš„æ·»åŠ äº†**

å½“ç”¨æˆ·åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥äº†å€¼ä»¥åï¼ŒæŒ‰ä¸‹å›è½¦é”®æˆ–è€…è®©æ–‡æœ¬æ¡†å¤±å»ç„¦ç‚¹ï¼Œå°±éœ€è¦å°†ç”¨æˆ·åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥çš„å†…å®¹å‘é€åˆ°æœåŠ¡ç«¯ï¼Œæ¥å®Œæˆå¯¹åº”çš„å±æ€§ä¿¡æ¯çš„æ·»åŠ æ“ä½œã€‚

ä¸‹é¢éœ€è¦ä¿®æ”¹`handleInputConfirm`æ–¹æ³•ï¼Œ

```js
   // æ–‡æœ¬æ¡†å¤±å»ç„¦ç‚¹ï¼Œæˆ–æ‘ä¸‹äº† Enter éƒ½ä¼šè§¦å‘
    async handleInputConfirm(row) {
      // console.log(row);
      if (row.inputValue.trim().length === 0) {
        row.inputValue = "";
        row.inputVisible = false;
        return;
      }
      // å¦‚æœæ²¡æœ‰returnï¼Œåˆ™è¯æ˜è¾“å…¥çš„å†…å®¹ï¼Œéœ€è¦åšåç»­å¤„ç†
      row.attr_vals.push(row.inputValue.trim());
      row.inputValue = "";//æ¸…ç©ºæ–‡æœ¬æ¡†ä¸­çš„å†…å®¹
      row.inputVisible = false; //éšè—æ–‡æœ¬æ¡†ã€‚
      // éœ€è¦å‘èµ·è¯·æ±‚ï¼Œä¿å­˜è¿™æ¬¡æ“ä½œ
      this.saveAttrVals(row);
    },
    // å°†å¯¹ attr_vals çš„æ“ä½œï¼Œä¿å­˜åˆ°æ•°æ®åº“
    async saveAttrVals(row) {
      // éœ€è¦å‘èµ·è¯·æ±‚ï¼Œä¿å­˜è¿™æ¬¡æ“ä½œ
      const { data: res } = await this.$http.put(
        `categories/${this.cateId}/attributes/${row.attr_id}`,
        {
          attr_name: row.attr_name,
          attr_sel: row.attr_sel,
            //row.attr_valsæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€ŒæœåŠ¡ç«¯éœ€è¦çš„æ˜¯ä¸€ä¸ªä»¥ç©ºæ ¼è¿›è¡Œåˆ†éš”çš„å­—ç¬¦ä¸²ã€‚
          attr_vals: row.attr_vals.join(" "),
        }
      );

      if (res.meta.status !== 200) {
        return this.$message.error("ä¿®æ”¹å‚æ•°é¡¹å¤±è´¥ï¼");
      }

      this.$message.success("ä¿®æ”¹å‚æ•°é¡¹æˆåŠŸï¼");
    },
```

åœ¨`handleInputConfirm`æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹`inputValue`ä¸­å»æ‰ç©ºæ ¼ä»¥åçš„é•¿åº¦æ˜¯å¦ä¸º 0ï¼Œå¦‚æœä¸ºé›¶ï¼Œè¯´æ˜ç”¨æˆ·æ²¡æœ‰è¾“å…¥ä»»ä½•å†…å®¹æˆ–è€…æ˜¯è¾“å…¥äº†å¾ˆå¤šçš„ç©ºæ ¼ï¼Œ

è¿™æ—¶æ¸…ç©ºå†…å®¹å°†ï¼Œæ–‡æœ¬æ¡†éšè—ã€‚

å¦‚æœè¾“å…¥äº†å†…å®¹åï¼Œå°†è¾“å…¥çš„å†…å®¹æ¸…é™¤ç©ºæ ¼ï¼Œç„¶åæ·»åŠ åˆ°`attr_vals`æ•°ç»„ä¸­ï¼Œè¯¥æ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯å±æ€§ä¿¡æ¯ã€‚ç„¶åå°†æ–‡æœ¬æ¡†ä¸­çš„å†…å®¹æ¸…ç©ºï¼ŒåŒæ—¶éšè—æ–‡æœ¬æ¡†ã€‚

ä¸‹é¢è°ƒç”¨`saveAttrVals`æ–¹æ³•ï¼Œå°†å†…å®¹å‘é€åˆ°æœåŠ¡ç«¯ï¼Œä¿å­˜åˆ°æ•°æ®åº“ä¸­.

## 13ã€åˆ é™¤å‚æ•°

ç»™å±æ€§æ‰€åœ¨çš„`el-tag` æ ‡ç­¾æ·»åŠ åˆ é™¤äº‹ä»¶ã€‚

æˆ‘ä»¬çŸ¥é“ï¼Œç»™`el-tag`æ ‡ç­¾æ·»åŠ äº†` closable`å±æ€§ä»¥åï¼Œåœ¨æœ‰ä¸Šè§’ä¼šå‡ºç°ï¼Œå‰å·ï¼Œè€Œç‚¹å‡»`å‰å·`å°±ä¼šè§¦å‘`close`äº‹ä»¶ã€‚

```vue
<el-tag
  v-for="(item, i) in scope.row.attr_vals"
  :key="i"
  closable
  @close="handleClose(i, scope.row)"
>{{item}}</el-tag>
```

å¯¹åº”çš„`handleClose`æ–¹æ³•å¦‚ä¸‹ï¼š

```js
    // åˆ é™¤å¯¹åº”çš„å‚æ•°å¯é€‰é¡¹
    handleClose(i, row) {
        //ç§»é™¤æŒ‡å®šçš„å†…å®¹ã€‚
      row.attr_vals.splice(i, 1);
      this.saveAttrVals(row);
    },
```

# åä¸€ã€å•†å“åˆ—è¡¨

## 1ã€å•†å“æ•°æ®å±•ç¤º

åœ¨`components`ç›®å½•ä¸‹çš„`goods`ç›®å½•ä¸‹åˆ›å»º`List.vue`æ–‡ä»¶ï¼Œå®ç°æ•´ä½“çš„ç»“æ„å¦‚ä¸‹ï¼š

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“åˆ—è¡¨</el-breadcrumb-item>
    </el-breadcrumb>

    <!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
    <el-card>
      <el-row :gutter="20">
        <el-col :span="8">
          <el-input
            placeholder="è¯·è¾“å…¥å†…å®¹"
            v-model="queryInfo.query"
            clearable
            @clear="getGoodsList"
          >
            <el-button
              slot="append"
              icon="el-icon-search"
              @click="getGoodsList"
            ></el-button>
          </el-input>
        </el-col>
        <el-col :span="4">
          <el-button type="primary" @click="goAddpage">æ·»åŠ å•†å“</el-button>
        </el-col>
      </el-row>

      <!-- tableè¡¨æ ¼åŒºåŸŸ -->
      <el-table :data="goodslist" border stripe>
        <el-table-column type="index"></el-table-column>
        <el-table-column label="å•†å“åç§°" prop="goods_name"></el-table-column>
        <el-table-column
          label="å•†å“ä»·æ ¼(å…ƒ)"
          prop="goods_price"
          width="95px"
        ></el-table-column>
        <el-table-column
          label="å•†å“é‡é‡"
          prop="goods_weight"
          width="70px"
        ></el-table-column>
        <el-table-column label="åˆ›å»ºæ—¶é—´" prop="add_time" width="140px">
          <template slot-scope="scope">{{
            scope.row.add_time | dateFormat
          }}</template>
        </el-table-column>
        <el-table-column label="æ“ä½œ" width="130px">
          <template slot-scope="scope">
            <el-button
              type="primary"
              icon="el-icon-edit"
              size="mini"
            ></el-button>
            <el-button
              type="danger"
              icon="el-icon-delete"
              size="mini"
              @click="removeById(scope.row.goods_id)"
            ></el-button>
          </template>
        </el-table-column>
      </el-table>
      <!-- åˆ†é¡µåŒºåŸŸ -->
      <el-pagination
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
        :current-page="queryInfo.pagenum"
        :page-sizes="[5, 10, 15, 20]"
        :page-size="queryInfo.pagesize"
        layout="total, sizes, prev, pager, next, jumper"
        :total="total"
        background
      ></el-pagination>
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      // æŸ¥è¯¢å‚æ•°å¯¹è±¡
      queryInfo: {
        query: "",
        pagenum: 1,
        pagesize: 10,
      },
      // å•†å“åˆ—è¡¨
      goodslist: [],
      // æ€»æ•°æ®æ¡æ•°
      total: 0,
    };
  },
  created() {
    this.getGoodsList();
  },
  methods: {
    // æ ¹æ®åˆ†é¡µè·å–å¯¹åº”çš„å•†å“åˆ—è¡¨
    async getGoodsList() {
      const { data: res } = await this.$http.get("goods", {
        params: this.queryInfo,
      });

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å•†å“åˆ—è¡¨å¤±è´¥ï¼");
      }

      this.$message.success("è·å–å•†å“åˆ—è¡¨æˆåŠŸï¼");
      console.log(res.data);
      this.goodslist = res.data.goods;
      this.total = res.data.total;
    },
    handleSizeChange(newSize) {
      this.queryInfo.pagesize = newSize;
      this.getGoodsList();
    },
    handleCurrentChange(newPage) {
      this.queryInfo.pagenum = newPage;
      this.getGoodsList();
    },
  },
};
</script>
```

è·¯ç”±è®¾ç½®ï¼š

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
import Roles from "./components/power/Roles.vue";
import Cate from "./components/goods/Cate.vue";
import Params from "./components/goods/Params.vue";
import GoodsList from "./components/goods/List.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
        { path: "/categories", component: Cate },
        { path: "/params", component: Params },
          //å•†å“åˆ—è¡¨
        { path: "/goods", component: GoodsList },
      ],
    },
```

## 2ã€å…¨å±€è¿‡æ»¤å™¨çš„åˆ›å»º

åœ¨`main.js`æ–‡ä»¶ä¸­åˆ›å»ºå…¨å±€çš„è¿‡æ»¤å™¨ï¼Œå¯¹æ—¶é—´è¿›è¡Œå¤„ç†ã€‚

```js
Vue.filter("dateFormat", function (originVal) {
  const dt = new Date(originVal);

  const y = dt.getFullYear();
  const m = (dt.getMonth() + 1 + "").padStart(2, "0");
  const d = (dt.getDate() + "").padStart(2, "0");

  const hh = (dt.getHours() + "").padStart(2, "0");
  const mm = (dt.getMinutes() + "").padStart(2, "0");
  const ss = (dt.getSeconds() + "").padStart(2, "0");

  return `${y}-${m}-${d} ${hh}:${mm}:${ss}`;
});
```

åœ¨è¡¨æ ¼çš„ä½œç”¨åŸŸæ’æ§½ä¸­ï¼Œè·å–æ—¶é—´æ•°æ®ï¼Œç„¶åä½¿ç”¨ä¸Šé¢çš„è¿‡æ»¤å™¨ï¼Œè¿›è¡Œæ—¶é—´æ—¥æœŸçš„è¿‡æ»¤ã€‚

```vue
<el-table-column label="åˆ›å»ºæ—¶é—´" prop="add_time" width="140px">
          <template slot-scope="scope">{{scope.row.add_time | dateFormat}}</template>
        </el-table-column>
```

## 3ã€åˆ é™¤å•†å“ä¿¡æ¯

å…·ä½“çš„åˆ é™¤æ“ä½œå¦‚ä¸‹ï¼š

```js
  async removeById(id) {
      const confirmResult = await this.$confirm(
        'æ­¤æ“ä½œå°†æ°¸ä¹…åˆ é™¤è¯¥å•†å“, æ˜¯å¦ç»§ç»­?',
        'æç¤º',
        {
          confirmButtonText: 'ç¡®å®š',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning'
        }
      ).catch(err => err)

      if (confirmResult !== 'confirm') {
        return this.$message.info('å·²ç»å–æ¶ˆåˆ é™¤ï¼')
      }

      const { data: res } = await this.$http.delete(`goods/${id}`)

      if (res.meta.status !== 200) {
        return this.$message.error('åˆ é™¤å¤±è´¥ï¼')
      }

      this.$message.success('åˆ é™¤æˆåŠŸï¼')
      this.getGoodsList()
    },
```

å•å‡»è¡¨æ ¼ä¸­çš„åˆ é™¤æŒ‰é’®çš„æ—¶å€™ï¼Œè°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ã€‚

```vue
<el-button
  type="danger"
  icon="el-icon-delete"
  size="mini"
  @click="removeById(scope.row.goods_id)"
></el-button>
```

# åäºŒã€å•†å“æ·»åŠ 

## 1ã€å•†å“æ·»åŠ é¡µé¢æ„å»º

å½“å•å‡»å•†å“åˆ—è¡¨é¡µé¢ä¸­çš„â€œæ·»åŠ å•†å“â€æŒ‰é’®ï¼Œä¼šè·³è½¬åˆ°å•†å“æ·»åŠ é¡µé¢ã€‚

```vue
<el-col :span="4">
          <el-button type="primary" @click="goAddpage">æ·»åŠ å•†å“</el-button>
        </el-col>
```

`goAddpage`æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š

```js
goAddpage() {
      this.$router.push("/goods/add");
    },
```

è·¯ç”±è®¾ç½®å¦‚ä¸‹ï¼š

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
import Roles from "./components/power/Roles.vue";
import Cate from "./components/goods/Cate.vue";
import Params from "./components/goods/Params.vue";
import GoodsList from "./components/goods/List.vue";
import Add from "./components/goods/Add.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
        { path: "/categories", component: Cate },
        { path: "/params", component: Params },
        { path: "/goods", component: GoodsList },
        //æ·»åŠ å•†å“
        { path: "/goods/add", component: Add },
      ],
    },
  ],
});
```

åœ¨`component`ç›®å½•ä¸‹çš„`goods`ç›®å½•ä¸‹é¢åˆ›å»º`Add.vue`è¿™ä¸ªç»„ä»¶ï¼ŒåŸºæœ¬çš„å¸ƒå±€å¦‚ä¸‹ï¼š

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>æ·»åŠ å•†å“</el-breadcrumb-item>
    </el-breadcrumb>
    <!-- å¡ç‰‡è§†å›¾ -->
    <el-card>
      <!-- æç¤ºåŒºåŸŸ -->
      <el-alert
        title="æ·»åŠ å•†å“ä¿¡æ¯"
        type="info"
        center
        show-icon
        :closable="false"
      ></el-alert>
      <!-- æ­¥éª¤æ¡åŒºåŸŸ -->
      <el-steps
        :space="200"
        :active="activeIndex"
        finish-status="success"
        align-center
      >
        <el-step title="åŸºæœ¬ä¿¡æ¯"></el-step>
        <el-step title="å•†å“å‚æ•°"></el-step>
        <el-step title="å•†å“å±æ€§"></el-step>
        <el-step title="å•†å“å›¾ç‰‡"></el-step>
        <el-step title="å•†å“å†…å®¹"></el-step>
        <el-step title="å®Œæˆ"></el-step>
      </el-steps>

      <!-- tabæ åŒºåŸŸ -->
      <el-tabs :tab-position="'left'" style="height:200px">
        <el-tab-pane label="åŸºæœ¬ä¿¡æ¯">åŸºæœ¬ä¿¡æ¯</el-tab-pane>
        <el-tab-pane label="å•†å“å‚æ•°">å•†å“å‚æ•°</el-tab-pane>
        <el-tab-pane label="å•†å“å±æ€§">å•†å“å±æ€§</el-tab-pane>
        <el-tab-pane label="å•†å“å›¾ç‰‡">å•†å“å›¾ç‰‡</el-tab-pane>
        <el-tab-pane label="å•†å“å†…å®¹">å•†å“å†…å®¹</el-tab-pane>
      </el-tabs>
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      activeIndex: 0,
    };
  },
};
</script>
```

åœ¨`element.js`æ–‡ä»¶ä¸­å®Œæˆå¯¹æ­¥éª¤ç»„ä»¶çš„æ³¨å†Œã€‚

```
Vue.use(Steps);
Vue.use(Step);
```

ä¸‹é¢è¦å®ç°çš„æ˜¯å•å‡»`tab`æ ï¼Œå¯¹åº”çš„æ­¥éª¤æ¡ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿå°±æ˜¯å®ç°`tab`æ ä¸æ­¥éª¤æ¡ä¹‹é—´çš„è”åŠ¨æ•ˆæœã€‚

é¦–å…ˆç»™`tabs`æ æ·»åŠ `v-model`å±æ€§ï¼Œè¯¥å±æ€§ç»‘å®šçš„å€¼ä¸º`activeIndex`,è¿™æ ·å½“æˆ‘ä»¬é€‰æ‹©`tabs`ä¸­çš„ä¸åŒçš„é¡¹çš„æ—¶å€™å¯¹åº”çš„`name`å±æ€§çš„å€¼ä¼šèµ‹å€¼ç»™`activeIndex`è¿™ä¸ª`data`å±æ€§ã€‚

```vue
<!-- tabæ åŒºåŸŸ -->
<el-tabs :tab-position="'left'" style="height:200px" v-model="activeIndex">
        <el-tab-pane label="åŸºæœ¬ä¿¡æ¯" name="0">åŸºæœ¬ä¿¡æ¯</el-tab-pane>
        <el-tab-pane label="å•†å“å‚æ•°" name="1">å•†å“å‚æ•°</el-tab-pane>
        <el-tab-pane label="å•†å“å±æ€§" name="2">å•†å“å±æ€§</el-tab-pane>
        <el-tab-pane label="å•†å“å›¾ç‰‡" name="3">å•†å“å›¾ç‰‡</el-tab-pane>
        <el-tab-pane label="å•†å“å†…å®¹" name="4">å•†å“å†…å®¹</el-tab-pane>
      </el-tabs>
```

ä¸‹é¢çœ‹ä¸€ä¸‹æ­¥éª¤æ¡çš„æ›´æ”¹

```vue
 <el-steps :space="200" :active="activeIndex-0" finish-status="success" align-center>
```

å½“é€‰æ‹©æ­¥éª¤æ¡ä¸­çš„æŸä¸€é¡¹æ—¶ï¼Œå¯¹åº”çš„`activeIndex`ä¸­å­˜å‚¨çš„å°±æ˜¯è¿™ä¸€é¡¹çš„ä¸€ä¸ªç¼–å·ï¼ˆä» 0 å¼€å§‹è®¡ç®—ï¼‰ã€‚

è¿™æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¥éª¤æ¡ä¸å¯¼èˆªæ¡å…±äº«äº†`activeIndex`è¿™ä¸ªçŠ¶æ€å±æ€§ã€‚

ä½†æ˜¯è¦æ³¨æ„çš„å°±æ˜¯æ­¥éª¤æ¡ä¸­éœ€è¦çš„`activeIndex`æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å‡å» 0ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥è½¬æ¢æˆæ•°å­—ã€‚

è€Œå¯¼èˆªæ¡ä¸­ä½¿ç”¨çš„`activeIndex`å±æ€§çš„å€¼ä¸ºå­—ç¬¦ä¸²ã€‚

## 2ã€åŸºæœ¬è¡¨å•å®ç°

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¡¨å•çš„å†…å®¹éƒ½åˆ†å‘åˆ°ä¸åŒçš„é¡µç­¾ä¸‹é¢ã€‚

é¦–å…ˆæ„å»ºçš„æ˜¯ç¬¬ä¸€ä¸ªé¡µç­¾â€œåŸºæœ¬ä¿¡æ¯â€çš„è¡¨å•ã€‚

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>å•†å“ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>æ·»åŠ å•†å“</el-breadcrumb-item>
    </el-breadcrumb>
    <!-- å¡ç‰‡è§†å›¾ -->
    <el-card>
      <!-- æç¤ºåŒºåŸŸ -->
      <el-alert
        title="æ·»åŠ å•†å“ä¿¡æ¯"
        type="info"
        center
        show-icon
        :closable="false"
      ></el-alert>
      <!-- æ­¥éª¤æ¡åŒºåŸŸ -->
      <el-steps
        :space="200"
        :active="activeIndex - 0"
        finish-status="success"
        align-center
      >
        <el-step title="åŸºæœ¬ä¿¡æ¯"></el-step>
        <el-step title="å•†å“å‚æ•°"></el-step>
        <el-step title="å•†å“å±æ€§"></el-step>
        <el-step title="å•†å“å›¾ç‰‡"></el-step>
        <el-step title="å•†å“å†…å®¹"></el-step>
        <el-step title="å®Œæˆ"></el-step>
      </el-steps>

      <!-- tabæ åŒºåŸŸ æ·»åŠ äº†ä¸€ä¸ªè¡¨å• -->
      <el-form
        :model="addForm"
        :rules="addFormRules"
        ref="addFormRef"
        label-width="100px"
        label-position="top"
      >
        <el-tabs :tab-position="'left'" v-model="activeIndex">
          <el-tab-pane label="åŸºæœ¬ä¿¡æ¯" name="0">
            <el-form-item label="å•†å“åç§°" prop="goods_name">
              <el-input v-model="addForm.goods_name"></el-input>
            </el-form-item>
            <el-form-item label="å•†å“ä»·æ ¼" prop="goods_price">
              <el-input v-model="addForm.goods_price" type="number"></el-input>
            </el-form-item>
            <el-form-item label="å•†å“é‡é‡" prop="goods_weight">
              <el-input v-model="addForm.goods_weight" type="number"></el-input>
            </el-form-item>
            <el-form-item label="å•†å“æ•°é‡" prop="goods_number">
              <el-input v-model="addForm.goods_number" type="number"></el-input>
            </el-form-item>
            <el-form-item label="å•†å“åˆ†ç±»" prop="goods_cat">
              <el-cascader
                expand-trigger="hover"
                :options="catelist"
                :props="cateProps"
                v-model="addForm.goods_cat"
                @change="handleChange"
              ></el-cascader>
            </el-form-item>
          </el-tab-pane>
          <el-tab-pane label="å•†å“å‚æ•°" name="1">å•†å“å‚æ•°</el-tab-pane>
          <el-tab-pane label="å•†å“å±æ€§" name="2">å•†å“å±æ€§</el-tab-pane>
          <el-tab-pane label="å•†å“å›¾ç‰‡" name="3">å•†å“å›¾ç‰‡</el-tab-pane>
          <el-tab-pane label="å•†å“å†…å®¹" name="4">å•†å“å†…å®¹</el-tab-pane>
        </el-tabs>
      </el-form>
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      activeIndex: 0,
      // æ·»åŠ å•†å“çš„è¡¨å•æ•°æ®å¯¹è±¡
      addForm: {
        goods_name: "",
        goods_price: 0,
        goods_weight: 0,
        goods_number: 0,
        // å•†å“æ‰€å±çš„åˆ†ç±»æ•°ç»„
        goods_cat: [],
      },
      addFormRules: {
        goods_name: [
          { required: true, message: "è¯·è¾“å…¥å•†å“åç§°", trigger: "blur" },
        ],
        goods_price: [
          { required: true, message: "è¯·è¾“å…¥å•†å“ä»·æ ¼", trigger: "blur" },
        ],
        goods_weight: [
          { required: true, message: "è¯·è¾“å…¥å•†å“é‡é‡", trigger: "blur" },
        ],
        goods_number: [
          { required: true, message: "è¯·è¾“å…¥å•†å“æ•°é‡", trigger: "blur" },
        ],
        goods_cat: [
          { required: true, message: "è¯·é€‰æ‹©å•†å“åˆ†ç±»", trigger: "blur" },
        ],
      },
      // å•†å“åˆ†ç±»åˆ—è¡¨
      catelist: [],
      cateProps: {
        label: "cat_name",
        value: "cat_id",
        children: "children",
      },
    };
  },
  created() {
    this.getCateList();
  },
  methods: {
    // è·å–æ‰€æœ‰å•†å“åˆ†ç±»æ•°æ®
    async getCateList() {
      const { data: res } = await this.$http.get("categories");

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–å•†å“åˆ†ç±»æ•°æ®å¤±è´¥ï¼");
      }

      this.catelist = res.data;
      console.log(this.catelist);
    },
    // çº§è”é€‰æ‹©å™¨é€‰ä¸­é¡¹å˜åŒ–ï¼Œä¼šè§¦å‘è¿™ä¸ªå‡½æ•°
    handleChange() {
      console.log(this.addForm.goods_cat);
      if (this.addForm.goods_cat.length !== 3) {
        this.addForm.goods_cat = [];
      }
    },
  },
};
</script>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯ä½¿ç”¨"è¡¨å•"æŠŠæ•´ä¸ª`tabs`ç»™åŒ…è£¹èµ·æ¥äº†ï¼ŒåŒæ—¶åœ¨â€œåŸºæœ¬ä¿¡æ¯â€è¿™ä¸€ä¸ªé€‰é¡¹ä¸­ï¼Œæ„å»ºäº†åŸºæœ¬çš„è¡¨å•å…ƒç´ ã€‚

## 3ã€é˜»æ­¢æ ‡ç­¾é¡µåˆ‡æ¢

å¦‚æœç”¨æˆ·åœ¨è®¿é—®â€œåŸºæœ¬ä¿¡æ¯â€è¿™ä¸€ä¸ªé¡µç­¾ä¸­çš„å†…å®¹æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰é€‰æ‹©ä¸‹æ‹‰èœå•ä¸­çš„å•†å“åˆ†ç±»ï¼Œå¹¶ä¸”æ˜¯æ²¡æœ‰é€‰æ‹©ä¸‰çº§åˆ†ç±»ï¼Œç„¶ååˆå»ç‚¹å‡»å…¶å®ƒçš„é¡µç­¾å†…å®¹ï¼Œè¿™æ—¶åº”è¯¥ç»™å‡ºç›¸åº”çš„æç¤ºï¼Œç¦æ­¢åˆ‡æ¢ã€‚

è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨äº†`before-leave`è¿™ä¸ªäº‹ä»¶ï¼Œè¯¥äº‹ä»¶çš„è§¦å‘æ˜¯åœ¨åˆ‡æ¢é¡µç­¾çš„æ—¶å€™å‘ç”Ÿã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¯¥äº‹ä»¶å¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­ï¼Œåšç›¸åº”çš„åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦é€‰æ‹©äº†ä¸‹æ‹‰æ¡†ä¸­çš„å•†å“ç±»åˆ«ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™ç¦æ­¢æµè§ˆå…¶å®ƒé¡µç­¾ã€‚

```html
<el-tabs
  :tab-position="'left'"
  v-model="activeIndex"
  :before-leave="beforeTabLeave"
></el-tabs>
```

`beforeTabLeave`æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š

```js
  beforeTabLeave(activeName, oldActiveName) {
      // console.log('å³å°†ç¦»å¼€çš„æ ‡ç­¾é¡µåå­—æ˜¯ï¼š' + oldActiveName)
      // console.log('å³å°†è¿›å…¥çš„æ ‡ç­¾é¡µåå­—æ˜¯ï¼š' + activeName)
      // return false
      //å¦‚æœç°åœ¨è®¿é—®çš„æ˜¯ç¬¬ä¸€ä¸ªé¡µç­¾ï¼ˆåŸºæœ¬ä¿¡æ¯ï¼‰ï¼Œå¹¶ä¸”æ²¡æœ‰é€‰æ‹©ä¸‰çº§ç±»åˆ«ï¼Œç¦æ­¢è®¿é—®å…¶å®ƒçš„å†…å®¹ã€‚
      if (oldActiveName === "0" && this.addForm.goods_cat.length !== 3) {
        this.$message.error("è¯·å…ˆé€‰æ‹©å•†å“åˆ†ç±»ï¼");
        return false;
      }
    },
```

## 4ã€è·å–åŠ¨æ€å‚æ•°åˆ—è¡¨æ•°æ®

å½“ç”¨æˆ·å•å‡»â€œå•†å“å‚æ•°â€è¿™ä¸ªé¡µç­¾çš„æ—¶å€™ï¼Œè¦è·å–å¯¹åº”çš„åŠ¨æ€å‚æ•°ã€‚

è¿™æ—¶ç»™`el-tabs`é¡µç­¾ï¼Œæ·»åŠ `tab-click`äº‹ä»¶ï¼Œè¯¥äº‹ä»¶æ˜¯åœ¨å•å‡»é¡µç­¾çš„æ—¶å€™è§¦å‘ï¼Œåœ¨å…¶å¯¹åº”çš„å‡½æ•°ä¸­ï¼Œæ ¹æ®åœ¨â€œåŸºæœ¬ä¿¡æ¯â€è¿™ä¸ªé¡µç­¾ä¸­ï¼Œé€‰æ‹©çš„ä¸‰çº§å•†å“ç±»åˆ«çš„ç¼–å·æ¥æŸ¥è¯¢å‡ºå¯¹åº”çš„åŠ¨æ€å‚æ•°ã€‚

```html
<el-tabs
  v-model="activeIndex"
  :tab-position="'left'"
  :before-leave="beforeTabLeave"
  @tab-click="tabClicked"
></el-tabs>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç»™`el-tabs`ç»„ä»¶æ·»åŠ `tab-click`äº‹ä»¶ã€‚

`tabClicked`å¯¹åº”çš„å¤„ç†å‡½æ•°å¦‚ä¸‹ï¼š

```js
 async tabClicked() {
      // console.log(this.activeIndex)
      // è¯æ˜è®¿é—®çš„æ˜¯åŠ¨æ€å‚æ•°é¢æ¿,cateIdç±»åˆ«ç¼–å·ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å±æ€§è·å–ã€‚
      if (this.activeIndex === "1") {
        const { data: res } = await this.$http.get(
          `categories/${this.cateId}/attributes`,
          {
            params: { sel: "many" },
          }
        );

        if (res.meta.status !== 200) {
          return this.$message.error("è·å–åŠ¨æ€å‚æ•°åˆ—è¡¨å¤±è´¥ï¼");
        }

        console.log(res.data);

        this.manyTableData = res.data;
      }
    },
```

è®¡ç®—å±æ€§å¦‚ä¸‹ï¼š

```js
 computed: {
    cateId() {
      //æ¡ä»¶æˆç«‹è¡¨æ˜é€‰æ‹©äº†ä¸‰çº§ç±»åˆ«ã€‚
      if (this.addForm.goods_cat.length === 3) {
        //è·å–æœ€åä¸€ä¸ªç±»åˆ«ç¼–å·
        return this.addForm.goods_cat[2];
      }
      return null;
    },
  },
```

**ç°åœ¨å·²ç»å°†åŠ¨æ€æ•°æ®æŸ¥è¯¢å‡ºæ¥äº†ï¼Œä¸‹é¢éœ€è¦å°†å…¶æ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚**

```vue
<el-tab-pane label="å•†å“å‚æ•°" name="1">
            <!-- æ¸²æŸ“è¡¨å•çš„Itemé¡¹ -->
            <el-form-item :label="item.attr_name" v-for="item in manyTableData" :key="item.attr_id">
              <!-- å¤é€‰æ¡†ç»„ -->
              <el-checkbox-group v-model="item.attr_vals">
                <el-checkbox :label="cb" v-for="(cb, i) in item.attr_vals" :key="i" border></el-checkbox>
              </el-checkbox-group>
            </el-form-item>
          </el-tab-pane>
```

åœ¨â€œå•†å“å‚æ•°â€è¿™ä¸ªé¡µç­¾ä¸­ï¼Œå±•ç¤ºå‡ºå¯¹åº”çš„åŠ¨æ€å‚æ•°ï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªå‚æ•°åç§°å‰é¢éƒ½ä¼šæœ‰ä¸€ä¸ªå¤é€‰æ¡†ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ„å»ºä¸€ä¸ªè¡¨å•çš„é¡¹`el-form-item`.

ç„¶åå¯¹`manyTableData`ä¸­å­˜å‚¨çš„åŠ¨æ€æ•°æ®è¿›è¡Œå¾ªç¯éå†ï¼Œéå†çš„å°±æ˜¯å¤é€‰æ¡†,å¤é€‰æ¡†åœ¨`el-checkbox-group`ä¸­å°±æ˜¯ä¸€ç»„ï¼Œè€Œä¸”è¯¥æ ‡ç­¾éœ€è¦ä¸€ä¸ª`v-model`è¿›è¡ŒåŒå‘æ•°æ®ç»‘å®šï¼Œç»‘å®šçš„ç±»å‹å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

å¯¹`el-form-item`å¾ªç¯ï¼Œå±•ç¤ºçš„æ˜¯å±æ€§åç§°ï¼ˆä¾‹å¦‚é¢œè‰²ï¼‰ï¼Œå¯¹å¤é€‰æ¡†è¿›è¡Œæ¢è¡Œå±•ç¤ºçš„å°±æ˜¯åŠ¨æ€å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œçº¢è‰²ï¼Œé»‘è‰²ç­‰ï¼‰ã€‚

åœ¨ä»€ä¹ˆæ—¶å€™å°†`attr_vals`è½¬æ¢æˆæ•°ç»„å‘¢ï¼Ÿ

åœ¨`tabClicked`æ–¹æ³•ä¸­ï¼Œå°†`attr_vals`è½¬æ¢æˆæ•°ç»„ã€‚

```js
    async tabClicked() {
      // console.log(this.activeIndex)
      // è¯æ˜è®¿é—®çš„æ˜¯åŠ¨æ€å‚æ•°é¢æ¿,cateIdç±»åˆ«ç¼–å·ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å±æ€§è·å–ã€‚
      if (this.activeIndex === "1") {
        const { data: res } = await this.$http.get(
          `categories/${this.cateId}/attributes`,
          {
            params: { sel: "many" },
          }
        );

        if (res.meta.status !== 200) {
          return this.$message.error("è·å–åŠ¨æ€å‚æ•°åˆ—è¡¨å¤±è´¥ï¼");
        }

        console.log("aaaa=", res.data);
        //å°†attr_valså†…å®¹è½¬æ¢æˆæ•°ç»„
        res.data.forEach((item) => {
          item.attr_vals =
            item.attr_vals.length === 0 ? [] : item.attr_vals.split(" ");
        });
        this.manyTableData = res.data;
      }
    },
  },
```

## 5ã€è·å–é™æ€å±æ€§

è¿™é‡Œæˆ‘ä»¬ä¸»è¦å®ç°çš„å°±æ˜¯å•†å“å±æ€§è¿™ä¸ªé¡µç­¾ä¸­æ•°æ®çš„å±•ç¤ºæ“ä½œã€‚

è¿™é‡Œæ˜¯å°†é™æ€å±æ€§çš„å†…å®¹å¡«å……åˆ°è¡¨å•ä¸­ã€‚

åœ¨ç¬¬ 4 å°èŠ‚çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è·å–çš„æ˜¯åŠ¨æ€å‚æ•°åˆ—è¡¨ã€‚

åœ¨è·å–åŠ¨æ€å‚æ•°çš„æ—¶å€™ï¼Œåœ¨`tabClicked` æ–¹æ³•ä¸­æˆ‘ä»¬æ˜¯åˆ¤æ–­`this.activeIndex`çš„å–å€¼æ˜¯å¦ä¸º 1ï¼Œå¦‚æœä¸º 1ï¼Œè¡¨ç¤ºçš„æ˜¯ç”¨æˆ·é€‰æ‹©äº†â€œå•†å“å‚æ•°â€è¿™ä¸ªé¡µç­¾ï¼Œå¦‚æœ`this.activeIndex` çš„å–å€¼ä¸º 2ï¼Œè¡¨ç¤ºçš„æ˜¯ç”¨æˆ·é€‰æ‹©äº†â€œå•†å“å±æ€§â€è¿™ä¸ªæ ‡ç­¾ã€‚

è¿™éœ€è¦è·å–å¯¹åº”çš„é™æ€å±æ€§æ•°æ®ã€‚

```js
 async tabClicked() {
      // console.log(this.activeIndex)
      // è¯æ˜è®¿é—®çš„æ˜¯åŠ¨æ€å‚æ•°é¢æ¿,cateIdç±»åˆ«ç¼–å·ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å±æ€§è·å–ã€‚
      if (this.activeIndex === "1") {
        const { data: res } = await this.$http.get(
          `categories/${this.cateId}/attributes`,
          {
            params: { sel: "many" },
          }
        );

        if (res.meta.status !== 200) {
          return this.$message.error("è·å–åŠ¨æ€å‚æ•°åˆ—è¡¨å¤±è´¥ï¼");
        }

        console.log("aaaa=", res.data);
        //å°†attr_valså†…å®¹è½¬æ¢æˆæ•°ç»„
        res.data.forEach((item) => {
          item.attr_vals =
            item.attr_vals.length === 0 ? [] : item.attr_vals.split(" ");
        });
        this.manyTableData = res.data;
      } else if (this.activeIndex === "2") {
          //è·å–é™æ€å±æ€§
        const { data: res } = await this.$http.get(
          `categories/${this.cateId}/attributes`,
          {
            params: { sel: "only" },
          }
        );

        if (res.meta.status !== 200) {
          return this.$message.error("è·å–é™æ€å±æ€§å¤±è´¥ï¼");
        }

        console.log(res.data);
        this.onlyTableData = res.data;
      }
    },
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­å°†è·å–åˆ°çš„é™æ€å±æ€§æ•°æ®èµ‹å€¼ç»™äº†`onlyTableData`è¿™ä¸ªçŠ¶æ€å±æ€§ã€‚

ä¸‹é¢å°†è¯¥å±æ€§ä¸­çš„å†…å®¹æ¸²æŸ“åˆ°é¡µé¢ä¸­å°±å¯ä»¥äº†ã€‚

```html
<el-tab-pane label="å•†å“å±æ€§" name="2">
  <el-form-item
    :label="item.attr_name"
    v-for="item in onlyTableData"
    :key="item.attr_id"
  >
    <el-input v-model="item.attr_vals"></el-input>
  </el-form-item>
</el-tab-pane>
```

è¿™é‡Œçš„`attr_vals`ä¸éœ€è¦ä¸ºæ•°ç»„ã€‚

## 6ã€å›¾ç‰‡ä¸Šä¼ 

åœ¨å•†å“å›¾ç‰‡è¿™ä¸€ä¸ªé¡µç­¾ä¸­ï¼Œä¸»è¦çš„å°±æ˜¯å®ç°å›¾ç‰‡çš„ä¸Šä¼ åŠŸèƒ½ã€‚

ä¸‹é¢çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°è¿‡ç¨‹

è¿™é‡Œä½¿ç”¨çš„`Upload`ç»„ä»¶æ¥å®ç°æ–‡ä»¶ä¸Šä¼ ã€‚

```vue
<el-tab-pane label="å•†å“å›¾ç‰‡" name="3">
            <!-- action è¡¨ç¤ºå›¾ç‰‡è¦ä¸Šä¼ åˆ°çš„åå°APIåœ°å€ -->
            <el-upload
              :action="uploadURL"
              :on-preview="handlePreview"
              :on-remove="handleRemove"
              list-type="picture"
              :headers="headerObj"
              :on-success="handleSuccess"
            >
              <el-button size="small" type="primary">ç‚¹å‡»ä¸Šä¼ </el-button>
            </el-upload>
          </el-tab-pane>
```

`on-preview`è¡¨ç¤ºçš„æ˜¯å¤„ç†å›¾ç‰‡é¢„è§ˆæ•ˆæœ

`on-remove`è¡¨ç¤ºçš„æ˜¯å¤„ç†ç§»é™¤å›¾ç‰‡çš„æ“ä½œ

`list-type`:è¡¨ç¤ºçš„ä¸Šä¼ ç»„ä»¶å±•ç¤ºçš„æ•ˆæœ

`headers`: å›¾ç‰‡ä¸Šä¼ ç»„ä»¶çš„ headers è¯·æ±‚å¤´å¯¹è±¡,è¿™é‡Œéå¸¸å…³é”®ï¼Œå®Œæˆ`API`æƒé™æ ¡éªŒ

`on-success`:å›¾ç‰‡ä¸Šä¼ æˆåŠŸåçš„å¤„ç†ã€‚

å¯¹åº”çš„`data`ä¸­å±æ€§çš„å®šä¹‰

```js
 // ä¸Šä¼ å›¾ç‰‡çš„URLåœ°å€
      uploadURL: 'http://127.0.0.1:8888/api/private/v1/upload',
      // å›¾ç‰‡ä¸Šä¼ ç»„ä»¶çš„headersè¯·æ±‚å¤´å¯¹è±¡
      headerObj: {
        Authorization: window.sessionStorage.getItem('token')
      },
```

å¯¹åº”çš„æ–¹æ³•å¤„ç†

```js
  // å¤„ç†å›¾ç‰‡é¢„è§ˆæ•ˆæœ
    handlePreview() {},
    // å¤„ç†ç§»é™¤å›¾ç‰‡çš„æ“ä½œ
    handleRemove() {},
    // ç›‘å¬å›¾ç‰‡ä¸Šä¼ æˆåŠŸçš„äº‹ä»¶
    handleSuccess(response) {
      console.log(response);
      // 1. æ‹¼æ¥å¾—åˆ°ä¸€ä¸ªå›¾ç‰‡ä¿¡æ¯å¯¹è±¡
      const picInfo = { pic: response.data.tmp_path };
      // 2. å°†å›¾ç‰‡ä¿¡æ¯å¯¹è±¡ï¼Œpush åˆ°picsæ•°ç»„ä¸­
      this.addForm.pics.push(picInfo);
      console.log(this.addForm);
    },
```

ä¸Šä¼ æˆåŠŸåï¼Œæˆ‘ä»¬è¦è·å–æœåŠ¡ç«¯è¿”å›çš„å›¾ç‰‡çš„è·¯å¾„ï¼Œå°†å…¶å­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„`pics`ä¸­ï¼ˆå­˜å‚¨çš„å…ƒç´ æ ¼å¼ä¸ºå¯¹è±¡ï¼Œå…·ä½“æ ¼å¼å‚è€ƒ API æ–‡æ¡£ï¼‰ï¼Œæœ€åæäº¤è¡¨å•çš„æ—¶å€™ä¼šå‘é€åˆ°æœåŠ¡ç«¯ã€‚è€Œå‘é€æœåŠ¡ç«¯çš„å†…å®¹ä¸ä»…åŒ…å«äº†ä¸Šä¼ æˆåŠŸçš„å›¾ç‰‡è·¯å¾„ï¼Œè¿˜æœ‰å‰é¢è¡¨å•ä¸­è¾“å…¥çš„æ•°æ®ï¼Œè¡¨å•å·²ç»ä¸`addForm`å±æ€§ç»‘å®šäº†ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å°†`pics`æ•°ç»„ä¹Ÿæ·»åŠ åˆ°`addForm`è¿™ä¸ªè¡¨å•ä¸­ï¼Œæœ€åå°†`addForm`ä¸­çš„å†…å®¹å‘é€åˆ°æœåŠ¡ç«¯å°±å¯ä»¥äº†ã€‚

```js
 // æ·»åŠ å•†å“çš„è¡¨å•æ•°æ®å¯¹è±¡
      addForm: {
        goods_name: "",
        goods_price: 0,
        goods_weight: 0,
        goods_number: 0,
        // å•†å“æ‰€å±çš„åˆ†ç±»æ•°ç»„
        goods_cat: [],
        // å›¾ç‰‡çš„æ•°ç»„
        pics: [],
      },
```

## 7ã€å›¾ç‰‡åˆ é™¤

å¯ä»¥åˆ é™¤å›¾ç‰‡ã€‚

```js
// å¤„ç†ç§»é™¤å›¾ç‰‡çš„æ“ä½œ
    handleRemove(file) {
      // console.log(file)
      // 1. è·å–å°†è¦åˆ é™¤çš„å›¾ç‰‡çš„ä¸´æ—¶è·¯å¾„
      const filePath = file.response.data.tmp_path;
      // 2. ä» pics æ•°ç»„ä¸­ï¼Œæ‰¾åˆ°è¿™ä¸ªå›¾ç‰‡å¯¹åº”çš„ç´¢å¼•å€¼
      const i = this.addForm.pics.findIndex((x) => x.pic === filePath);
      // 3. è°ƒç”¨æ•°ç»„çš„ splice æ–¹æ³•ï¼ŒæŠŠå›¾ç‰‡ä¿¡æ¯å¯¹è±¡ï¼Œä» pics æ•°ç»„ä¸­ç§»é™¤
      this.addForm.pics.splice(i, 1);
      console.log(this.addForm);
    },
```

## 8ã€å›¾ç‰‡é¢„è§ˆ

å½“å•å‡»å›¾ç‰‡çš„åç§°çš„æ—¶å€™ï¼Œå¯ä»¥å®ç°å›¾ç‰‡é¢„è§ˆçš„æ•ˆæœã€‚

```js
  // å¤„ç†å›¾ç‰‡é¢„è§ˆæ•ˆæœ
    handlePreview(file) {
      console.log(file);
      this.previewPath = file.response.data.url;
      this.previewVisible = true;
    },
```

å°†æœåŠ¡ç«¯è¿”å›çš„ç»å¯¹è·¯å¾„ç»™`previewPath`å±æ€§ï¼ŒåŒæ—¶è®©çª—å£æ‰“å¼€ï¼ŒæŠŠ`previewVisible`å±æ€§è®¾ç½®ä¸º`true`.

å±æ€§å®šä¹‰

```
  previewPath: "",
      previewVisible: false,
```

çª—å£çš„å®šä¹‰

```vue
<!-- å›¾ç‰‡é¢„è§ˆ -->
<el-dialog title="å›¾ç‰‡é¢„è§ˆ" :visible.sync="previewVisible" width="50%">
      <img :src="previewPath" alt class="previewImg" />
    </el-dialog>
```

## 9ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä½¿ç”¨

é¦–å…ˆå®‰è£…å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

```
npm install vue-quill-editor --save
```

ä¸‹é¢å¯ä»¥è¿›è¡Œå…¨å±€é…ç½®ã€‚

åœ¨`main.js`æ–‡ä»¶ä¸­æ³¨å†Œç»„ä»¶ï¼Œå¹¶å¯¼å…¥ç›¸åº”çš„æ ·å¼

```js
// å¯¼å…¥å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
import VueQuillEditor from "vue-quill-editor";
// require styles å¯¼å…¥å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å¯¹åº”çš„æ ·å¼
import "quill/dist/quill.core.css";
import "quill/dist/quill.snow.css";
import "quill/dist/quill.bubble.css";

// å°†å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ³¨å†Œä¸ºå…¨å±€å¯ç”¨çš„ç»„ä»¶
Vue.use(VueQuillEditor);
```

ä¸‹é¢å…·ä½“ä½¿ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

```vue
<el-tab-pane label="å•†å“å†…å®¹" name="4">
            <!-- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç»„ä»¶ -->
            <quill-editor v-model="addForm.goods_introduce"></quill-editor>
            <!-- æ·»åŠ å•†å“çš„æŒ‰é’® -->
            <el-button type="primary" class="btnAdd" @click="add"
              >æ·»åŠ å•†å“</el-button
            >
          </el-tab-pane>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå°†å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸`addForm`ä¸­çš„`goods_introduce` å±æ€§è¿›è¡Œç»‘å®šï¼Œè¿™æ ·å¯ä»¥é€šè¿‡è¯¥å±æ€§è·å–ç”¨æˆ·åœ¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­è¾“å…¥çš„å†…å®¹ã€‚

åŒæ—¶åœ¨â€œå•†å“å†…å®¹â€è¿™ä¸ªé¡µç­¾ä¸­æ·»åŠ äº†â€œæ·»åŠ å•†å“â€æŒ‰é’®ï¼Œå•å‡»è¯¥æŒ‰é’®å¯ä»¥å®Œæˆå•†å“çš„æ·»åŠ ã€‚

```js
 addForm: {
        goods_name: "",
        goods_price: 0,
        goods_weight: 0,
        goods_number: 0,
        // å•†å“æ‰€å±çš„åˆ†ç±»æ•°ç»„
        goods_cat: [],
        // å›¾ç‰‡çš„æ•°ç»„
        pics: [],
        // å•†å“çš„è¯¦æƒ…æè¿°
        goods_introduce: "",
      },
```

åœ¨`global.css`æ–‡ä»¶ä¸­ï¼Œå®šä¹‰æ ·å¼æ¥æ§åˆ¶ç¼–è¾‘å™¨çš„é«˜åº¦ã€‚

```
.ql-editor {
  min-height: 300px;
}
```

## 10ã€å®Œæˆå•†å“çš„æ·»åŠ 

ä¸‹é¢è¦å¤„ç†çš„å°±æ˜¯å•†å“çš„æ·»åŠ ã€‚

å½“å•å‡»â€œæ·»åŠ å•†å“â€æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ`add`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```js
// æ·»åŠ å•†å“
    add() {
      this.$refs.addFormRef.validate(async (valid) => {
        if (!valid) {
          return this.$message.error("è¯·å¡«å†™å¿…è¦çš„è¡¨å•é¡¹ï¼");
        }
        // æ‰§è¡Œæ·»åŠ çš„ä¸šåŠ¡é€»è¾‘
        // lodash   cloneDeep(obj)
        const form = _.cloneDeep(this.addForm);
        form.goods_cat = form.goods_cat.join(",");
        // å¤„ç†åŠ¨æ€å‚æ•°
        this.manyTableData.forEach((item) => {
          const newInfo = {
            attr_id: item.attr_id,
            attr_value: item.attr_vals.join(" "),
          };
          this.addForm.attrs.push(newInfo);
        });
        // å¤„ç†é™æ€å±æ€§
        this.onlyTableData.forEach((item) => {
          const newInfo = { attr_id: item.attr_id, attr_value: item.attr_vals };
          this.addForm.attrs.push(newInfo);
        });
        form.attrs = this.addForm.attrs;
        console.log(form);

        // å‘èµ·è¯·æ±‚æ·»åŠ å•†å“
        // å•†å“çš„åç§°ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„
        const { data: res } = await this.$http.post("goods", form);

        if (res.meta.status !== 201) {
          return this.$message.error("æ·»åŠ å•†å“å¤±è´¥ï¼");
        }

        this.$message.success("æ·»åŠ å•†å“æˆåŠŸï¼");
        this.$router.push("/goods");
      });
    },
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­

**é¦–å…ˆå…ˆå®Œæˆè¡¨å•çš„æ ¡éªŒ**

ç„¶åä½¿ç”¨`lodash`ä¸­çš„`cloneDeep`æ–¹æ³•å¯¹`addForm`è¿™ä¸ªå¯¹è±¡è¿›è¡Œäº†æ·±æ‹·è´ã€‚è¿™é‡Œä¸ºä»€ä¹ˆä¼šå¯¹`addForm`å¯¹è±¡è¿›è¡Œæ·±æ‹·è´å‘¢ï¼Ÿ

å› ä¸ºåœ¨å‘æœåŠ¡ç«¯å‘é€æ•°æ®æ—¶ï¼Œè¦æ±‚`goods_cat`ä¸­çš„å†…å®¹å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼ˆä»¥é€—å·ä½œä¸ºåˆ†éš”ï¼‰ï¼Œè€Œè¯¥å±æ€§æ˜¯æ•°ç»„ã€‚

é‚£ä¹ˆå¦‚æœé‡‡ç”¨å¦‚ä¸‹çš„å†™æ³•æ˜¯å¦å¯ä»¥å‘¢ï¼Ÿ

```
this.addForm.goods_cat=this.addForm.goods_cat.join(',')
```

ä»¥ä¸Šå†™æ³•æ˜¯ä¸å¯ä»¥çš„ï¼Œå› ä¸ºåœ¨å‘æœåŠ¡ç«¯å‘é€çš„æ•°æ®ä¸­ï¼Œè¦æ±‚`goods_cat`æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨`el-cascader`ç»„ä»¶ä¸­ä½¿ç”¨`goods_cat` å¿…é¡»ä¸ºæ•°ç»„ã€‚

æ‰€ä»¥è¿™é‡Œåªèƒ½é€šè¿‡æ·±æ‹·è´é‡æ–°æ‹·è´å‡ºä¸€ä¸ªå¯¹è±¡ã€‚æœ€ç»ˆå°†è¯¥å¯¹è±¡ï¼ˆ`form`ï¼‰ä¸­çš„å†…å®¹å‘é€åˆ°æœåŠ¡ç«¯ã€‚

`lodash`çš„å®‰è£…å¦‚ä¸‹ï¼š

```
npm i --save lodash
```

å®‰è£…å¥½ä»¥åå¯ä»¥è¿›è¡Œå¯¼å…¥

```
  import _ from 'lodash'
```

ä¸‹é¢è¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ï¼Œæ ¹æ®æ–‡æ¡£çš„è¦æ±‚ï¼ŒåŠ¨æ€å‚æ•°ä¸é™æ€å±æ€§éƒ½è¦æ”¾åˆ°`addForm` å¯¹è±¡ä¸­çš„`attrs`è¿™ä¸ªæ•°ç»„ä¸­ã€‚

æ‰€ä»¥è¿™é‡Œé¦–å…ˆå¯¹`manyTableData`è¿›è¡Œå¾ªç¯éå†ï¼Œåˆ›å»º`newInfo`å¯¹è±¡æ¥ç»„ç»‡æ•°æ®ï¼Œæ³¨æ„ï¼š`attr_value`éœ€è¦çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å°†`attr_vals`è½¬æ¢æˆäº†å­—ç¬¦ä¸²ã€‚

å¯¹äºé™æ€å±æ€§å¤„ç†çš„æ—¶å€™ï¼Œ`attr_vals`æœ¬èº«å°±æ˜¯å­—ç¬¦ä¸²ï¼Œæ— åºè½¬æ¢ã€‚

ä¸‹é¢å°†å¤„ç†å¥½çš„`addForm`ä¸­çš„`attrs`ä¸­çš„æ•°æ®èµ‹å€¼ç»™æ‹·è´å¯¹è±¡ä¸­çš„`atrrs`, æœ€åå°†å…¶å‘é€åˆ°æœåŠ¡ç«¯ã€‚

åœ¨`addForm`ä¸­å®šä¹‰`attrs`æ•°ç»„

```js
// æ·»åŠ å•†å“çš„è¡¨å•æ•°æ®å¯¹è±¡
      addForm: {
        goods_name: '',
        goods_price: 0,
        goods_weight: 0,
        goods_number: 0,
        // å•†å“æ‰€å±çš„åˆ†ç±»æ•°ç»„
        goods_cat: [],
        // å›¾ç‰‡çš„æ•°ç»„
        pics: [],
        // å•†å“çš„è¯¦æƒ…æè¿°
        goods_introduce: '',
        attrs: []
      },
```

# åä¸‰ã€è®¢å•åˆ—è¡¨

## 1ã€è®¢å•æ•°æ®å±•ç¤º

å®ç°è®¢å•æ•°æ®çš„å±•ç¤ºï¼Œå¹¶ä¸”å®Œæˆç›¸åº”çš„åˆ†é¡µå¤„ç†ã€‚

åˆ—è¡¨å±•ç¤ºçš„ä»£ç å¦‚ä¸‹ï¼š

```vue
<template>
  <div>
    <!-- é¢åŒ…å±‘å¯¼èˆªåŒºåŸŸ -->
    <el-breadcrumb separator-class="el-icon-arrow-right">
      <el-breadcrumb-item :to="{ path: '/home' }">é¦–é¡µ</el-breadcrumb-item>
      <el-breadcrumb-item>è®¢å•ç®¡ç†</el-breadcrumb-item>
      <el-breadcrumb-item>è®¢å•åˆ—è¡¨</el-breadcrumb-item>
    </el-breadcrumb>

    <!-- å¡ç‰‡è§†å›¾åŒºåŸŸ -->
    <el-card>
      <el-row>
        <el-col :span="8">
          <el-input placeholder="è¯·è¾“å…¥å†…å®¹">
            <el-button slot="append" icon="el-icon-search"></el-button>
          </el-input>
        </el-col>
      </el-row>

      <!-- è®¢å•åˆ—è¡¨æ•°æ® -->
      <el-table :data="orderlist" border stripe>
        <el-table-column type="index"></el-table-column>
        <el-table-column label="è®¢å•ç¼–å·" prop="order_number"></el-table-column>
        <el-table-column label="è®¢å•ä»·æ ¼" prop="order_price"></el-table-column>
        <el-table-column label="æ˜¯å¦ä»˜æ¬¾" prop="pay_status">
          <template slot-scope="scope">
            <el-tag type="success" v-if="scope.row.pay_status === '1'"
              >å·²ä»˜æ¬¾</el-tag
            >
            <el-tag type="danger" v-else>æœªä»˜æ¬¾</el-tag>
          </template>
        </el-table-column>
        <el-table-column label="æ˜¯å¦å‘è´§" prop="is_send">
          <template slot-scope="scope">
            <template>{{ scope.row.is_send }}</template>
          </template>
        </el-table-column>
        <el-table-column label="ä¸‹å•æ—¶é—´" prop="create_time">
          <template slot-scope="scope">{{
            scope.row.create_time | dateFormat
          }}</template>
        </el-table-column>
        <el-table-column label="æ“ä½œ">
          <template>
            <el-button
              size="mini"
              type="primary"
              icon="el-icon-edit"
              @click="showBox"
            ></el-button>
            <el-button
              size="mini"
              type="success"
              icon="el-icon-location"
              @click="showProgressBox"
            ></el-button>
          </template>
        </el-table-column>
      </el-table>
      <!-- åˆ†é¡µåŒºåŸŸ -->
      <el-pagination
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
        :current-page="queryInfo.pagenum"
        :page-sizes="[5, 10, 15]"
        :page-size="queryInfo.pagesize"
        layout="total, sizes, prev, pager, next, jumper"
        :total="total"
      ></el-pagination>
    </el-card>
  </div>
</template>
<script>
export default {
  data() {
    return {
      queryInfo: {
        query: "",
        pagenum: 1,
        pagesize: 10,
      },
      total: 0,
      orderlist: [],
    };
  },
  created() {
    this.getOrderList();
  },
  methods: {
    async getOrderList() {
      const { data: res } = await this.$http.get("orders", {
        params: this.queryInfo,
      });

      if (res.meta.status !== 200) {
        return this.$message.error("è·å–è®¢å•åˆ—è¡¨å¤±è´¥ï¼");
      }

      console.log(res);
      this.total = res.data.total;
      this.orderlist = res.data.goods;
    },
    handleSizeChange(newSize) {
      this.queryInfo.pagesize = newSize;
      this.getOrderList();
    },
    handleCurrentChange(newPage) {
      this.queryInfo.pagenum = newPage;
      this.getOrderList();
    },
  },
};
</script>
```

åŸºæœ¬è·¯ç”±è®¾ç½®

```js
import Vue from "vue";
import Router from "vue-router";
import Login from "./components/Login.vue";
import Home from "./components/Home.vue";
import Welcome from "./components/Welcome.vue";
import Users from "./components/user/Users.vue";
import Rights from "./components/power/Rights.vue";
import Roles from "./components/power/Roles.vue";
import Cate from "./components/goods/Cate.vue";
import Params from "./components/goods/Params.vue";
import GoodsList from "./components/goods/List.vue";
import Add from "./components/goods/Add.vue";
import Order from "./components/order/Order.vue";
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
        { path: "/categories", component: Cate },
        { path: "/params", component: Params },
        { path: "/goods", component: GoodsList },
        { path: "/goods/add", component: Add },
        { path: "/orders", component: Order },
      ],
    },
  ],
});
```

## 2ã€åœ°å€ç¼–è¾‘

è¿™é‡Œä¸»è¦æ˜¯å®ç°åœ°å€çš„ä¸‰çº§è”åŠ¨

å½“å•å‡»è¡¨æ ¼ä¸­çš„ç¼–è¾‘æŒ‰é’®çš„æ—¶å€™å¼¹å‡ºå¦‚ä¸‹çš„è¡¨æ ¼

```
<el-button size="mini" type="primary" icon="el-icon-edit" @click="showBox"></el-button>
```

```vue
<!-- ä¿®æ”¹åœ°å€çš„å¯¹è¯æ¡† -->
<el-dialog
  title="ä¿®æ”¹åœ°å€"
  :visible.sync="addressVisible"
  width="50%"
  @close="addressDialogClosed"
>
        <el-form
          :model="addressForm"
          :rules="addressFormRules"
          ref="addressFormRef"
          label-width="100px"
        >
          <el-form-item label="çœå¸‚åŒº/å¿" prop="address1">
            <el-cascader :options="cityData" v-model="addressForm.address1"></el-cascader>
          </el-form-item>
          <el-form-item label="è¯¦ç»†åœ°å€" prop="address2">
            <el-input v-model="addressForm.address2"></el-input>
          </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
          <el-button @click="addressVisible = false">å– æ¶ˆ</el-button>
          <el-button type="primary" @click="addressVisible = false">ç¡® å®š</el-button>
        </span>
      </el-dialog>
```

å…³äºè¡¨å•ç›¸å…³çš„å±æ€§å®šä¹‰

```js
 addressVisible: false,
      addressForm: {
        address1: [],//ç”¨æ¥å­˜å‚¨åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©çš„åœ°å€ä¿¡æ¯ï¼Œè¿™é‡Œéœ€è¦ç”¨æ•°ç»„
        address2: "",
      },
      addressFormRules: {
        address1: [
          { required: true, message: "è¯·é€‰æ‹©çœå¸‚åŒºå¿", trigger: "blur" },
        ],
        address2: [
          { required: true, message: "è¯·å¡«å†™è¯¦ç»†åœ°å€", trigger: "blur" },
        ],
      },
      cityData,//ä¸‹æ‹‰æ¡†å±•ç¤ºçš„åœ°å€æ•°æ®æº
```

`el-cascader` ç»„ä»¶å±•ç¤ºçš„çœå¸‚åœ°åŒºï¼Œæ¥å¤–éƒ¨æ–‡ä»¶

```js
import cityData from "./citydata.js";
```

åŒæ—¶åœ¨`data`ä¸­å®šä¹‰`cityData`

`showBox`æ–¹æ³•çš„å®ç°å¦‚ä¸‹

```js
// å±•ç¤ºä¿®æ”¹åœ°å€çš„å¯¹è¯æ¡†
    showBox() {
      this.addressVisible = true;
    },
```

`addressDialogClosed`æ–¹æ³•å®ç°å¦‚ä¸‹ã€‚

```
 addressDialogClosed() {
      this.$refs.addressFormRef.resetFields();
    },
```

# åå››ã€é¡¹ç›®ä¼˜åŒ–

**é¡¹ç›®ä¼˜åŒ–çš„ç­–ç•¥**

- ç”Ÿæˆæ‰“åŒ…æŠ¥å‘Š
- ç¬¬ä¸‰æ–¹åº“å¯ç”¨`CDN`
- `Element-UI`ç»„ä»¶æŒ‰éœ€åŠ è½½
- è·¯ç”±æ‡’åŠ è½½
- é¦–é¡µå†…å®¹å®šåˆ¶

## 1ã€è¿›åº¦æ¡ä½¿ç”¨

å½“æ•°æ®åŠ è½½æ…¢çš„æ—¶å€™ï¼Œå¯ä»¥å±•ç¤ºå‡ºä¸€ä¸ªè¿›åº¦æ¡ã€‚

```
 npm install --save nprogress
```

åœ¨`main.js`æ–‡ä»¶ä¸­å¯¼å…¥`js`æ–‡ä»¶ä¸`css`æ–‡ä»¶

```js
// å¯¼å…¥ NProgress åŒ…å¯¹åº”çš„JSå’ŒCSS
import NProgress from "nprogress";
import "nprogress/nprogress.css";
```

åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™å¼€å¯è¿›åº¦æ¡ï¼Œåœ¨è·å–å“åº”åå…³é—­è¿›åº¦æ¡

```js
// åœ¨ request æ‹¦æˆªå™¨ä¸­ï¼Œå±•ç¤ºè¿›åº¦æ¡ NProgress.start()
axios.interceptors.request.use((config) => {
  // console.log(config)
  NProgress.start();
  config.headers.Authorization = window.sessionStorage.getItem("token");
  //æœ€åå¿…é¡»è¿”å›config
  return config;
});
// åœ¨ response æ‹¦æˆªå™¨ä¸­ï¼Œéšè—è¿›åº¦æ¡ NProgress.done()
axios.interceptors.response.use((config) => {
  NProgress.done();
  return config;
});
```

## 2ã€ç§»é™¤`console.log`æŒ‡ä»¤

åœ¨é¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºäº†æµ‹è¯•ï¼Œå†™äº†å¾ˆå¤šçš„`console.log`è¾“å‡ºæ‰“å°ï¼Œä½†æ˜¯å½“é¡¹ç›®å‘å¸ƒçš„æ—¶å€™ï¼Œå°±åº”è¯¥å°†è¿™äº›å†…å®¹åˆ é™¤æ‰ã€‚

é€šè¿‡ `babel-plugin-transform-remove-console` è¿™ä¸ªåŒ…æ¥å®Œæˆã€‚

å®‰è£…

```
npm install babel-plugin-transform-remove-console --save-dev
```

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢æ‰¾åˆ°`babel.config.js`æ–‡ä»¶ï¼Œåšå¦‚ä¸‹çš„é…ç½®

```js
// è¿™æ˜¯é¡¹ç›®å‘å¸ƒé˜¶æ®µéœ€è¦ç”¨åˆ°çš„ babel æ’ä»¶
const prodPlugins = [];
if (process.env.NODE_ENV === "production") {
  prodPlugins.push("transform-remove-console");
}

module.exports = {
  presets: ["@vue/cli-plugin-babel/preset"],
  plugins: [
    [
      "component",
      {
        libraryName: "element-ui",
        styleLibraryName: "theme-chalk",
      },
    ],
    // å‘å¸ƒäº§å“æ—¶å€™çš„æ’ä»¶æ•°ç»„
    ...prodPlugins,
  ],
};
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦åœ¨ç”Ÿäº§é˜¶æ®µï¼Œå¦‚æœæ˜¯é‡‡ç”¨`babel-plugin-transform-remove-console`æ’ä»¶ã€‚

å°†å…¶æ·»åŠ åˆ°`prodPlugins`æ•°ç»„ä¸­ï¼Œç„¶ååœ¨`plugins`ä¸­è¿›è¡Œé…ç½®ã€‚

## 3ã€ç”Ÿæˆæ‰“åŒ…æŠ¥å‘Š

æ‰“åŒ…æ—¶ï¼Œä¸ºäº†ç›´è§‚åœ°å‘ç°é¡¹ç›®ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨æ‰“åŒ…æ—¶ç”ŸæˆæŠ¥å‘Šã€‚ç”ŸæˆæŠ¥å‘Šçš„æ–¹å¼æœ‰ä¸¤ç§ï¼š

ç¬¬ä¸€ç§ï¼šé€šè¿‡å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ç”ŸæˆæŠ¥å‘Š

```
 // é€šè¿‡ vue-cli çš„å‘½ä»¤é€‰é¡¹å¯ä»¥ç”Ÿæˆæ‰“åŒ…æŠ¥å‘Š
 // --report é€‰é¡¹å¯ä»¥ç”Ÿæˆ report.html ä»¥å¸®åŠ©åˆ†æåŒ…å†…å®¹
 vue-cli-service build --report
```

ç¬¬äºŒç§ï¼šé€šè¿‡å¯è§†åŒ–çš„`UI`é¢æ¿ç›´æ¥æŸ¥çœ‹æŠ¥å‘Šï¼ˆæ¨èï¼‰

åœ¨å¯è§†åŒ–çš„`UI`é¢æ¿ä¸­ï¼Œé€šè¿‡æ§åˆ¶å°å’Œåˆ†æé¢æ¿ï¼Œå¯ä»¥æ–¹ä¾¿åœ°çœ‹åˆ°é¡¹ç›®ä¸­æ‰€å­˜åœ¨çš„é—®é¢˜ã€‚

ä¾‹å¦‚: ä¾èµ–çš„æ–‡ä»¶(`js`,`css`)æ¯”è¾ƒå¤§ï¼Œé¡µé¢æ‰“å¼€é€Ÿåº¦éå¸¸æ…¢ã€‚

## 4ã€é€šè¿‡ `vue.config.js` ä¿®æ”¹ `webpack` çš„é»˜è®¤é…ç½®

é€šè¿‡è„šæ‰‹æ¶å·¥å…·ç”Ÿæˆçš„é¡¹ç›®ï¼Œé»˜è®¤éšè—äº†æ‰€æœ‰ `webpack` çš„é…ç½®é¡¹ï¼Œç›®çš„æ˜¯ä¸ºäº†å±è”½é¡¹ç›®çš„é…ç½®è¿‡ç¨‹ï¼Œè®©ç¨‹ åºå‘˜æŠŠå·¥ä½œçš„é‡å¿ƒï¼Œæ”¾åˆ°å…·ä½“åŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘çš„å®ç°ä¸Šã€‚

å¦‚æœç¨‹åºå‘˜æœ‰ä¿®æ”¹ `webpack `é»˜è®¤é…ç½®çš„éœ€æ±‚ï¼Œå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼ŒæŒ‰éœ€åˆ›å»º `vue.config.js `è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œä» è€Œå¯¹é¡¹ç›®çš„æ‰“åŒ…å‘å¸ƒè¿‡ç¨‹åšè‡ªå®šä¹‰çš„é…ç½®ï¼ˆå…·ä½“é…ç½®å‚è€ƒ https://cli.vuejs.org/zh/config/#vue-config-jsï¼‰ã€‚

```
  // vue.config.js
  // è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œåº”è¯¥å¯¼å‡ºä¸€ä¸ªåŒ…å«äº†è‡ªå®šä¹‰é…ç½®é€‰é¡¹çš„å¯¹è±¡
  module.exports = {
  // é€‰é¡¹...
  }
```

## 5ã€ä¸ºå¼€å‘æ¨¡å¼ä¸å‘å¸ƒæ¨¡å¼æŒ‡å®šä¸åŒçš„æ‰“åŒ…å…¥å£

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Vue`é¡¹ç›®çš„å¼€å‘æ¨¡å¼ä¸å‘å¸ƒæ¨¡å¼ï¼Œå…±ç”¨åŒä¸€ä¸ªæ‰“åŒ…çš„å…¥å£æ–‡ä»¶ï¼ˆå³` src/main.js`ï¼‰ã€‚

ä¸ºäº†å°†é¡¹ç›® çš„å¼€å‘è¿‡ç¨‹ä¸å‘å¸ƒè¿‡ç¨‹åˆ†ç¦»ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸¤ç§æ¨¡å¼ï¼Œå„è‡ªæŒ‡å®šæ‰“åŒ…çš„å…¥å£æ–‡ä»¶ï¼Œå³ï¼š

â‘  å¼€å‘æ¨¡å¼çš„å…¥å£æ–‡ä»¶ä¸º` src/main-dev.js`

â‘¡ å‘å¸ƒæ¨¡å¼çš„å…¥å£æ–‡ä»¶ä¸º`src/main-prod.js`

**`configureWebpack` å’Œ `chainWebpack`**

åœ¨` vue.config.js` å¯¼å‡ºçš„é…ç½®å¯¹è±¡ä¸­ï¼Œæ–°å¢ `configureWebpack`æˆ– `chainWebpack` èŠ‚ç‚¹ï¼Œæ¥è‡ªå®šä¹‰`webpack `çš„æ‰“åŒ…é…ç½®ã€‚

åœ¨è¿™é‡Œï¼Œ `configureWebpack` å’Œ `chainWebpack` çš„ä½œç”¨ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å®ƒä»¬ä¿®æ”¹ `webpack `é…ç½®çš„æ–¹ å¼ä¸åŒï¼š

ç¬¬ä¸€ï¼š`chainWebpac`k é€šè¿‡**é“¾å¼ç¼–ç¨‹**çš„å½¢å¼ï¼Œæ¥ä¿®æ”¹é»˜è®¤çš„ `webpack` é…ç½®

ç¬¬äºŒï¼š`configureWebpack `é€šè¿‡æ“ä½œå¯¹è±¡çš„å½¢å¼ï¼Œæ¥ä¿®æ”¹é»˜è®¤çš„`webpack`é…ç½®

ä¸¤è€…å…·ä½“çš„ä½¿ç”¨å·®å¼‚ï¼Œå¯å‚è€ƒå¦‚ä¸‹ç½‘å€ï¼š`https://cli.vuejs.org/zh/guide/webpack.html#webpack-%E7%9B%B8%E5%85%B3`

## 6ã€ é€šè¿‡ `chainWebpack `è‡ªå®šä¹‰æ‰“åŒ…å…¥å£

ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
module.exports = {
  chainWebpack: (config) => {
    config.when(process.env.NODE_ENV === "production", (config) => {
      //ç§»é™¤åŸæœ‰é»˜è®¤çš„å…¥å£ï¼Œæ·»åŠ æ–°çš„å…¥å£æ–‡ä»¶
      config.entry("app").clear().add("./src/main-prod.js");
    });
    config.when(process.env.NODE_ENV === "development", (config) => {
      config.entry("app").clear().add("./src/main-dev.js");
    });
  },
};
```

å…·ä½“å®ç°çš„æ–¹å¼å¦‚ä¸‹ï¼š

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢åˆ›å»º`vue.config.js`æ–‡ä»¶ï¼Œå¹¶ä¸”æ·»åŠ å¦‚ä¸Šä»£ç ã€‚

åŒæ—¶å°†åŸæœ‰çš„`src/main.js`æ–‡ä»¶ï¼Œé‡æ–°å‘½åä¸º`main-dev.js`, åŒæ—¶åœ¨æ–°å»ºä¸€ä¸ª`main-prod.js`æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚

## 7ã€é€šè¿‡ `externals` åŠ è½½å¤–éƒ¨ `CDN` èµ„æº

é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ import è¯­æ³•å¯¼å…¥çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œæœ€ç»ˆä¼šè¢«æ‰“åŒ…åˆå¹¶åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä»è€Œå¯¼è‡´æ‰“åŒ…æˆåŠŸ åï¼Œå•æ–‡ä»¶ä½“ç§¯è¿‡å¤§çš„é—®é¢˜ã€‚

ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ `webpack `çš„ `externals `èŠ‚ç‚¹ï¼Œæ¥é…ç½®å¹¶åŠ è½½å¤–éƒ¨çš„`CDN`èµ„æºã€‚å‡¡æ˜¯å£°æ˜åœ¨ `externals` ä¸­çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œéƒ½ä¸ä¼šè¢«æ‰“åŒ…ã€‚

å…·ä½“é…ç½®ä»£ç å¦‚ä¸‹ï¼š

```js
config.set("externals", {
  vue: "Vue",
  "vue-router": "VueRouter",
  axios: "axios",
  lodash: "_",
  echarts: "echarts",
  nprogress: "NProgress",
  "vue-quill-editor": "VueQuillEditor",
});
```

ä»¥ä¸Šå†…å®¹åœ¨`vue.config.js`æ–‡ä»¶ä¸­çš„`å‘å¸ƒæ¨¡å¼`ä¸‹è¿›è¡Œé…ç½®ï¼Œé‚£ä¹ˆåœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œè¿™äº›å†…å®¹å°±ä¸ä¼šè¢«æ‰“åŒ…ã€‚

å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

```js
module.exports = {
  chainWebpack: (config) => {
    config.when(process.env.NODE_ENV === "production", (config) => {
      //ç§»é™¤åŸæœ‰é»˜è®¤çš„å…¥å£ï¼Œæ·»åŠ æ–°çš„å…¥å£æ–‡ä»¶
      config.entry("app").clear().add("./src/main-prod.js");

      config.set("externals", {
        vue: "Vue",
        "vue-router": "VueRouter",
        axios: "axios",
        lodash: "_",
        echarts: "echarts",
        nprogress: "NProgress",
        "vue-quill-editor": "VueQuillEditor",
      });
    });
    config.when(process.env.NODE_ENV === "development", (config) => {
      config.entry("app").clear().add("./src/main-dev.js");
    });
  },
};
```

é‚£ä¹ˆç°åœ¨å°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œå¦‚æœåœ¨å‘å¸ƒæ¨¡å¼ä¸‹æ²¡æœ‰å¯¹è¿™äº›å†…å®¹è¿›è¡Œæ‰“åŒ…ï¼Œé‚£ä¹ˆè¿™äº›åŒ…å°±æ— æ³•ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆåº”è¯¥æ€æ ·è¿›è¡Œè§£å†³å‘¢ï¼Ÿ

è§£å†³çš„æ–¹æ¡ˆå°±æ˜¯åœ¨` public/index.html` æ–‡ä»¶çš„å¤´éƒ¨ï¼Œæ·»åŠ å¦‚ä¸‹çš„`CDN`èµ„æºå¼•ç”¨ï¼š

```
<!-- nprogress çš„æ ·å¼è¡¨æ–‡ä»¶ --> <link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />
<!-- å¯Œ æ–‡æœ¬ç¼–è¾‘å™¨

çš„æ ·å¼è¡¨æ–‡ä»¶ --> <link rel="stylesheet" href="https://cdn.staticfile.org/quill/1.3.4/quill.core.min.css" />
<link rel="stylesheet" href="https://cdn.staticfile.org/quill/1.3.4/quill.snow.min.css" />
<link rel="stylesheet" href="https://cdn.staticfile.org/quill/1.3.4/quill.bubble.min.css" />



<script src="https://cdn.staticfile.org/vue/2.5.22/vue.min.js"></script>
<script src="https://cdn.staticfile.org/vue-router/3.0.1/vue-router.min.js"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<script src="https://cdn.staticfile.org/lodash.js/4.17.11/lodash.min.js"></script>
<script src="https://cdn.staticfile.org/echarts/4.1.0/echarts.min.js"></script>
<script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script>
<!-- å¯Œ æ–‡æœ¬ç¼–è¾‘å™¨çš„ js æ–‡ä»¶ --> <script src="https://cdn.staticfile.org/quill/1.3.4/quill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.4/dist/vue-quill-editor.js"></script>
```

è¿™æ ·æ—¢å¯ä»¥ä½¿ç”¨`vue`,`axios`ç­‰ï¼ŒåŒæ—¶æœ€ç»ˆæ‰“åŒ…æˆåŠŸåçš„æ–‡ä»¶ä¹Ÿå˜å°äº†ã€‚

æ³¨æ„ï¼šéœ€è¦å°†`/src/main-prod.js` ä¸­çš„å…³äºè¿›åº¦æ¡æ ·å¼ä¸å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„æ ·å¼å»æ‰ï¼ˆè¿™äº›æ ·å¼æœ€ç»ˆä¹Ÿä¼šæ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼‰ã€‚

## 8ã€é€šè¿‡ `CDN` ä¼˜åŒ– `ElementUI` çš„æ‰“åŒ…

è™½ç„¶åœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å¯ç”¨äº†`element-ui `ç»„ä»¶çš„æŒ‰éœ€åŠ è½½ï¼Œå°½å¯èƒ½çš„å‡å°‘äº†æ‰“åŒ…çš„ä½“ç§¯ï¼Œä½†æ˜¯é‚£äº›è¢«æŒ‰éœ€åŠ  è½½çš„ç»„ä»¶ï¼Œè¿˜æ˜¯å ç”¨äº†è¾ƒå¤§çš„æ–‡ä»¶ä½“ç§¯ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†`element-ui `ä¸­çš„ç»„ä»¶ï¼Œä¹Ÿé€šè¿‡`CDN`çš„å½¢å¼æ¥åŠ  è½½ï¼Œè¿™æ ·èƒ½å¤Ÿè¿›ä¸€æ­¥å‡å°æ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯ã€‚

å…·ä½“æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š

â‘  åœ¨ `main-prod.js `ä¸­ï¼Œæ³¨é‡Šæ‰ `element-ui `æŒ‰éœ€åŠ è½½çš„ä»£ç  (`import "./plugins/element.js";`)

â‘¡ åœ¨`index.html`çš„å¤´éƒ¨åŒºåŸŸä¸­ï¼Œé€šè¿‡`CDN`åŠ è½½ `element-ui` çš„ `js `å’Œ`css`æ ·å¼

```js
<!-- element-ui çš„æ ·å¼è¡¨æ–‡ä»¶ -->
<link rel="stylesheet" href="https://cdn.staticfile.org/element-ui/2.8.2/theme
chalk/index.css" />
<!-- element-ui çš„ js æ–‡ä»¶ -->
<script src="https://cdn.staticfile.org/element-ui/2.8.2/index.js"></script>
```

## 9ã€é¦–é¡µå†…å®¹å®šåˆ¶

ä¸åŒçš„æ‰“åŒ…ç¯å¢ƒä¸‹ï¼Œé¦–é¡µå†…å®¹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ’ä»¶çš„æ–¹å¼è¿›è¡Œå®šåˆ¶ï¼Œæ’ä»¶é…ç½®å¦‚ä¸‹ï¼š

```js
chainWebpack: (config) => {
  config.when(process.env.NODE_ENV === "production", (config) => {
    config.plugin("html").tap((args) => {
      args[0].isProd = true;
      return args;
    });
  });

  config.when(process.env.NODE_ENV === "development", (config) => {
    config.plugin("html").tap((args) => {
      args[0].isProd = false;
      return args;
    });
  });
};
```

åŠ¨æ€æ·»åŠ äº†ä¸€ä¸ªå‚æ•°ï¼š`isProd`,å¦‚æœåœ¨å‘å¸ƒæ¨¡å¼ä¸­ä¸º`true`,å¦åˆ™ä¸º`false`.

åœ¨` public/index.html` é¦–é¡µä¸­ï¼Œå¯ä»¥æ ¹æ®`isProd`çš„å€¼ï¼Œæ¥å†³å®šå¦‚ä½•æ¸²æŸ“é¡µé¢ç»“æ„

```js
<!â€“ æŒ‰éœ€æ¸²æŸ“é¡µé¢çš„æ ‡é¢˜ -->
<title><%= htmlWebpackPlugin.options.isProd ? '' : 'dev - ' %>ç”µå•†åå°ç®¡ç†ç³»ç»Ÿ</title>

<!â€“ æŒ‰éœ€åŠ è½½å¤–éƒ¨çš„ CDN èµ„æº -->
<% if(htmlWebpackPlugin.options.isProd) { %> <!â€”é€šè¿‡ externals åŠ è½½çš„å¤–éƒ¨ CDN èµ„æº--> <% } %>
```

ä¸‹é¢æ¥å…·ä½“å®ç°ä¸€ä¸‹

åœ¨`vue.config.js`æ–‡ä»¶ä¸­ï¼Œæ·»åŠ `html`æ’ä»¶çš„é…ç½®ã€‚

```js
module.exports = {
  chainWebpack: (config) => {
    config.when(process.env.NODE_ENV === "production", (config) => {
      //ç§»é™¤åŸæœ‰é»˜è®¤çš„å…¥å£ï¼Œæ·»åŠ æ–°çš„å…¥å£æ–‡ä»¶
      config.entry("app").clear().add("./src/main-prod.js");

      config.set("externals", {
        vue: "Vue",
        "vue-router": "VueRouter",
        axios: "axios",
        lodash: "_",
        nprogress: "NProgress",
        "vue-quill-editor": "VueQuillEditor",
      });

      config.plugin("html").tap((args) => {
        args[0].isProd = true;
        return args;
      });
    });
    config.when(process.env.NODE_ENV === "development", (config) => {
      config.entry("app").clear().add("./src/main-dev.js");

      //é€šè¿‡htmlæ’ä»¶åŠ¨æ€æ·»åŠ isProdå±æ€§ï¼Œæ¥åˆ¤æ–­æ˜¯å¼€å‘æ¨¡å¼è¿˜æ˜¯å‘å¸ƒæ¨¡å¼
      config.plugin("html").tap((args) => {
        args[0].isProd = false;
        return args;
      });
    });
  },
};
```

é…ç½®å¥½ä»¥åï¼Œå°±å¯ä»¥ä¿®æ”¹`index.html`ä¸­çš„å†…å®¹äº†ã€‚

```html
<title><%= htmlWebpackPlugin.options.isProd?'':'dev-' %>ç”µå•†åå°ç®¡ç†ç³»ç»Ÿ</title>

<!-- å¦‚æœæ¡ä»¶æˆç«‹è¡¨ç¤ºä¸ºå‘å¸ƒæ¨¡å¼ï¼Œè¿™æ—¶ä½¿ç”¨cdnæ¨¡å¼å¼•å…¥å¤–éƒ¨æ–‡ä»¶ -->
<% if(htmlWebpackPlugin.options.isProd){ %>
<!-- nprogress çš„æ ·å¼è¡¨æ–‡ä»¶ -->
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"
/>
......... <%}%>
```

## 10ã€è·¯ç”±æ‡’åŠ è½½

å½“æ‰“åŒ…æ„å»ºé¡¹ç›®æ—¶ï¼ŒJavaScript åŒ…ä¼šå˜å¾—éå¸¸å¤§ï¼Œå½±å“é¡µé¢åŠ è½½ã€‚å¦‚æœæˆ‘ä»¬èƒ½æŠŠä¸åŒè·¯ç”±å¯¹åº”çš„ç»„ä»¶åˆ†å‰²æˆ ä¸åŒçš„ä»£ç å—ï¼Œç„¶åå½“è·¯ç”±è¢«è®¿é—®çš„æ—¶å€™æ‰åŠ è½½å¯¹åº”ç»„ä»¶ï¼Œè¿™æ ·å°±æ›´åŠ é«˜æ•ˆäº†ã€‚(é»˜è®¤æƒ…å†µä¸‹æ˜¯åŠ è½½æ‰€æœ‰çš„ç»„ä»¶ï¼Œä½†æ˜¯å®ç°äº†è·¯ç”±æ‡’åŠ è½½åï¼Œå¯ä»¥å®ç°å½“è·¯ç”±è¢«è®¿é—®çš„æ—¶å€™æ‰åŠ è½½å¯¹åº”ç»„ä»¶)

å…·ä½“éœ€è¦ 3 æ­¥ï¼š

â‘  å®‰è£… `@babel/plugin-syntax-dynamic-import` åŒ…ã€‚

â‘¡ åœ¨` babel.config.js` é…ç½®æ–‡ä»¶ä¸­å£°æ˜è¯¥æ’ä»¶ã€‚

â‘¢ å°†è·¯ç”±æ”¹ä¸ºæŒ‰éœ€åŠ è½½çš„å½¢å¼ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹

```js
const Foo = () => import(/* webpackChunkName: "group-foo" */ "./Foo.vue");
const Bar = () => import(/* webpackChunkName: "group-foo" */ "./Bar.vue");
const Baz = () => import(/* webpackChunkName: "group-boo" */ "./Baz.vue");
```

ä»¥ä¸Šå†…å®¹è¯­æ³•éœ€è¦å®‰è£…äº†`@babel/plugin-syntax-dynamic-import`æ‰èƒ½ä½¿ç”¨ï¼Œ`import`æ–¹æ³•æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼Œåé¢çš„æ˜¯ç»„ä»¶çš„è·¯å¾„ï¼Œå‰é¢éƒ¨åˆ†è¡¨ç¤ºçš„åˆ†ç»„ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°`Foo.vue` ä¸`Bar.vue`è¿™ä¸¤ä¸ªç»„ä»¶æ˜¯åŒä¸€ç»„ï¼Œé‚£ä¹ˆåœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶ä¼šæ‰“åŒ…åˆ°åŒä¸€ä¸ª`js`æ–‡ä»¶ä¸­ã€‚å¦‚æœè¯·æ±‚`Foo`è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œä¹Ÿä¼šåŠ è½½`Bar`è¿™ä¸ªç»„ä»¶ã€‚å½“ç„¶è¯·æ±‚`Bar`è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œä¹Ÿä¼šåŠ è½½`Foo`è¿™ä¸ªç»„ä»¶ã€‚

è€Œ`Baz`ç»„ä»¶ä¼šè¢«å•ç‹¬çš„æ‰“åŒ…åˆ°ä¸€ä¸ª`js`æ–‡ä»¶ä¸­ã€‚

å…³äºè·¯ç”±æ‡’åŠ è½½çš„è¯¦ç»†æ–‡æ¡£ï¼Œå¯å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š
`https://router.vuejs.org/zh/guide/advanced/lazy-loading.html `

ä¸‹é¢ å®‰è£… `@babel/plugin-syntax-dynamic-import` åŒ…

```
npm install --save-dev @babel/plugin-syntax-dynamic-import
```

åœ¨`babel.config.js`æ–‡ä»¶ä¸­é…ç½®ä¸Šé¢åŒ…

```js
// è¿™æ˜¯é¡¹ç›®å‘å¸ƒé˜¶æ®µéœ€è¦ç”¨åˆ°çš„ babel æ’ä»¶
const prodPlugins = [];
if (process.env.NODE_ENV === "production") {
  prodPlugins.push("transform-remove-console");
}

module.exports = {
  presets: ["@vue/cli-plugin-babel/preset"],
  plugins: [
    [
      "component",
      {
        libraryName: "element-ui",
        styleLibraryName: "theme-chalk",
      },
    ],
    // å‘å¸ƒäº§å“æ—¶å€™çš„æ’ä»¶æ•°ç»„
    ...prodPlugins,
    // å®ç°è·¯ç”±æ‡’åŠ è½½
    "@babel/plugin-syntax-dynamic-import",
  ],
};
```

ä¸‹é¢æ”¹é€ `src/router.js`æ–‡ä»¶ä¸­çš„å†…å®¹

```js
import Vue from "vue";
import Router from "vue-router";
// import Login from "./components/Login.vue";
// import Home from "./components/Home.vue";
// import Welcome from "./components/Welcome.vue";
// import Users from "./components/user/Users.vue";
// import Rights from "./components/power/Rights.vue";
// import Roles from "./components/power/Roles.vue";
// import Cate from "./components/goods/Cate.vue";
// import Params from "./components/goods/Params.vue";
// import GoodsList from "./components/goods/List.vue";
// import Add from "./components/goods/Add.vue";
// import Order from "./components/order/Order.vue";
//ä¸‹é¢å®ç°è·¯ç”±æ‡’åŠ è½½
const Login = () =>
  import(/* webpackChunkName: "login_home_welcome" */ "./components/Login.vue");
const Home = () =>
  import(/* webpackChunkName: "login_home_welcome" */ "./components/Home.vue");
const Welcome = () =>
  import(
    /* webpackChunkName: "login_home_welcome" */ "./components/Welcome.vue"
  );
const Users = () =>
  import(
    /* webpackChunkName: "Users_Rights_Roles" */ "./components/user/Users.vue"
  );
const Rights = () =>
  import(
    /* webpackChunkName: "Users_Rights_Roles" */ "./components/power/Rights.vue"
  );
const Roles = () =>
  import(
    /* webpackChunkName: "Users_Rights_Roles" */ "./components/power/Roles.vue"
  );

const Cate = () =>
  import(/* webpackChunkName: "Cate_Params" */ "./components/goods/Cate.vue");

const Params = () =>
  import(/* webpackChunkName: "Cate_Params" */ "./components/goods/Params.vue");
const GoodsList = () =>
  import(/* webpackChunkName: "GoodsList_Add" */ "./components/goods/List.vue");
const Add = () =>
  import(/* webpackChunkName: "GoodsList_Add" */ "./components/goods/Add.vue");
const Order = () =>
  import(/* webpackChunkName: "Order" */ "./components/order/Order.vue");
Vue.use(Router);
const router = new Router({
  routes: [
    { path: "/", redirect: "/login" },
    { path: "/login", component: Login },
    {
      path: "/home",
      component: Home,
      redirect: "/welcome",
      children: [
        { path: "/welcome", component: Welcome },
        { path: "/users", component: Users },
        { path: "/rights", component: Rights },
        { path: "/roles", component: Roles },
        { path: "/categories", component: Cate },
        { path: "/params", component: Params },
        { path: "/goods", component: GoodsList },
        { path: "/goods/add", component: Add },
        { path: "/orders", component: Order },
      ],
    },
  ],
});
```

å®ç°äº†è·¯ç”±æ‡’åŠ è½½åï¼Œæ‰“åŒ…åçš„æ–‡ä»¶ä½“ç§¯ä¹Ÿä¼šå˜å°ã€‚

ä»¥ä¸Šçš„ä¼˜åŒ–é…ç½®å·²ç»å®Œæˆäº†ï¼Œä¸‹é¢å¯ä»¥ä¸Šçº¿ï¼Œå½“ç„¶åœ¨ä¸Šçº¿ä¹‹å‰ï¼Œéœ€è¦å°†é¡¹ç›®è¿›è¡Œæ‰“åŒ…

`npm run build`

å‘½ä»¤å®Œæˆé¡¹ç›®çš„æ‰“åŒ…ï¼Œæ‰“åŒ…åçš„é¡¹ç›®ä¼šåœ¨`dist`ç›®å½•ä¸‹ã€‚ä¸‹é¢éœ€è¦è¿›è¡Œéƒ¨ç½²ä¸Šçº¿ã€‚

## åäº”ã€é¡¹ç›®éƒ¨ç½²ä¸Šçº¿

å…³äºé¡¹ç›®éƒ¨ç½²ä¸Šçº¿ï¼Œä¸»è¦å®Œæˆä»¥ä¸‹çš„é…ç½®

ç¬¬ä¸€ï¼š é€šè¿‡` node` åˆ›å»º `web` æœåŠ¡å™¨ã€‚

ç¬¬äºŒï¼š å¼€å¯` gzip` é…ç½®ã€‚

ç¬¬ä¸‰ï¼šé…ç½® `https `æœåŠ¡

ç¬¬å››ï¼šä½¿ç”¨ `pm2` ç®¡ç†åº”ç”¨

## 1ã€é€šè¿‡ node åˆ›å»º web æœåŠ¡å™¨

åˆ›å»º `node` é¡¹ç›®ï¼Œå¹¶å®‰è£…` express`ï¼Œé€šè¿‡`express` å¿«é€Ÿåˆ›å»º `web `æœåŠ¡å™¨ï¼Œå°† `vue` æ‰“åŒ…ç”Ÿæˆçš„` dist` æ–‡ä»¶å¤¹ï¼Œ

æ‰˜ç®¡ä¸ºé™æ€èµ„æºå³å¯ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š

```js
const express = require("express");
// åˆ›å»º web æœåŠ¡å™¨
const app = express();

// æ‰˜ç®¡é™æ€èµ„æº
app.use(express.static("./dist"));

// å¯åŠ¨ web æœåŠ¡å™¨
app.listen(80, () => {
  console.log("web server running at http://127.0.0.1");
});
```

å…·ä½“å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š

é¦–å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ï¼š`vue_shop_server`

ç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºä¸€ä¸ª`node`é¡¹ç›®æ¥æ‰˜ç®¡å‘å¸ƒåçš„`Vue`é¡¹ç›®ã€‚

åœ¨`vue_shop_server`ç›®å½•ä¸‹ï¼Œè¿›è¡Œé¡¹ç›®çš„åˆå§‹åŒ–

```
npm init -y
```

ç„¶åå®‰è£…`express`,é€šè¿‡`express`å¿«é€Ÿå¯åŠ¨æœåŠ¡ã€‚

```
npm i express -s
```

æŠŠæ‰“åŒ…å¥½çš„`Vue`é¡¹ç›®ä¸­çš„æ–‡ä»¶å¤¹`dist`æ‹·è´åˆ°`vue_shop_server`ç›®å½•ä¸‹ã€‚

åŒæ—¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º`app.js`æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```js
const express = require("express");
// åˆ›å»º web æœåŠ¡å™¨
const app = express();

// æ‰˜ç®¡é™æ€èµ„æº
app.use(express.static("./dist"));

// å¯åŠ¨ web æœåŠ¡å™¨
app.listen(80, () => {
  console.log("web server running at http://127.0.0.1");
});
```

é€šè¿‡`node app.js`å‘½ä»¤å¯åŠ¨ä»¥ä¸ŠæœåŠ¡ï¼Œè¿™æ—¶å°±å¯ä»¥è®¿é—®æˆ‘ä»¬æ‰“åŒ…å¥½çš„`vue`é¡¹ç›®ã€‚

## 2ã€å¼€å¯ `gzip` é…ç½®

ä½¿ç”¨ `gzip` å¯ä»¥å‡å°æ–‡ä»¶ä½“ç§¯ï¼Œä½¿ä¼ è¾“é€Ÿåº¦æ›´å¿«ã€‚

å¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯ä½¿ç”¨`Express`åš `gzip `å‹ç¼©ã€‚å…¶é…ç½®å¦‚ä¸‹ï¼š

```js
  // å®‰è£…ç›¸åº”åŒ…
  npm install compression -S
  // å¯¼å…¥åŒ…
  const compression = require('compression');
  // å¯ç”¨ä¸­é—´ä»¶
  app.use(compression());
```

å…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼Œä¿®æ”¹`app.js`æ–‡ä»¶ä¸­çš„ä»£ç 

```js
const express = require("express");
// åˆ›å»º web æœåŠ¡å™¨
const app = express();
const compression = require("compression");
// ä¸€å®šè¦æŠŠè¿™ä¸€è¡Œä»£ç ï¼Œå†™åˆ° é™æ€èµ„æºæ‰˜ç®¡ä¹‹å‰(æ³¨æ„é¡ºåº)
app.use(compression());
// æ‰˜ç®¡é™æ€èµ„æº
app.use(express.static("./dist"));

// å¯åŠ¨ web æœåŠ¡å™¨
app.listen(8080, () => {
  console.log("web server running at http://127.0.0.1");
});
```

é‡æ–°å¯åŠ¨æœåŠ¡ã€‚

## 3ã€é…ç½® `HTTPS` æœåŠ¡

**ä¸ºä»€ä¹ˆè¦å¯ç”¨ `HTTPS` æœåŠ¡ï¼Ÿ**

ä¼ ç»Ÿçš„` HTTP` åè®®ä¼ è¾“çš„æ•°æ®éƒ½æ˜¯æ˜æ–‡ï¼Œä¸å®‰å…¨

é‡‡ç”¨` HTTPS` åè®®å¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡Œäº†åŠ å¯†å¤„ç†ï¼Œå¯ä»¥é˜²æ­¢æ•°æ®è¢«ä¸­é—´äººçªƒå–ï¼Œä½¿ç”¨æ›´å®‰å…¨

**ç”³è¯· `SSL` è¯ä¹¦ï¼ˆhttps://freessl.orgï¼‰**

â‘  è¿›å…¥` https://freessl.cn/` å®˜ç½‘ï¼Œè¾“å…¥è¦ç”³è¯·çš„åŸŸåå¹¶é€‰æ‹©å“ç‰Œã€‚

â‘¡ è¾“å…¥è‡ªå·±çš„é‚®ç®±å¹¶é€‰æ‹©ç›¸å…³é€‰é¡¹ã€‚

â‘¢ éªŒè¯ `DNS`ï¼ˆåœ¨åŸŸåç®¡ç†åå°æ·»åŠ  `TXT` è®°å½•ï¼‰ã€‚

â‘£ éªŒè¯é€šè¿‡ä¹‹åï¼Œä¸‹è½½ `SSL` è¯ä¹¦ï¼ˆ` full_chain.pem` å…¬é’¥ï¼›`private.key` ç§é’¥ï¼‰ã€‚

**åœ¨åå°é¡¹ç›®ä¸­å¯¼å…¥è¯ä¹¦**

```js
const https = require("https");
const fs = require("fs");
const options = {
  cert: fs.readFileSync("./full_chain.pem"),
  key: fs.readFileSync("./private.key"),
};
https.createServer(options, app).listen(443);
```

## 4ã€ä½¿ç”¨ `pm2` ç®¡ç†åº”ç”¨

ç°åœ¨æˆ‘ä»¬è¦å¯åŠ¨`node`æœåŠ¡ï¼Œéœ€è¦å¼€å¯ä¸€ä¸ªæŒ‡ä»¤çª—å£ï¼Œå¦‚æœå°†è¯¥çª—å£å…³é—­ï¼Œé‚£ä¹ˆæ•´ä¸ªæœåŠ¡ä¹Ÿå°±åœæ­¢äº†ã€‚

åŒæ—¶ï¼Œçª—å£çš„ç®¡ç†ä¹Ÿå¾ˆéº»çƒ¦ã€‚

â‘  åœ¨æœåŠ¡å™¨ä¸­å®‰è£… `pm2ï¼šnpm i pm2 -g `

â‘¡ å¯åŠ¨é¡¹ç›®ï¼š`pm2 start` è„šæœ¬` --name` è‡ªå®šä¹‰åç§° //è„šæœ¬è¡¨ç¤º node é¡¹ç›®èµ·å§‹æ–‡ä»¶(app.js)

â‘¢ æŸ¥çœ‹è¿è¡Œé¡¹ç›®ï¼š`pm2 ls`

â‘£ é‡å¯é¡¹ç›®ï¼š`pm2 restart` è‡ªå®šä¹‰åç§°

â‘¤ åœæ­¢é¡¹ç›®ï¼š`pm2 stop` è‡ªå®šä¹‰åç§°

â‘¥ åˆ é™¤é¡¹ç›®ï¼š`pm2 delete` è‡ªå®šä¹‰åç§°
